\hypertarget{seq__example__cuda_8cpp}{}\doxysection{examples/run/cuda/seq\+\_\+example\+\_\+cuda.cpp File Reference}
\label{seq__example__cuda_8cpp}\index{examples/run/cuda/seq\_example\_cuda.cpp@{examples/run/cuda/seq\_example\_cuda.cpp}}
{\ttfamily \#include \char`\"{}traccc/clusterization/clusterization\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/clusterization/spacepoint\+\_\+formation.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/cuda/clusterization/clusterization\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/cuda/seeding/seeding\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/cuda/seeding/track\+\_\+params\+\_\+estimation.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/cuda/utils/stream.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/efficiency/seeding\+\_\+performance\+\_\+writer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+cells.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+digitization\+\_\+config.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+geometry.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/common\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/detector\+\_\+input\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/full\+\_\+tracking\+\_\+input\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/handle\+\_\+argument\+\_\+errors.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/performance/collection\+\_\+comparator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/performance/container\+\_\+comparator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/performance/timer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/seeding/seeding\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/seeding/track\+\_\+params\+\_\+estimation.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/cuda/device\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$vecmem/memory/cuda/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$vecmem/utils/cuda/async\+\_\+copy.\+hpp$>$}\newline
{\ttfamily \#include $<$exception$>$}\newline
{\ttfamily \#include $<$iomanip$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
Include dependency graph for seq\+\_\+example\+\_\+cuda.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d5d/seq__example__cuda_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{seq__example__cuda_8cpp_ab84fd28c03657bbb83db32afc8782091}{seq\+\_\+run}} (const \mbox{\hyperlink{structtraccc_1_1full__tracking__input__config}{traccc\+::full\+\_\+tracking\+\_\+input\+\_\+config}} \&i\+\_\+cfg, const \mbox{\hyperlink{structtraccc_1_1common__options}{traccc\+::common\+\_\+options}} \&common\+\_\+opts, const \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc\+::detector\+\_\+input\+\_\+options}} \&det\+\_\+opts, bool run\+\_\+cpu)
\item 
int \mbox{\hyperlink{seq__example__cuda_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{seq__example__cuda_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{seq__example__cuda_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{seq\_example\_cuda.cpp@{seq\_example\_cuda.cpp}!main@{main}}
\index{main@{main}!seq\_example\_cuda.cpp@{seq\_example\_cuda.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{303                                  \{}
\DoxyCodeLine{304     \textcolor{comment}{// Set up the program options}}
\DoxyCodeLine{305     po::options\_description desc(\textcolor{stringliteral}{"Allowed options"});}
\DoxyCodeLine{306 }
\DoxyCodeLine{307     \textcolor{comment}{// Add options}}
\DoxyCodeLine{308     desc.add\_options()(\textcolor{stringliteral}{"help,h"}, \textcolor{stringliteral}{"Give some help with the program's options"});}
\DoxyCodeLine{309     \mbox{\hyperlink{structtraccc_1_1common__options}{traccc::common\_options}} common\_opts(desc);}
\DoxyCodeLine{310     \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc::detector\_input\_options}} det\_opts(desc);}
\DoxyCodeLine{311     \mbox{\hyperlink{structtraccc_1_1full__tracking__input__config}{traccc::full\_tracking\_input\_config}} full\_tracking\_input\_cfg(desc);}
\DoxyCodeLine{312     desc.add\_options()(\textcolor{stringliteral}{"run\_cpu"}, po::value<bool>()-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{313                        \textcolor{stringliteral}{"run cpu tracking as well"});}
\DoxyCodeLine{314 }
\DoxyCodeLine{315     po::variables\_map vm;}
\DoxyCodeLine{316     po::store(po::parse\_command\_line(argc, argv, desc), vm);}
\DoxyCodeLine{317 }
\DoxyCodeLine{318     \textcolor{comment}{// Check errors}}
\DoxyCodeLine{319     \mbox{\hyperlink{namespacetraccc_a018e1f5ae8dbab3e118c08cfb905be01}{traccc::handle\_argument\_errors}}(vm, desc);}
\DoxyCodeLine{320 }
\DoxyCodeLine{321     \textcolor{comment}{// Read options}}
\DoxyCodeLine{322     common\_opts.read(vm);}
\DoxyCodeLine{323     det\_opts.read(vm);}
\DoxyCodeLine{324     full\_tracking\_input\_cfg.read(vm);}
\DoxyCodeLine{325     \textcolor{keyword}{auto} run\_cpu = vm[\textcolor{stringliteral}{"run\_cpu"}].as<\textcolor{keywordtype}{bool}>();}
\DoxyCodeLine{326 }
\DoxyCodeLine{327     std::cout << \textcolor{stringliteral}{"Running "} << argv[0] << \textcolor{stringliteral}{" "}}
\DoxyCodeLine{328               << full\_tracking\_input\_cfg.detector\_file << \textcolor{stringliteral}{" "}}
\DoxyCodeLine{329               << common\_opts.input\_directory << \textcolor{stringliteral}{" "} << common\_opts.events}
\DoxyCodeLine{330               << std::endl;}
\DoxyCodeLine{331 }
\DoxyCodeLine{332     \textcolor{keywordflow}{return} \mbox{\hyperlink{seq__example__cuda_8cpp_ab84fd28c03657bbb83db32afc8782091}{seq\_run}}(full\_tracking\_input\_cfg, common\_opts, det\_opts, run\_cpu);}
\DoxyCodeLine{333 \}}

\end{DoxyCode}


References traccc\+::full\+\_\+tracking\+\_\+input\+\_\+config\+::detector\+\_\+file, traccc\+::common\+\_\+options\+::events, traccc\+::handle\+\_\+argument\+\_\+errors(), traccc\+::common\+\_\+options\+::input\+\_\+directory, traccc\+::full\+\_\+tracking\+\_\+input\+\_\+config\+::read(), traccc\+::detector\+\_\+input\+\_\+options\+::read(), traccc\+::common\+\_\+options\+::read(), and seq\+\_\+run().

\mbox{\Hypertarget{seq__example__cuda_8cpp_ab84fd28c03657bbb83db32afc8782091}\label{seq__example__cuda_8cpp_ab84fd28c03657bbb83db32afc8782091}} 
\index{seq\_example\_cuda.cpp@{seq\_example\_cuda.cpp}!seq\_run@{seq\_run}}
\index{seq\_run@{seq\_run}!seq\_example\_cuda.cpp@{seq\_example\_cuda.cpp}}
\doxysubsubsection{\texorpdfstring{seq\_run()}{seq\_run()}}
{\footnotesize\ttfamily int seq\+\_\+run (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structtraccc_1_1full__tracking__input__config}{traccc\+::full\+\_\+tracking\+\_\+input\+\_\+config}} \&}]{i\+\_\+cfg,  }\item[{const \mbox{\hyperlink{structtraccc_1_1common__options}{traccc\+::common\+\_\+options}} \&}]{common\+\_\+opts,  }\item[{const \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc\+::detector\+\_\+input\+\_\+options}} \&}]{det\+\_\+opts,  }\item[{bool}]{run\+\_\+cpu }\end{DoxyParamCaption})}

T\+R\+A\+C\+CC library, part of the A\+C\+TS project (R\&D line)

(c) 2021-\/2023 C\+E\+RN for the benefit of the A\+C\+TS project

Mozilla Public License Version 2.\+0 Statistics
\begin{DoxyCode}{0}
\DoxyCodeLine{44                                                                         \{}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{comment}{// Read the surface transforms}}
\DoxyCodeLine{47     \textcolor{keyword}{auto} surface\_transforms = \mbox{\hyperlink{namespacetraccc_1_1io_a5a6c904c086473a05b85a0bf060bfa8d}{traccc::io::read\_geometry}}(det\_opts.\mbox{\hyperlink{structtraccc_1_1detector__input__options_a1121f57fa16a57c9d2cef56f94390bcb}{detector\_file}});}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{comment}{// Read the digitization configuration file}}
\DoxyCodeLine{50     \textcolor{keyword}{auto} digi\_cfg =}
\DoxyCodeLine{51         \mbox{\hyperlink{namespacetraccc_1_1io_aa6519a2968b73b699f1aee456d80c190}{traccc::io::read\_digitization\_config}}(i\_cfg.\mbox{\hyperlink{structtraccc_1_1full__tracking__input__config_a9d09f5ae4422abd2074ffbdcd1de81f4}{digitization\_config\_file}});}
\DoxyCodeLine{52 }
\DoxyCodeLine{53     \textcolor{comment}{// Output stats}}
\DoxyCodeLine{54     uint64\_t n\_cells = 0;}
\DoxyCodeLine{55     uint64\_t n\_modules = 0;}
\DoxyCodeLine{56     \textcolor{comment}{// uint64\_t n\_clusters = 0;}}
\DoxyCodeLine{57     uint64\_t n\_measurements = 0;}
\DoxyCodeLine{58     uint64\_t n\_spacepoints = 0;}
\DoxyCodeLine{59     uint64\_t n\_spacepoints\_cuda = 0;}
\DoxyCodeLine{60     uint64\_t n\_seeds = 0;}
\DoxyCodeLine{61     uint64\_t n\_seeds\_cuda = 0;}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{comment}{// Configs}}
\DoxyCodeLine{64     \mbox{\hyperlink{structtraccc_1_1seedfinder__config}{traccc::seedfinder\_config}} finder\_config;}
\DoxyCodeLine{65     \mbox{\hyperlink{structtraccc_1_1spacepoint__grid__config}{traccc::spacepoint\_grid\_config}} grid\_config(finder\_config);}
\DoxyCodeLine{66     \mbox{\hyperlink{structtraccc_1_1seedfilter__config}{traccc::seedfilter\_config}} filter\_config;}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \textcolor{comment}{// Memory resources used by the application.}}
\DoxyCodeLine{69     vecmem::host\_memory\_resource host\_mr;}
\DoxyCodeLine{70     vecmem::cuda::host\_memory\_resource cuda\_host\_mr;}
\DoxyCodeLine{71     vecmem::cuda::device\_memory\_resource device\_mr;}
\DoxyCodeLine{72     \mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc::memory\_resource}} mr\{device\_mr, \&cuda\_host\_mr\};}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \mbox{\hyperlink{classtraccc_1_1clusterization__algorithm}{traccc::clusterization\_algorithm}} ca(host\_mr);}
\DoxyCodeLine{75     \mbox{\hyperlink{classtraccc_1_1spacepoint__formation}{traccc::spacepoint\_formation}} sf(host\_mr);}
\DoxyCodeLine{76     \mbox{\hyperlink{classtraccc_1_1seeding__algorithm}{traccc::seeding\_algorithm}} sa(finder\_config, grid\_config, filter\_config,}
\DoxyCodeLine{77                                  host\_mr);}
\DoxyCodeLine{78     \mbox{\hyperlink{classtraccc_1_1track__params__estimation}{traccc::track\_params\_estimation}} tp(host\_mr);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \mbox{\hyperlink{classtraccc_1_1cuda_1_1stream}{traccc::cuda::stream}} stream;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     vecmem::cuda::async\_copy copy\{stream.\mbox{\hyperlink{classtraccc_1_1cuda_1_1stream_ad8224b3cebfca8079e035a10a9b1e20f}{cudaStream}}()\};}
\DoxyCodeLine{83 }
\DoxyCodeLine{84     \mbox{\hyperlink{classtraccc_1_1cuda_1_1clusterization__algorithm}{traccc::cuda::clusterization\_algorithm}} ca\_cuda(}
\DoxyCodeLine{85         mr, copy, stream, common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_a37c3f39aee3d48292fb8c3ccb441f117}{target\_cells\_per\_partition}});}
\DoxyCodeLine{86     \mbox{\hyperlink{classtraccc_1_1cuda_1_1seeding__algorithm}{traccc::cuda::seeding\_algorithm}} sa\_cuda(finder\_config, grid\_config,}
\DoxyCodeLine{87                                             filter\_config, mr, copy, stream);}
\DoxyCodeLine{88     \mbox{\hyperlink{structtraccc_1_1cuda_1_1track__params__estimation}{traccc::cuda::track\_params\_estimation}} tp\_cuda(mr, copy, stream);}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     \textcolor{comment}{// performance writer}}
\DoxyCodeLine{91     \mbox{\hyperlink{classtraccc_1_1seeding__performance__writer}{traccc::seeding\_performance\_writer}} sd\_performance\_writer(}
\DoxyCodeLine{92         \mbox{\hyperlink{structtraccc_1_1seeding__performance__writer_1_1config}{traccc::seeding\_performance\_writer::config}}\{\});}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \mbox{\hyperlink{structtraccc_1_1performance_1_1timing__info}{traccc::performance::timing\_info}} elapsedTimes;}
\DoxyCodeLine{95 }
\DoxyCodeLine{96     \textcolor{comment}{// Loop over events}}
\DoxyCodeLine{97     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} = common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_ac0477bdb9a07bf525e12b006e141e094}{skip}};}
\DoxyCodeLine{98          \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} < common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_adefc317cdc0b846c7be8db1e5f0c3ef2}{events}} + common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_ac0477bdb9a07bf525e12b006e141e094}{skip}}; ++\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}) \{}
\DoxyCodeLine{99 }
\DoxyCodeLine{100         \textcolor{comment}{// Instantiate host containers/collections}}
\DoxyCodeLine{101         \mbox{\hyperlink{structtraccc_1_1io_1_1cell__reader__output}{traccc::io::cell\_reader\_output}} read\_out\_per\_event(mr.host);}
\DoxyCodeLine{102         traccc::clusterization\_algorithm::output\_type measurements\_per\_event;}
\DoxyCodeLine{103         traccc::spacepoint\_formation::output\_type spacepoints\_per\_event;}
\DoxyCodeLine{104         traccc::seeding\_algorithm::output\_type seeds;}
\DoxyCodeLine{105         traccc::track\_params\_estimation::output\_type params;}
\DoxyCodeLine{106 }
\DoxyCodeLine{107         \textcolor{comment}{// Instantiate cuda containers/collections}}
\DoxyCodeLine{108         \mbox{\hyperlink{structtraccc_1_1collection__types_af1bd16700947e48e7e095b96e552aba2}{traccc::spacepoint\_collection\_types::buffer}} spacepoints\_cuda\_buffer(}
\DoxyCodeLine{109             0, *mr.host);}
\DoxyCodeLine{110         \mbox{\hyperlink{structtraccc_1_1collection__types_af1bd16700947e48e7e095b96e552aba2}{traccc::seed\_collection\_types::buffer}} seeds\_cuda\_buffer(0, *mr.host);}
\DoxyCodeLine{111         \mbox{\hyperlink{structtraccc_1_1collection__types_af1bd16700947e48e7e095b96e552aba2}{traccc::bound\_track\_parameters\_collection\_types::buffer}}}
\DoxyCodeLine{112             params\_cuda\_buffer(0, *mr.host);}
\DoxyCodeLine{113 }
\DoxyCodeLine{114         \{}
\DoxyCodeLine{115             \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} wall\_t(\textcolor{stringliteral}{"Wall time"}, elapsedTimes);}
\DoxyCodeLine{116 }
\DoxyCodeLine{117             \{}
\DoxyCodeLine{118                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"File reading  (cpu)"},}
\DoxyCodeLine{119                                              elapsedTimes);}
\DoxyCodeLine{120                 \textcolor{comment}{// Read the cells from the relevant event file into host memory.}}
\DoxyCodeLine{121                 \mbox{\hyperlink{namespacetraccc_1_1io_a4141a99f877738d68d63f85ed5642462}{traccc::io::read\_cells}}(read\_out\_per\_event, \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}},}
\DoxyCodeLine{122                                        common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_aec17933699762e2feb58124cef53d6b2}{input\_directory}},}
\DoxyCodeLine{123                                        common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_a290ad4675f5a976c73c2a05e35dd1b5c}{input\_data\_format}},}
\DoxyCodeLine{124                                        \&surface\_transforms, \&digi\_cfg);}
\DoxyCodeLine{125             \}  \textcolor{comment}{// stop measuring file reading timer}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127             \textcolor{keyword}{const} \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::cell\_collection\_types::host}}\& cells\_per\_event =}
\DoxyCodeLine{128                 read\_out\_per\_event.cells;}
\DoxyCodeLine{129             \textcolor{keyword}{const} \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::cell\_module\_collection\_types::host}}\&}
\DoxyCodeLine{130                 modules\_per\_event = read\_out\_per\_event.modules;}
\DoxyCodeLine{131 }
\DoxyCodeLine{132             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{133 \textcolor{comment}{                Clusterization and Spacepoint Creation (cuda)}}
\DoxyCodeLine{134 \textcolor{comment}{            -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{135             \textcolor{comment}{// Create device copy of input collections}}
\DoxyCodeLine{136             \mbox{\hyperlink{structtraccc_1_1collection__types_af1bd16700947e48e7e095b96e552aba2}{traccc::cell\_collection\_types::buffer}} cells\_buffer(}
\DoxyCodeLine{137                 cells\_per\_event.size(), mr.main);}
\DoxyCodeLine{138             copy(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(cells\_per\_event), cells\_buffer);}
\DoxyCodeLine{139             \mbox{\hyperlink{structtraccc_1_1collection__types_af1bd16700947e48e7e095b96e552aba2}{traccc::cell\_module\_collection\_types::buffer}} modules\_buffer(}
\DoxyCodeLine{140                 modules\_per\_event.size(), mr.main);}
\DoxyCodeLine{141             copy(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(modules\_per\_event), modules\_buffer);}
\DoxyCodeLine{142 }
\DoxyCodeLine{143             \{}
\DoxyCodeLine{144                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Clusterization (cuda)"},}
\DoxyCodeLine{145                                              elapsedTimes);}
\DoxyCodeLine{146                 \textcolor{comment}{// Reconstruct it into spacepoints on the device.}}
\DoxyCodeLine{147                 spacepoints\_cuda\_buffer =}
\DoxyCodeLine{148                     ca\_cuda(cells\_buffer, modules\_buffer).first;}
\DoxyCodeLine{149                 stream.\mbox{\hyperlink{classtraccc_1_1cuda_1_1stream_a02822504e0827a6176095e1800d174ad}{synchronize}}();}
\DoxyCodeLine{150             \}  \textcolor{comment}{// stop measuring clusterization cuda timer}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152             \textcolor{keywordflow}{if} (run\_cpu) \{}
\DoxyCodeLine{153 }
\DoxyCodeLine{154                 \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{155 \textcolor{comment}{                    Clusterization (cpu)}}
\DoxyCodeLine{156 \textcolor{comment}{                -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{157 }
\DoxyCodeLine{158                 \{}
\DoxyCodeLine{159                     \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Clusterization  (cpu)"},}
\DoxyCodeLine{160                                                  elapsedTimes);}
\DoxyCodeLine{161                     measurements\_per\_event =}
\DoxyCodeLine{162                         ca(cells\_per\_event, modules\_per\_event);}
\DoxyCodeLine{163                 \}  \textcolor{comment}{// stop measuring clusterization cpu timer}}
\DoxyCodeLine{164 }
\DoxyCodeLine{165                 \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{166 \textcolor{comment}{                    Spacepoint formation (cpu)}}
\DoxyCodeLine{167 \textcolor{comment}{                -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{168 }
\DoxyCodeLine{169                 \{}
\DoxyCodeLine{170                     \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Spacepoint formation  (cpu)"},}
\DoxyCodeLine{171                                                  elapsedTimes);}
\DoxyCodeLine{172                     spacepoints\_per\_event =}
\DoxyCodeLine{173                         sf(measurements\_per\_event, modules\_per\_event);}
\DoxyCodeLine{174                 \}  \textcolor{comment}{// stop measuring spacepoint formation cpu timer}}
\DoxyCodeLine{175             \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{177             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{178 \textcolor{comment}{                Seeding algorithm}}
\DoxyCodeLine{179 \textcolor{comment}{            -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{180 }
\DoxyCodeLine{181             \textcolor{comment}{// CUDA}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183             \{}
\DoxyCodeLine{184                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Seeding (cuda)"}, elapsedTimes);}
\DoxyCodeLine{185                 seeds\_cuda\_buffer = sa\_cuda(spacepoints\_cuda\_buffer);}
\DoxyCodeLine{186                 stream.\mbox{\hyperlink{classtraccc_1_1cuda_1_1stream_a02822504e0827a6176095e1800d174ad}{synchronize}}();}
\DoxyCodeLine{187             \}  \textcolor{comment}{// stop measuring seeding cuda timer}}
\DoxyCodeLine{188 }
\DoxyCodeLine{189             \textcolor{comment}{// CPU}}
\DoxyCodeLine{190 }
\DoxyCodeLine{191             \textcolor{keywordflow}{if} (run\_cpu) \{}
\DoxyCodeLine{192                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Seeding  (cpu)"}, elapsedTimes);}
\DoxyCodeLine{193                 seeds = sa(spacepoints\_per\_event);}
\DoxyCodeLine{194             \}  \textcolor{comment}{// stop measuring seeding cpu timer}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{197 \textcolor{comment}{            Track params estimation}}
\DoxyCodeLine{198 \textcolor{comment}{            -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{199 }
\DoxyCodeLine{200             \textcolor{comment}{// CUDA}}
\DoxyCodeLine{201 }
\DoxyCodeLine{202             \{}
\DoxyCodeLine{203                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Track params (cuda)"},}
\DoxyCodeLine{204                                              elapsedTimes);}
\DoxyCodeLine{205                 params\_cuda\_buffer =}
\DoxyCodeLine{206                     tp\_cuda(spacepoints\_cuda\_buffer, seeds\_cuda\_buffer,}
\DoxyCodeLine{207                             \{0.f, 0.f, finder\_config.\mbox{\hyperlink{structtraccc_1_1seedfinder__config_af3b9be46bd90bb968da94db6ac36bd45}{bFieldInZ}}\});}
\DoxyCodeLine{208                 stream.\mbox{\hyperlink{classtraccc_1_1cuda_1_1stream_a02822504e0827a6176095e1800d174ad}{synchronize}}();}
\DoxyCodeLine{209             \}  \textcolor{comment}{// stop measuring track params timer}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211             \textcolor{comment}{// CPU}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213             \textcolor{keywordflow}{if} (run\_cpu) \{}
\DoxyCodeLine{214                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Track params  (cpu)"},}
\DoxyCodeLine{215                                              elapsedTimes);}
\DoxyCodeLine{216                 params = tp(spacepoints\_per\_event, seeds,}
\DoxyCodeLine{217                             \{0.f, 0.f, finder\_config.\mbox{\hyperlink{structtraccc_1_1seedfinder__config_af3b9be46bd90bb968da94db6ac36bd45}{bFieldInZ}}\});}
\DoxyCodeLine{218             \}  \textcolor{comment}{// stop measuring track params cpu timer}}
\DoxyCodeLine{219 }
\DoxyCodeLine{220         \}  \textcolor{comment}{// Stop measuring wall time}}
\DoxyCodeLine{221 }
\DoxyCodeLine{222         \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{223 \textcolor{comment}{          compare cpu and cuda result}}
\DoxyCodeLine{224 \textcolor{comment}{          -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{225 }
\DoxyCodeLine{226         \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::spacepoint\_collection\_types::host}} spacepoints\_per\_event\_cuda;}
\DoxyCodeLine{227         \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::seed\_collection\_types::host}} seeds\_cuda;}
\DoxyCodeLine{228         \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::bound\_track\_parameters\_collection\_types::host}} params\_cuda;}
\DoxyCodeLine{229 }
\DoxyCodeLine{230         copy(spacepoints\_cuda\_buffer, spacepoints\_per\_event\_cuda)-\/>wait();}
\DoxyCodeLine{231         copy(seeds\_cuda\_buffer, seeds\_cuda)-\/>wait();}
\DoxyCodeLine{232         copy(params\_cuda\_buffer, params\_cuda)-\/>wait();}
\DoxyCodeLine{233 }
\DoxyCodeLine{234         \textcolor{keywordflow}{if} (run\_cpu) \{}
\DoxyCodeLine{235 }
\DoxyCodeLine{236             \textcolor{comment}{// Show which event we are currently presenting the results for.}}
\DoxyCodeLine{237             std::cout << \textcolor{stringliteral}{"===>>> Event "} << \textcolor{keyword}{event} << \textcolor{stringliteral}{" <<<==="} << std::endl;}
\DoxyCodeLine{238 }
\DoxyCodeLine{239             \textcolor{comment}{// Compare the spacepoints made on the host and on the device.}}
\DoxyCodeLine{240             \mbox{\hyperlink{classtraccc_1_1collection__comparator}{traccc::collection\_comparator<traccc::spacepoint>}}}
\DoxyCodeLine{241                 compare\_spacepoints\{\textcolor{stringliteral}{"spacepoints"}\};}
\DoxyCodeLine{242             compare\_spacepoints(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(spacepoints\_per\_event),}
\DoxyCodeLine{243                                 \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(spacepoints\_per\_event\_cuda));}
\DoxyCodeLine{244 }
\DoxyCodeLine{245             \textcolor{comment}{// Compare the seeds made on the host and on the device}}
\DoxyCodeLine{246             \mbox{\hyperlink{classtraccc_1_1collection__comparator}{traccc::collection\_comparator<traccc::seed>}} compare\_seeds\{}
\DoxyCodeLine{247                 \textcolor{stringliteral}{"seeds"}, \mbox{\hyperlink{classtraccc_1_1details_1_1comparator__factory}{traccc::details::comparator\_factory<traccc::seed>}}\{}
\DoxyCodeLine{248                              \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(spacepoints\_per\_event),}
\DoxyCodeLine{249                              \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(spacepoints\_per\_event\_cuda)\}\};}
\DoxyCodeLine{250             compare\_seeds(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(seeds),}
\DoxyCodeLine{251                           \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(seeds\_cuda));}
\DoxyCodeLine{252 }
\DoxyCodeLine{253             \textcolor{comment}{// Compare the track parameters made on the host and on the device.}}
\DoxyCodeLine{254             \mbox{\hyperlink{classtraccc_1_1collection__comparator}{traccc::collection\_comparator<traccc::bound\_track\_parameters>}}}
\DoxyCodeLine{255                 compare\_track\_parameters\{\textcolor{stringliteral}{"track parameters"}\};}
\DoxyCodeLine{256             compare\_track\_parameters(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(params),}
\DoxyCodeLine{257                                      \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(params\_cuda));}
\DoxyCodeLine{258         \}}
\DoxyCodeLine{260         n\_modules += read\_out\_per\_event.modules.size();}
\DoxyCodeLine{261         n\_cells += read\_out\_per\_event.cells.size();}
\DoxyCodeLine{262         n\_measurements += measurements\_per\_event.size();}
\DoxyCodeLine{263         n\_spacepoints += spacepoints\_per\_event.size();}
\DoxyCodeLine{264         n\_seeds += seeds.size();}
\DoxyCodeLine{265         n\_spacepoints\_cuda += spacepoints\_per\_event\_cuda.size();}
\DoxyCodeLine{266         n\_seeds\_cuda += seeds\_cuda.size();}
\DoxyCodeLine{267 }
\DoxyCodeLine{268         \textcolor{keywordflow}{if} (common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_a06a875a852f866c6ad5abfaae82cb440}{check\_performance}}) \{}
\DoxyCodeLine{269 }
\DoxyCodeLine{270             \mbox{\hyperlink{structtraccc_1_1event__map}{traccc::event\_map}} evt\_map(}
\DoxyCodeLine{271                 \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}, det\_opts.\mbox{\hyperlink{structtraccc_1_1detector__input__options_a1121f57fa16a57c9d2cef56f94390bcb}{detector\_file}}, i\_cfg.\mbox{\hyperlink{structtraccc_1_1full__tracking__input__config_a9d09f5ae4422abd2074ffbdcd1de81f4}{digitization\_config\_file}},}
\DoxyCodeLine{272                 common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_aec17933699762e2feb58124cef53d6b2}{input\_directory}}, common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_aec17933699762e2feb58124cef53d6b2}{input\_directory}},}
\DoxyCodeLine{273                 common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_aec17933699762e2feb58124cef53d6b2}{input\_directory}}, host\_mr);}
\DoxyCodeLine{274             sd\_performance\_writer.write(}
\DoxyCodeLine{275                 \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(seeds\_cuda),}
\DoxyCodeLine{276                 \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(spacepoints\_per\_event\_cuda), evt\_map);}
\DoxyCodeLine{277         \}}
\DoxyCodeLine{278     \}}
\DoxyCodeLine{279 }
\DoxyCodeLine{280     \textcolor{keywordflow}{if} (common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_a06a875a852f866c6ad5abfaae82cb440}{check\_performance}}) \{}
\DoxyCodeLine{281         sd\_performance\_writer.finalize();}
\DoxyCodeLine{282     \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284     std::cout << \textcolor{stringliteral}{"==> Statistics ... "} << std::endl;}
\DoxyCodeLine{285     std::cout << \textcolor{stringliteral}{"-\/ read    "} << n\_cells << \textcolor{stringliteral}{" cells from "} << n\_modules}
\DoxyCodeLine{286               << \textcolor{stringliteral}{" modules"} << std::endl;}
\DoxyCodeLine{287     std::cout << \textcolor{stringliteral}{"-\/ created (cpu)  "} << n\_measurements << \textcolor{stringliteral}{" measurements     "}}
\DoxyCodeLine{288               << std::endl;}
\DoxyCodeLine{289     std::cout << \textcolor{stringliteral}{"-\/ created (cpu)  "} << n\_spacepoints << \textcolor{stringliteral}{" spacepoints     "}}
\DoxyCodeLine{290               << std::endl;}
\DoxyCodeLine{291     std::cout << \textcolor{stringliteral}{"-\/ created (cuda) "} << n\_spacepoints\_cuda}
\DoxyCodeLine{292               << \textcolor{stringliteral}{" spacepoints     "} << std::endl;}
\DoxyCodeLine{293 }
\DoxyCodeLine{294     std::cout << \textcolor{stringliteral}{"-\/ created  (cpu) "} << n\_seeds << \textcolor{stringliteral}{" seeds"} << std::endl;}
\DoxyCodeLine{295     std::cout << \textcolor{stringliteral}{"-\/ created (cuda) "} << n\_seeds\_cuda << \textcolor{stringliteral}{" seeds"} << std::endl;}
\DoxyCodeLine{296     std::cout << \textcolor{stringliteral}{"==>Elapsed times...\(\backslash\)n"} << elapsedTimes << std::endl;}
\DoxyCodeLine{297 }
\DoxyCodeLine{298     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{299 \}}

\end{DoxyCode}


References traccc\+::seedfinder\+\_\+config\+::b\+Field\+InZ, traccc\+::io\+::cell\+\_\+reader\+\_\+output\+::cells, traccc\+::common\+\_\+options\+::check\+\_\+performance, traccc\+::cuda\+::stream\+::cuda\+Stream(), traccc\+::detector\+\_\+input\+\_\+options\+::detector\+\_\+file, traccc\+::full\+\_\+tracking\+\_\+input\+\_\+config\+::digitization\+\_\+config\+\_\+file, event, traccc\+::common\+\_\+options\+::events, traccc\+::get\+\_\+data(), traccc\+::common\+\_\+options\+::input\+\_\+data\+\_\+format, traccc\+::common\+\_\+options\+::input\+\_\+directory, traccc\+::io\+::cell\+\_\+reader\+\_\+output\+::modules, traccc\+::io\+::read\+\_\+cells(), traccc\+::io\+::read\+\_\+digitization\+\_\+config(), traccc\+::io\+::read\+\_\+geometry(), traccc\+::common\+\_\+options\+::skip, traccc\+::cuda\+::stream\+::synchronize(), and traccc\+::common\+\_\+options\+::target\+\_\+cells\+\_\+per\+\_\+partition.



Referenced by main().

