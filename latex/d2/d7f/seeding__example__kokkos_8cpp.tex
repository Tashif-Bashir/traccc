\hypertarget{seeding__example__kokkos_8cpp}{}\doxysection{examples/run/kokkos/seeding\+\_\+example\+\_\+kokkos.cpp File Reference}
\label{seeding__example__kokkos_8cpp}\index{examples/run/kokkos/seeding\_example\_kokkos.cpp@{examples/run/kokkos/seeding\_example\_kokkos.cpp}}
{\ttfamily \#include \char`\"{}traccc/efficiency/seeding\+\_\+performance\+\_\+writer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+geometry.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+spacepoints.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/kokkos/seeding/spacepoint\+\_\+binning.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/common\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/detector\+\_\+input\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/handle\+\_\+argument\+\_\+errors.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/seeding\+\_\+input\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/performance/collection\+\_\+comparator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/performance/timer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/seeding/seeding\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/seeding/track\+\_\+params\+\_\+estimation.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$chrono$>$}\newline
{\ttfamily \#include $<$exception$>$}\newline
{\ttfamily \#include $<$iomanip$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
{\ttfamily \#include $<$Kokkos\+\_\+\+Core.\+hpp$>$}\newline
Include dependency graph for seeding\+\_\+example\+\_\+kokkos.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d3/dc8/seeding__example__kokkos_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{seeding__example__kokkos_8cpp_ad3e13c776783766978925394effe9d39}{seq\+\_\+run}} (const \mbox{\hyperlink{structtraccc_1_1seeding__input__config}{traccc\+::seeding\+\_\+input\+\_\+config}} \&, const \mbox{\hyperlink{structtraccc_1_1common__options}{traccc\+::common\+\_\+options}} \&common\+\_\+opts, const \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc\+::detector\+\_\+input\+\_\+options}} \&det\+\_\+opts, bool run\+\_\+cpu)
\item 
int \mbox{\hyperlink{seeding__example__kokkos_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{seeding__example__kokkos_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{seeding__example__kokkos_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{seeding\_example\_kokkos.cpp@{seeding\_example\_kokkos.cpp}!main@{main}}
\index{main@{main}!seeding\_example\_kokkos.cpp@{seeding\_example\_kokkos.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{148                                  \{}
\DoxyCodeLine{149     \textcolor{comment}{// Initialise both Kokkos and GoogleTest.}}
\DoxyCodeLine{150     Kokkos::initialize(argc, argv);}
\DoxyCodeLine{151 }
\DoxyCodeLine{152     \textcolor{comment}{// Set up the program options}}
\DoxyCodeLine{153     po::options\_description desc(\textcolor{stringliteral}{"Allowed options"});}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     \textcolor{comment}{// Add options}}
\DoxyCodeLine{156     desc.add\_options()(\textcolor{stringliteral}{"help,h"}, \textcolor{stringliteral}{"Give some help with the program's options"});}
\DoxyCodeLine{157     \mbox{\hyperlink{structtraccc_1_1common__options}{traccc::common\_options}} common\_opts(desc);}
\DoxyCodeLine{158     \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc::detector\_input\_options}} det\_opts(desc);}
\DoxyCodeLine{159     \mbox{\hyperlink{structtraccc_1_1seeding__input__config}{traccc::seeding\_input\_config}} seeding\_input\_cfg(desc);}
\DoxyCodeLine{160     desc.add\_options()(\textcolor{stringliteral}{"run\_cpu"}, po::value<bool>()-\/>default\_value(\textcolor{keyword}{false}),}
\DoxyCodeLine{161                        \textcolor{stringliteral}{"run cpu tracking as well"});}
\DoxyCodeLine{162 }
\DoxyCodeLine{163     po::variables\_map vm;}
\DoxyCodeLine{164     po::store(po::parse\_command\_line(argc, argv, desc), vm);}
\DoxyCodeLine{165 }
\DoxyCodeLine{166     \textcolor{comment}{// Check errors}}
\DoxyCodeLine{167     \mbox{\hyperlink{namespacetraccc_a018e1f5ae8dbab3e118c08cfb905be01}{traccc::handle\_argument\_errors}}(vm, desc);}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     \textcolor{comment}{// Read options}}
\DoxyCodeLine{170     common\_opts.read(vm);}
\DoxyCodeLine{171     det\_opts.read(vm);}
\DoxyCodeLine{172 }
\DoxyCodeLine{173     seeding\_input\_cfg.read(vm);}
\DoxyCodeLine{174     \textcolor{keyword}{auto} run\_cpu = vm[\textcolor{stringliteral}{"run\_cpu"}].as<\textcolor{keywordtype}{bool}>();}
\DoxyCodeLine{175 }
\DoxyCodeLine{176     std::cout << \textcolor{stringliteral}{"Running "} << argv[0] << \textcolor{stringliteral}{" "} << det\_opts.detector\_file << \textcolor{stringliteral}{" "}}
\DoxyCodeLine{177               << common\_opts.input\_directory << \textcolor{stringliteral}{" "} << common\_opts.events}
\DoxyCodeLine{178               << std::endl;}
\DoxyCodeLine{179 }
\DoxyCodeLine{180     \textcolor{keywordtype}{int} ret = \mbox{\hyperlink{seeding__example__kokkos_8cpp_ad3e13c776783766978925394effe9d39}{seq\_run}}(seeding\_input\_cfg, common\_opts, det\_opts, run\_cpu);}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     \textcolor{comment}{// Finalise Kokkos.}}
\DoxyCodeLine{183     Kokkos::finalize();}
\DoxyCodeLine{184 }
\DoxyCodeLine{185     \textcolor{keywordflow}{return} ret;}
\DoxyCodeLine{186 \}}

\end{DoxyCode}


References traccc\+::detector\+\_\+input\+\_\+options\+::detector\+\_\+file, traccc\+::common\+\_\+options\+::events, traccc\+::handle\+\_\+argument\+\_\+errors(), traccc\+::common\+\_\+options\+::input\+\_\+directory, traccc\+::seeding\+\_\+input\+\_\+config\+::read(), traccc\+::detector\+\_\+input\+\_\+options\+::read(), traccc\+::common\+\_\+options\+::read(), and seq\+\_\+run().

\mbox{\Hypertarget{seeding__example__kokkos_8cpp_ad3e13c776783766978925394effe9d39}\label{seeding__example__kokkos_8cpp_ad3e13c776783766978925394effe9d39}} 
\index{seeding\_example\_kokkos.cpp@{seeding\_example\_kokkos.cpp}!seq\_run@{seq\_run}}
\index{seq\_run@{seq\_run}!seeding\_example\_kokkos.cpp@{seeding\_example\_kokkos.cpp}}
\doxysubsubsection{\texorpdfstring{seq\_run()}{seq\_run()}}
{\footnotesize\ttfamily int seq\+\_\+run (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structtraccc_1_1seeding__input__config}{traccc\+::seeding\+\_\+input\+\_\+config}} \&}]{,  }\item[{const \mbox{\hyperlink{structtraccc_1_1common__options}{traccc\+::common\+\_\+options}} \&}]{common\+\_\+opts,  }\item[{const \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc\+::detector\+\_\+input\+\_\+options}} \&}]{det\+\_\+opts,  }\item[{bool}]{run\+\_\+cpu }\end{DoxyParamCaption})}

T\+R\+A\+C\+CC library, part of the A\+C\+TS project (R\&D line)

(c) 2021-\/2022 C\+E\+RN for the benefit of the A\+C\+TS project

Mozilla Public License Version 2.\+0 
\begin{DoxyCode}{0}
\DoxyCodeLine{38                                                                         \{}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{comment}{// Read the surface transforms}}
\DoxyCodeLine{41     \textcolor{keyword}{auto} surface\_transforms = \mbox{\hyperlink{namespacetraccc_1_1io_a5a6c904c086473a05b85a0bf060bfa8d}{traccc::io::read\_geometry}}(det\_opts.\mbox{\hyperlink{structtraccc_1_1detector__input__options_a1121f57fa16a57c9d2cef56f94390bcb}{detector\_file}});}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \textcolor{comment}{// Output stats}}
\DoxyCodeLine{44     uint64\_t n\_modules = 0;}
\DoxyCodeLine{45     uint64\_t n\_spacepoints = 0;}
\DoxyCodeLine{46     uint64\_t n\_seeds = 0;}
\DoxyCodeLine{47     uint64\_t n\_seeds\_kokkos = 0;}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{comment}{// Configs}}
\DoxyCodeLine{50     \mbox{\hyperlink{structtraccc_1_1seedfinder__config}{traccc::seedfinder\_config}} finder\_config;}
\DoxyCodeLine{51     \mbox{\hyperlink{structtraccc_1_1spacepoint__grid__config}{traccc::spacepoint\_grid\_config}} grid\_config(finder\_config);}
\DoxyCodeLine{52     \mbox{\hyperlink{structtraccc_1_1seedfilter__config}{traccc::seedfilter\_config}} filter\_config;}
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{comment}{// Memory resources used by the application.}}
\DoxyCodeLine{55     vecmem::host\_memory\_resource host\_mr;}
\DoxyCodeLine{56     \mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc::memory\_resource}} mr\{host\_mr, \&host\_mr\};}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \mbox{\hyperlink{classtraccc_1_1seeding__algorithm}{traccc::seeding\_algorithm}} sa(finder\_config, grid\_config, filter\_config,}
\DoxyCodeLine{59                                  host\_mr);}
\DoxyCodeLine{60     \mbox{\hyperlink{classtraccc_1_1track__params__estimation}{traccc::track\_params\_estimation}} tp(host\_mr);}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     \textcolor{comment}{// KOKKOS Spacepoint Binning}}
\DoxyCodeLine{63     \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning}{traccc::kokkos::spacepoint\_binning}} m\_spacepoint\_binning(finder\_config,}
\DoxyCodeLine{64                                                             grid\_config, mr);}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     \textcolor{comment}{// performance writer}}
\DoxyCodeLine{67     \mbox{\hyperlink{classtraccc_1_1seeding__performance__writer}{traccc::seeding\_performance\_writer}} sd\_performance\_writer(}
\DoxyCodeLine{68         \mbox{\hyperlink{structtraccc_1_1seeding__performance__writer_1_1config}{traccc::seeding\_performance\_writer::config}}\{\});}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \mbox{\hyperlink{structtraccc_1_1performance_1_1timing__info}{traccc::performance::timing\_info}} elapsedTimes;}
\DoxyCodeLine{71 }
\DoxyCodeLine{72     \textcolor{comment}{// Loop over events}}
\DoxyCodeLine{73     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} = common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_ac0477bdb9a07bf525e12b006e141e094}{skip}};}
\DoxyCodeLine{74          \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} < common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_adefc317cdc0b846c7be8db1e5f0c3ef2}{events}} + common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_ac0477bdb9a07bf525e12b006e141e094}{skip}}; ++\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}) \{}
\DoxyCodeLine{75 }
\DoxyCodeLine{76         \mbox{\hyperlink{structtraccc_1_1io_1_1spacepoint__reader__output}{traccc::io::spacepoint\_reader\_output}} reader\_output(\&host\_mr);}
\DoxyCodeLine{77         traccc::seeding\_algorithm::output\_type seeds;}
\DoxyCodeLine{78         traccc::track\_params\_estimation::output\_type params;}
\DoxyCodeLine{79 }
\DoxyCodeLine{80         \{  \textcolor{comment}{// Start measuring wall time}}
\DoxyCodeLine{81             \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} wall\_t(\textcolor{stringliteral}{"Wall time"}, elapsedTimes);}
\DoxyCodeLine{82 }
\DoxyCodeLine{83             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{84 \textcolor{comment}{            hit file reading}}
\DoxyCodeLine{85 \textcolor{comment}{            -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{86             \{}
\DoxyCodeLine{87                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Hit reading  (cpu)"},}
\DoxyCodeLine{88                                              elapsedTimes);}
\DoxyCodeLine{89                 \textcolor{comment}{// Read the hits from the relevant event file}}
\DoxyCodeLine{90                 \mbox{\hyperlink{namespacetraccc_1_1io_afe49060da2ab77f49cfcd82308122f84}{traccc::io::read\_spacepoints}}(}
\DoxyCodeLine{91                     reader\_output, \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}, common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_aec17933699762e2feb58124cef53d6b2}{input\_directory}},}
\DoxyCodeLine{92                     surface\_transforms, common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_a290ad4675f5a976c73c2a05e35dd1b5c}{input\_data\_format}});}
\DoxyCodeLine{93             \}  \textcolor{comment}{// stop measuring hit reading timer}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95             \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::spacepoint\_collection\_types::host}}\& spacepoints\_per\_event =}
\DoxyCodeLine{96                 reader\_output.spacepoints;}
\DoxyCodeLine{97 }
\DoxyCodeLine{98             \{  \textcolor{comment}{// Spacepoin binning for kokkos}}
\DoxyCodeLine{99                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Spacepoint binning (kokkos)"},}
\DoxyCodeLine{100                                              elapsedTimes);}
\DoxyCodeLine{101                 m\_spacepoint\_binning(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(spacepoints\_per\_event));}
\DoxyCodeLine{102             \}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{105 \textcolor{comment}{                Seeding algorithm}}
\DoxyCodeLine{106 \textcolor{comment}{            -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108             \textcolor{comment}{// CPU}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110             \textcolor{keywordflow}{if} (run\_cpu) \{}
\DoxyCodeLine{111                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Seeding  (cpu)"}, elapsedTimes);}
\DoxyCodeLine{112                 seeds = sa(spacepoints\_per\_event);}
\DoxyCodeLine{113             \}  \textcolor{comment}{// stop measuring seeding cpu timer}}
\DoxyCodeLine{114 }
\DoxyCodeLine{115             \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{116 \textcolor{comment}{            Track params estimation}}
\DoxyCodeLine{117 \textcolor{comment}{            -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{118 }
\DoxyCodeLine{119             \textcolor{comment}{// CPU}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121             \textcolor{keywordflow}{if} (run\_cpu) \{}
\DoxyCodeLine{122                 \mbox{\hyperlink{classtraccc_1_1performance_1_1timer}{traccc::performance::timer}} t(\textcolor{stringliteral}{"Track params  (cpu)"},}
\DoxyCodeLine{123                                              elapsedTimes);}
\DoxyCodeLine{124                 params = tp(std::move(spacepoints\_per\_event), seeds,}
\DoxyCodeLine{125                             \{0.f, 0.f, finder\_config.\mbox{\hyperlink{structtraccc_1_1seedfinder__config_af3b9be46bd90bb968da94db6ac36bd45}{bFieldInZ}}\});}
\DoxyCodeLine{126             \}  \textcolor{comment}{// stop measuring track params cpu timer}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128         \}  \textcolor{comment}{// Stop measuring wall time}}
\DoxyCodeLine{129     \}}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{keywordflow}{if} (common\_opts.\mbox{\hyperlink{structtraccc_1_1common__options_a06a875a852f866c6ad5abfaae82cb440}{check\_performance}}) \{}
\DoxyCodeLine{132         sd\_performance\_writer.finalize();}
\DoxyCodeLine{133     \}}
\DoxyCodeLine{134 }
\DoxyCodeLine{135     std::cout << \textcolor{stringliteral}{"==> Statistics ... "} << std::endl;}
\DoxyCodeLine{136     std::cout << \textcolor{stringliteral}{"-\/ read    "} << n\_spacepoints << \textcolor{stringliteral}{" spacepoints from "}}
\DoxyCodeLine{137               << n\_modules << \textcolor{stringliteral}{" modules"} << std::endl;}
\DoxyCodeLine{138     std::cout << \textcolor{stringliteral}{"-\/ created (cpu)  "} << n\_seeds << \textcolor{stringliteral}{" seeds"} << std::endl;}
\DoxyCodeLine{139     std::cout << \textcolor{stringliteral}{"-\/ created (kokkos) "} << n\_seeds\_kokkos << \textcolor{stringliteral}{" seeds"}}
\DoxyCodeLine{140               << std::endl;}
\DoxyCodeLine{141     std::cout << \textcolor{stringliteral}{"==>Elapsed times...\(\backslash\)n"} << elapsedTimes << std::endl;}
\DoxyCodeLine{142 }
\DoxyCodeLine{143     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{144 \}}

\end{DoxyCode}


References traccc\+::seedfinder\+\_\+config\+::b\+Field\+InZ, traccc\+::common\+\_\+options\+::check\+\_\+performance, traccc\+::detector\+\_\+input\+\_\+options\+::detector\+\_\+file, event, traccc\+::common\+\_\+options\+::events, traccc\+::get\+\_\+data(), traccc\+::common\+\_\+options\+::input\+\_\+data\+\_\+format, traccc\+::common\+\_\+options\+::input\+\_\+directory, traccc\+::io\+::read\+\_\+geometry(), traccc\+::io\+::read\+\_\+spacepoints(), traccc\+::common\+\_\+options\+::skip, and traccc\+::io\+::spacepoint\+\_\+reader\+\_\+output\+::spacepoints.



Referenced by main().

