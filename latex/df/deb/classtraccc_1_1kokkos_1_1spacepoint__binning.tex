\hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning}{}\doxysection{traccc\+::kokkos\+::spacepoint\+\_\+binning Class Reference}
\label{classtraccc_1_1kokkos_1_1spacepoint__binning}\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}


Spacepoing binning executed on a Kokkos device.  




{\ttfamily \#include $<$spacepoint\+\_\+binning.\+hpp$>$}



Inheritance diagram for traccc\+::kokkos\+::spacepoint\+\_\+binning\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{d6/dee/classtraccc_1_1kokkos_1_1spacepoint__binning__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for traccc\+::kokkos\+::spacepoint\+\_\+binning\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d6/d40/classtraccc_1_1kokkos_1_1spacepoint__binning__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a79f03ca1d79b5dd7666af6ca94dd155d}{spacepoint\+\_\+binning}} (const \mbox{\hyperlink{structtraccc_1_1seedfinder__config}{seedfinder\+\_\+config}} \&config, const \mbox{\hyperlink{structtraccc_1_1spacepoint__grid__config}{spacepoint\+\_\+grid\+\_\+config}} \&grid\+\_\+config, const \mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc\+::memory\+\_\+resource}} \&mr)
\begin{DoxyCompactList}\small\item\em Constructor for the algorithm. \end{DoxyCompactList}\item 
output\+\_\+type \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a1ba66ab0c511ed951052cb28e1412d55}{operator()}} (const \mbox{\hyperlink{structtraccc_1_1collection__types_a6ef00cb04070f8f7954499bdaa71ddf0}{spacepoint\+\_\+collection\+\_\+types\+::const\+\_\+view}} \&spacepoints\+\_\+view) const override
\begin{DoxyCompactList}\small\item\em Function executing the algorithm with a a view of spacepoints. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{structtraccc_1_1seedfinder__config}{seedfinder\+\_\+config}} \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_acd578484411774a5db1ed909cb99eef2}{m\+\_\+config}}
\begin{DoxyCompactList}\small\item\em Member variables. \end{DoxyCompactList}\item 
std\+::pair$<$ sp\+\_\+grid\+::axis\+\_\+p0\+\_\+type, sp\+\_\+grid\+::axis\+\_\+p1\+\_\+type $>$ \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\+\_\+axes}}
\item 
\mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc\+::memory\+\_\+resource}} \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\+\_\+mr}}
\item 
std\+::unique\+\_\+ptr$<$ vecmem\+::copy $>$ \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}{m\+\_\+copy}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Spacepoing binning executed on a Kokkos device. 

\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning_a79f03ca1d79b5dd7666af6ca94dd155d}\label{classtraccc_1_1kokkos_1_1spacepoint__binning_a79f03ca1d79b5dd7666af6ca94dd155d}} 
\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}!spacepoint\_binning@{spacepoint\_binning}}
\index{spacepoint\_binning@{spacepoint\_binning}!traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}
\doxysubsubsection{\texorpdfstring{spacepoint\_binning()}{spacepoint\_binning()}}
{\footnotesize\ttfamily traccc\+::kokkos\+::spacepoint\+\_\+binning\+::spacepoint\+\_\+binning (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structtraccc_1_1seedfinder__config}{seedfinder\+\_\+config}} \&}]{config,  }\item[{const \mbox{\hyperlink{structtraccc_1_1spacepoint__grid__config}{spacepoint\+\_\+grid\+\_\+config}} \&}]{grid\+\_\+config,  }\item[{const \mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc\+::memory\+\_\+resource}} \&}]{mr }\end{DoxyParamCaption})}



Constructor for the algorithm. 


\begin{DoxyCode}{0}
\DoxyCodeLine{25     : \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_acd578484411774a5db1ed909cb99eef2}{m\_config}}(config), \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}(\mbox{\hyperlink{namespacetraccc_aaca8347dbd25b3fdfd7c864a7f90368a}{get\_axes}}(grid\_config, *(mr.\mbox{\hyperlink{structtraccc_1_1memory__resource_a3a7e6ce915149a10e37a9e9c6d73bf95}{host}}))), \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}(mr) \{}
\DoxyCodeLine{26     \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}{m\_copy}} = std::make\_unique<vecmem::copy>();}
\DoxyCodeLine{27 \}}

\end{DoxyCode}


References m\+\_\+copy.



\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning_a1ba66ab0c511ed951052cb28e1412d55}\label{classtraccc_1_1kokkos_1_1spacepoint__binning_a1ba66ab0c511ed951052cb28e1412d55}} 
\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}!operator()@{operator()}}
\index{operator()@{operator()}!traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}
\doxysubsubsection{\texorpdfstring{operator()()}{operator()()}}
{\footnotesize\ttfamily spacepoint\+\_\+binning\+::output\+\_\+type traccc\+::kokkos\+::spacepoint\+\_\+binning\+::operator() (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structtraccc_1_1collection__types_a6ef00cb04070f8f7954499bdaa71ddf0}{spacepoint\+\_\+collection\+\_\+types\+::const\+\_\+view}} \&}]{spacepoints\+\_\+view }\end{DoxyParamCaption}) const\hspace{0.3cm}{\ttfamily [override]}}



Function executing the algorithm with a a view of spacepoints. 


\begin{DoxyCode}{0}
\DoxyCodeLine{30                                                                          \{}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     \textcolor{comment}{// Get the spacepoint sizes from the view}}
\DoxyCodeLine{33     \textcolor{keyword}{auto} sp\_size = \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}{m\_copy}}-\/>get\_size(spacepoints\_view);}
\DoxyCodeLine{34 }
\DoxyCodeLine{35     \textcolor{comment}{// Set up the container that will be filled with the required capacities for}}
\DoxyCodeLine{36     \textcolor{comment}{// the spacepoint grid.}}
\DoxyCodeLine{37     \textcolor{keyword}{const} std::size\_t grid\_bins = \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}.first.n\_bins * \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}.second.n\_bins;}
\DoxyCodeLine{38     vecmem::data::vector\_buffer<unsigned int> grid\_capacities\_buff(grid\_bins,}
\DoxyCodeLine{39                                                                    \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}.\mbox{\hyperlink{structtraccc_1_1memory__resource_a9f1136a4fdab877dd1bbd1a2996e2149}{main}});}
\DoxyCodeLine{40     \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}{m\_copy}}-\/>setup(grid\_capacities\_buff);}
\DoxyCodeLine{41     \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}{m\_copy}}-\/>memset(grid\_capacities\_buff, 0);}
\DoxyCodeLine{42     vecmem::data::vector\_view<unsigned int> grid\_capacities\_view =}
\DoxyCodeLine{43         grid\_capacities\_buff;}
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \textcolor{comment}{// Calculate the number of threads and thread blocks to run the kernels for.}}
\DoxyCodeLine{46     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_threads = 32 * 8;}
\DoxyCodeLine{47     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} num\_blocks = (sp\_size + num\_threads -\/ 1) / num\_threads;}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     Kokkos::parallel\_for(}
\DoxyCodeLine{50         \textcolor{stringliteral}{"count\_grid\_capacities"}, \mbox{\hyperlink{namespacetraccc_1_1kokkos_a43ac393f6778d311ed5653ba3e46d44f}{team\_policy}}(num\_blocks, Kokkos::AUTO),}
\DoxyCodeLine{51         KOKKOS\_LAMBDA(\textcolor{keyword}{const} \mbox{\hyperlink{namespacetraccc_1_1kokkos_aa85b5e9d0a0b722037f7366d3162b43f}{member\_type}}\& team\_member) \{}
\DoxyCodeLine{52             Kokkos::parallel\_for(}
\DoxyCodeLine{53                 Kokkos::TeamThreadRange(team\_member, num\_threads),}
\DoxyCodeLine{54                 [\&](\textcolor{keyword}{const} \textcolor{keywordtype}{int}\& thr) \{}
\DoxyCodeLine{55                     \mbox{\hyperlink{namespacetraccc_1_1device_a28d9d10c00bd5852e135b3add3f873ab}{device::count\_grid\_capacities}}(}
\DoxyCodeLine{56                         team\_member.league\_rank() * team\_member.team\_size() +}
\DoxyCodeLine{57                             thr,}
\DoxyCodeLine{58                         \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_acd578484411774a5db1ed909cb99eef2}{m\_config}}, \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}.first, \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}.second, spacepoints\_view,}
\DoxyCodeLine{59                         grid\_capacities\_view);}
\DoxyCodeLine{60                 \});}
\DoxyCodeLine{61         \});}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{comment}{// Copy grid capacities back to the host}}
\DoxyCodeLine{64     vecmem::vector<unsigned int> grid\_capacities\_host(\mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}.\mbox{\hyperlink{structtraccc_1_1memory__resource_a3a7e6ce915149a10e37a9e9c6d73bf95}{host}} ? \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}.\mbox{\hyperlink{structtraccc_1_1memory__resource_a3a7e6ce915149a10e37a9e9c6d73bf95}{host}}}
\DoxyCodeLine{65                                                                 : \&(\mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}.\mbox{\hyperlink{structtraccc_1_1memory__resource_a9f1136a4fdab877dd1bbd1a2996e2149}{main}}));}
\DoxyCodeLine{66     (*m\_copy)(grid\_capacities\_buff, grid\_capacities\_host);}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \textcolor{comment}{// Create the grid buffer.}}
\DoxyCodeLine{69     \mbox{\hyperlink{namespacetraccc_a6f3edb21be66a15213280ee97867bf8c}{sp\_grid\_buffer}} grid\_buffer(}
\DoxyCodeLine{70         \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}.first, \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}{m\_axes}}.second,}
\DoxyCodeLine{71         std::vector<std::size\_t>(grid\_capacities\_host.begin(),}
\DoxyCodeLine{72                                  grid\_capacities\_host.end()),}
\DoxyCodeLine{73         \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}.\mbox{\hyperlink{structtraccc_1_1memory__resource_a9f1136a4fdab877dd1bbd1a2996e2149}{main}}, \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}{m\_mr}}.\mbox{\hyperlink{structtraccc_1_1memory__resource_a3a7e6ce915149a10e37a9e9c6d73bf95}{host}}, vecmem::data::buffer\_type::resizable);}
\DoxyCodeLine{74     \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}{m\_copy}}-\/>setup(grid\_buffer.\_buffer);}
\DoxyCodeLine{75     \mbox{\hyperlink{namespacetraccc_a5044143e89d8abc4a09e7829850cdfdc}{sp\_grid\_view}} grid\_view = grid\_buffer;}
\DoxyCodeLine{76 }
\DoxyCodeLine{77     \textcolor{comment}{// Populate the grid.}}
\DoxyCodeLine{78     Kokkos::parallel\_for(}
\DoxyCodeLine{79         \textcolor{stringliteral}{"populate\_grid"}, \mbox{\hyperlink{namespacetraccc_1_1kokkos_a43ac393f6778d311ed5653ba3e46d44f}{team\_policy}}(num\_blocks, Kokkos::AUTO),}
\DoxyCodeLine{80         KOKKOS\_LAMBDA(\textcolor{keyword}{const} \mbox{\hyperlink{namespacetraccc_1_1kokkos_aa85b5e9d0a0b722037f7366d3162b43f}{member\_type}}\& team\_member) \{}
\DoxyCodeLine{81             Kokkos::parallel\_for(}
\DoxyCodeLine{82                 Kokkos::TeamThreadRange(team\_member, num\_threads),}
\DoxyCodeLine{83                 [\&](\textcolor{keyword}{const} \textcolor{keywordtype}{int}\& thr) \{}
\DoxyCodeLine{84                     \mbox{\hyperlink{namespacetraccc_1_1device_ab5cd1251ac7c7ded70369df125d151e5}{device::populate\_grid}}(}
\DoxyCodeLine{85                         team\_member.league\_rank() * team\_member.team\_size() +}
\DoxyCodeLine{86                             thr,}
\DoxyCodeLine{87                         \mbox{\hyperlink{classtraccc_1_1kokkos_1_1spacepoint__binning_acd578484411774a5db1ed909cb99eef2}{m\_config}}, spacepoints\_view, grid\_view);}
\DoxyCodeLine{88                 \});}
\DoxyCodeLine{89         \});}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{comment}{// Return the freshly filled buffer.}}
\DoxyCodeLine{92     \textcolor{keywordflow}{return} grid\_buffer;}
\DoxyCodeLine{93 \}}

\end{DoxyCode}


References traccc\+::device\+::count\+\_\+grid\+\_\+capacities(), traccc\+::memory\+\_\+resource\+::host, m\+\_\+axes, m\+\_\+config, m\+\_\+copy, m\+\_\+mr, traccc\+::memory\+\_\+resource\+::main, and traccc\+::device\+::populate\+\_\+grid().



\doxysubsection{Member Data Documentation}
\mbox{\Hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}\label{classtraccc_1_1kokkos_1_1spacepoint__binning_afce7ab4187ace26738a8e52360294770}} 
\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}!m\_axes@{m\_axes}}
\index{m\_axes@{m\_axes}!traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}
\doxysubsubsection{\texorpdfstring{m\_axes}{m\_axes}}
{\footnotesize\ttfamily std\+::pair$<$sp\+\_\+grid\+::axis\+\_\+p0\+\_\+type, sp\+\_\+grid\+::axis\+\_\+p1\+\_\+type$>$ traccc\+::kokkos\+::spacepoint\+\_\+binning\+::m\+\_\+axes\hspace{0.3cm}{\ttfamily [private]}}



Referenced by operator()().

\mbox{\Hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning_acd578484411774a5db1ed909cb99eef2}\label{classtraccc_1_1kokkos_1_1spacepoint__binning_acd578484411774a5db1ed909cb99eef2}} 
\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}!m\_config@{m\_config}}
\index{m\_config@{m\_config}!traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}
\doxysubsubsection{\texorpdfstring{m\_config}{m\_config}}
{\footnotesize\ttfamily \mbox{\hyperlink{structtraccc_1_1seedfinder__config}{seedfinder\+\_\+config}} traccc\+::kokkos\+::spacepoint\+\_\+binning\+::m\+\_\+config\hspace{0.3cm}{\ttfamily [private]}}



Member variables. 



Referenced by operator()().

\mbox{\Hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}\label{classtraccc_1_1kokkos_1_1spacepoint__binning_a5a9a17bc9bfcb4e5b56bf404a0292de2}} 
\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}!m\_copy@{m\_copy}}
\index{m\_copy@{m\_copy}!traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}
\doxysubsubsection{\texorpdfstring{m\_copy}{m\_copy}}
{\footnotesize\ttfamily std\+::unique\+\_\+ptr$<$vecmem\+::copy$>$ traccc\+::kokkos\+::spacepoint\+\_\+binning\+::m\+\_\+copy\hspace{0.3cm}{\ttfamily [private]}}



Referenced by operator()(), and spacepoint\+\_\+binning().

\mbox{\Hypertarget{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}\label{classtraccc_1_1kokkos_1_1spacepoint__binning_ac11efee842671860ecc88349bfd6a351}} 
\index{traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}!m\_mr@{m\_mr}}
\index{m\_mr@{m\_mr}!traccc::kokkos::spacepoint\_binning@{traccc::kokkos::spacepoint\_binning}}
\doxysubsubsection{\texorpdfstring{m\_mr}{m\_mr}}
{\footnotesize\ttfamily \mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc\+::memory\+\_\+resource}} traccc\+::kokkos\+::spacepoint\+\_\+binning\+::m\+\_\+mr\hspace{0.3cm}{\ttfamily [private]}}



Referenced by operator()().



The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
device/kokkos/include/traccc/kokkos/seeding/\mbox{\hyperlink{device_2kokkos_2include_2traccc_2kokkos_2seeding_2spacepoint__binning_8hpp}{spacepoint\+\_\+binning.\+hpp}}\item 
device/kokkos/src/seeding/\mbox{\hyperlink{device_2kokkos_2src_2seeding_2spacepoint__binning_8cpp}{spacepoint\+\_\+binning.\+cpp}}\end{DoxyCompactItemize}
