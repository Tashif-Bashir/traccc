\hypertarget{ccl__example_8cpp}{}\doxysection{examples/run/cpu/ccl\+\_\+example.cpp File Reference}
\label{ccl__example_8cpp}\index{examples/run/cpu/ccl\_example.cpp@{examples/run/cpu/ccl\_example.cpp}}
{\ttfamily \#include \char`\"{}traccc/clusterization/component\+\_\+connection.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/edm/cell.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+cells.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$chrono$>$}\newline
{\ttfamily \#include $<$iomanip$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
Include dependency graph for ccl\+\_\+example.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{d0/dee/ccl__example_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{ccl__example_8cpp_a2cdf0dd8e610623a9a51a6688866a323}{print\+\_\+statistics}} (const \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc\+::cell\+\_\+collection\+\_\+types\+::host}} \&data)
\item 
void \mbox{\hyperlink{ccl__example_8cpp_a0a6e4e96cdabe3e32acf9fbf1b0a7099}{run\+\_\+on\+\_\+event}} (\mbox{\hyperlink{classtraccc_1_1component__connection}{traccc\+::component\+\_\+connection}} \&cc, \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc\+::cell\+\_\+collection\+\_\+types\+::host}} \&data)
\item 
int \mbox{\hyperlink{ccl__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{ccl__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{ccl__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{ccl\_example.cpp@{ccl\_example.cpp}!main@{main}}
\index{main@{main}!ccl\_example.cpp@{ccl\_example.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{91                                  \{}
\DoxyCodeLine{92     \textcolor{keywordflow}{if} (argc < 2) \{}
\DoxyCodeLine{93         std::cout << \textcolor{stringliteral}{"Not enough arguments, minimum requirement: "} << std::endl;}
\DoxyCodeLine{94         std::cout << argv[0] << \textcolor{stringliteral}{" <event\_file>"} << std::endl;}
\DoxyCodeLine{95         \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{96     \}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     std::string event\_file = std::string(argv[1]);}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     std::cout << \textcolor{stringliteral}{"Running "} << argv[0] << \textcolor{stringliteral}{" on "} << event\_file << std::endl;}
\DoxyCodeLine{101 }
\DoxyCodeLine{102     vecmem::host\_memory\_resource mem;}
\DoxyCodeLine{103 }
\DoxyCodeLine{104     \mbox{\hyperlink{classtraccc_1_1component__connection}{traccc::component\_connection}} cc(mem);}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     \textcolor{keyword}{auto} time\_read\_start = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{107 }
\DoxyCodeLine{108     \mbox{\hyperlink{structtraccc_1_1io_1_1cell__reader__output}{traccc::io::cell\_reader\_output}} readOut(\&mem);}
\DoxyCodeLine{109     \mbox{\hyperlink{namespacetraccc_1_1io_a4141a99f877738d68d63f85ed5642462}{traccc::io::read\_cells}}(readOut, event\_file);}
\DoxyCodeLine{110     \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::cell\_collection\_types::host}} data = readOut.cells;}
\DoxyCodeLine{111 }
\DoxyCodeLine{112     \textcolor{keyword}{auto} time\_read\_end = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \mbox{\hyperlink{ccl__example_8cpp_a2cdf0dd8e610623a9a51a6688866a323}{print\_statistics}}(data);}
\DoxyCodeLine{115 }
\DoxyCodeLine{116     \textcolor{keyword}{auto} time\_process\_p1 = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{117 }
\DoxyCodeLine{118     \mbox{\hyperlink{ccl__example_8cpp_a0a6e4e96cdabe3e32acf9fbf1b0a7099}{run\_on\_event}}(cc, data);}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{keyword}{auto} time\_process\_p2 = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keywordflow}{for} (std::size\_t i = 0; i < 10; ++i) \{}
\DoxyCodeLine{123         \mbox{\hyperlink{ccl__example_8cpp_a0a6e4e96cdabe3e32acf9fbf1b0a7099}{run\_on\_event}}(cc, data);}
\DoxyCodeLine{124     \}}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     \textcolor{keyword}{auto} time\_process\_p3 = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \mbox{\hyperlink{ccl__example_8cpp_a0a6e4e96cdabe3e32acf9fbf1b0a7099}{run\_on\_event}}(cc, data);}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     \textcolor{keyword}{auto} time\_process\_p4 = std::chrono::high\_resolution\_clock::now();}
\DoxyCodeLine{131 }
\DoxyCodeLine{132     std::cout << \textcolor{stringliteral}{"\(\backslash\)nCPU budget allocation"} << std::endl;}
\DoxyCodeLine{133     std::cout << std::fixed;}
\DoxyCodeLine{134     std::cout << std::setw(13) << \textcolor{stringliteral}{"Component"}}
\DoxyCodeLine{135               << \textcolor{stringliteral}{" | "} << std::setw(13) << \textcolor{stringliteral}{"Runtime"} << std::endl;}
\DoxyCodeLine{136     std::cout << std::setw(13) << \textcolor{stringliteral}{"Data loading"}}
\DoxyCodeLine{137               << \textcolor{stringliteral}{" | "} << std::setw(10) << std::setprecision(3)}
\DoxyCodeLine{138               << delta\_ms(time\_read\_start, time\_read\_end) << \textcolor{stringliteral}{" ms"} << std::endl;}
\DoxyCodeLine{139     std::cout << std::setw(13) << \textcolor{stringliteral}{"Statistics"}}
\DoxyCodeLine{140               << \textcolor{stringliteral}{" | "} << std::setw(10) << std::setprecision(3)}
\DoxyCodeLine{141               << delta\_ms(time\_read\_end, time\_process\_p1) << \textcolor{stringliteral}{" ms"} << std::endl;}
\DoxyCodeLine{142     std::cout << std::setw(13) << \textcolor{stringliteral}{"Cold run"}}
\DoxyCodeLine{143               << \textcolor{stringliteral}{" | "} << std::setw(10) << std::setprecision(3)}
\DoxyCodeLine{144               << delta\_ms(time\_process\_p1, time\_process\_p2) << \textcolor{stringliteral}{" ms"}}
\DoxyCodeLine{145               << std::endl;}
\DoxyCodeLine{146     std::cout << std::setw(13) << \textcolor{stringliteral}{"Heating"}}
\DoxyCodeLine{147               << \textcolor{stringliteral}{" | "} << std::setw(10) << std::setprecision(3)}
\DoxyCodeLine{148               << delta\_ms(time\_process\_p2, time\_process\_p3) << \textcolor{stringliteral}{" ms"}}
\DoxyCodeLine{149               << std::endl;}
\DoxyCodeLine{150     std::cout << std::setw(13) << \textcolor{stringliteral}{"Hot run"}}
\DoxyCodeLine{151               << \textcolor{stringliteral}{" | "} << std::setw(10) << std::setprecision(3)}
\DoxyCodeLine{152               << delta\_ms(time\_process\_p3, time\_process\_p4) << \textcolor{stringliteral}{" ms"}}
\DoxyCodeLine{153               << std::endl;}
\DoxyCodeLine{154     std::cout << std::setw(13) << \textcolor{stringliteral}{"Total"}}
\DoxyCodeLine{155               << \textcolor{stringliteral}{" | "} << std::setw(10) << std::setprecision(3)}
\DoxyCodeLine{156               << delta\_ms(time\_read\_start, time\_process\_p4) << \textcolor{stringliteral}{" ms"}}
\DoxyCodeLine{157               << std::endl;}
\DoxyCodeLine{158 }
\DoxyCodeLine{159     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{160 \}}

\end{DoxyCode}


References traccc\+::io\+::cell\+\_\+reader\+\_\+output\+::cells, print\+\_\+statistics(), traccc\+::io\+::read\+\_\+cells(), and run\+\_\+on\+\_\+event().

\mbox{\Hypertarget{ccl__example_8cpp_a2cdf0dd8e610623a9a51a6688866a323}\label{ccl__example_8cpp_a2cdf0dd8e610623a9a51a6688866a323}} 
\index{ccl\_example.cpp@{ccl\_example.cpp}!print\_statistics@{print\_statistics}}
\index{print\_statistics@{print\_statistics}!ccl\_example.cpp@{ccl\_example.cpp}}
\doxysubsubsection{\texorpdfstring{print\_statistics()}{print\_statistics()}}
{\footnotesize\ttfamily void print\+\_\+statistics (\begin{DoxyParamCaption}\item[{const \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc\+::cell\+\_\+collection\+\_\+types\+::host}} \&}]{data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{32                                                                    \{}
\DoxyCodeLine{33     \textcolor{keyword}{static} std::vector<std::size\_t> bins\_edges = \{}
\DoxyCodeLine{34         0,   1,   2,    3,    4,    6,    8,    11,   16,}
\DoxyCodeLine{35         23,  32,  45,   64,   91,   128,  181,  256,  362,}
\DoxyCodeLine{36         512, 724, 1024, 1448, 2048, 2896, 4096, 5793, 8192\};}
\DoxyCodeLine{37 }
\DoxyCodeLine{38     \textcolor{keyword}{static} std::size\_t max\_width = 50;}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     std::vector<std::size\_t> bins(bins\_edges.size());}
\DoxyCodeLine{41 }
\DoxyCodeLine{42     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} last = std::numeric\_limits<unsigned int>::max();}
\DoxyCodeLine{43     std::size\_t count = 0;}
\DoxyCodeLine{44     \textcolor{keywordflow}{for} (std::size\_t i = 0; i < data.size(); ++i) \{}
\DoxyCodeLine{45         \textcolor{keywordflow}{if} (last == data.at(i).module\_link) \{}
\DoxyCodeLine{46             count++;}
\DoxyCodeLine{47         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{48             \textcolor{keywordflow}{for} (std::size\_t j = 0; j < bins\_edges.size(); ++j) \{}
\DoxyCodeLine{49                 \textcolor{keywordflow}{if} (count >= bins\_edges[j] \&\&}
\DoxyCodeLine{50                     (j + 1 >= bins\_edges.size() || count < bins\_edges[j + 1])) \{}
\DoxyCodeLine{51                     ++bins[j];}
\DoxyCodeLine{52                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{53                 \}}
\DoxyCodeLine{54             \}}
\DoxyCodeLine{55             count = 1;}
\DoxyCodeLine{56             last = data.at(i).module\_link;}
\DoxyCodeLine{57         \}}
\DoxyCodeLine{58     \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60     std::size\_t max = *std::max\_element(bins.begin(), bins.end());}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     std::size\_t per\_pixel = std::max(\textcolor{keyword}{static\_cast<}std::size\_t\textcolor{keyword}{>}(1),}
\DoxyCodeLine{63                                      (max + (max \% max\_width)) / max\_width);}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     std::cout << \textcolor{stringliteral}{"\(\backslash\)nNon-\/zero pixels per module"} << std::endl;}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     std::cout << std::setw(5) << \textcolor{stringliteral}{"Min"}}
\DoxyCodeLine{68               << \textcolor{stringliteral}{"   "} << std::setw(5) << \textcolor{stringliteral}{"Max"}}
\DoxyCodeLine{69               << \textcolor{stringliteral}{" | "} << std::setw(5) << \textcolor{stringliteral}{"Count"} << std::endl;}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \textcolor{keywordflow}{for} (std::size\_t i = 0; i < bins.size(); ++i) \{}
\DoxyCodeLine{72         std::cout << std::setw(5) << bins\_edges[i] << \textcolor{stringliteral}{" -\/ "} << std::setw(5)}
\DoxyCodeLine{73                   << (i + 1 >= bins.size()}
\DoxyCodeLine{74                           ? \textcolor{stringliteral}{"inf"}}
\DoxyCodeLine{75                           : std::to\_string(bins\_edges[i + 1] -\/ 1))}
\DoxyCodeLine{76                   << \textcolor{stringliteral}{" | "} << std::setw(5) << bins[i] << \textcolor{stringliteral}{" "};}
\DoxyCodeLine{77 }
\DoxyCodeLine{78         \textcolor{keywordflow}{for} (std::size\_t j = 0; j < bins[i]; j += per\_pixel) \{}
\DoxyCodeLine{79             std::cout << \textcolor{stringliteral}{"*"};}
\DoxyCodeLine{80         \}}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         std::cout << std::endl;}
\DoxyCodeLine{83     \}}
\DoxyCodeLine{84 \}}

\end{DoxyCode}


Referenced by main().

\mbox{\Hypertarget{ccl__example_8cpp_a0a6e4e96cdabe3e32acf9fbf1b0a7099}\label{ccl__example_8cpp_a0a6e4e96cdabe3e32acf9fbf1b0a7099}} 
\index{ccl\_example.cpp@{ccl\_example.cpp}!run\_on\_event@{run\_on\_event}}
\index{run\_on\_event@{run\_on\_event}!ccl\_example.cpp@{ccl\_example.cpp}}
\doxysubsubsection{\texorpdfstring{run\_on\_event()}{run\_on\_event()}}
{\footnotesize\ttfamily void run\+\_\+on\+\_\+event (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classtraccc_1_1component__connection}{traccc\+::component\+\_\+connection}} \&}]{cc,  }\item[{\mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc\+::cell\+\_\+collection\+\_\+types\+::host}} \&}]{data }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{87                                                          \{}
\DoxyCodeLine{88     \mbox{\hyperlink{classtraccc_1_1host__container}{traccc::cluster\_container\_types::host}} clusters = cc(data);}
\DoxyCodeLine{89 \}}

\end{DoxyCode}


Referenced by main().

