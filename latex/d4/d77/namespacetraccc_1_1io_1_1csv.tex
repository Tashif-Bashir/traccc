\hypertarget{namespacetraccc_1_1io_1_1csv}{}\doxysection{traccc\+::io\+::csv Namespace Reference}
\label{namespacetraccc_1_1io_1_1csv}\index{traccc::io::csv@{traccc::io::csv}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1cell}{cell}}
\begin{DoxyCompactList}\small\item\em Type used in reading C\+SV data into memory. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1hit}{hit}}
\begin{DoxyCompactList}\small\item\em Type to read information into about Fatras hits. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement}{measurement}}
\begin{DoxyCompactList}\small\item\em Type used in reading C\+SV measurement data into memory. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement__hit__id}{measurement\+\_\+hit\+\_\+id}}
\begin{DoxyCompactList}\small\item\em Type used in reading C\+SV measurement-\/to-\/hit ID data into memory. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1particle}{particle}}
\begin{DoxyCompactList}\small\item\em Type used in reading C\+SV particle data into memory. \end{DoxyCompactList}\item 
struct \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1surface}{surface}}
\begin{DoxyCompactList}\small\item\em Type to read information into about the detector modules/surfaces. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1cell}{cell}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_afdfeac15c66ef46f6840215fab184ffa}{make\+\_\+cell\+\_\+reader}} (std\+::string\+\_\+view filename)
\item 
dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1hit}{hit}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a4f447705f5bd897a7eab36031c7b0b17}{make\+\_\+hit\+\_\+reader}} (std\+::string\+\_\+view filename)
\item 
dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement__hit__id}{measurement\+\_\+hit\+\_\+id}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a3390a7ecd8afaffdda14bed42c3efa44}{make\+\_\+measurement\+\_\+hit\+\_\+id\+\_\+reader}} (std\+::string\+\_\+view filename)
\item 
dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement}{measurement}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_ae3c884413c744e37ef9d9d790d220d73}{make\+\_\+measurement\+\_\+reader}} (std\+::string\+\_\+view filename)
\item 
dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1particle}{particle}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a6340c500b0195045437e7ab40b3f37fd}{make\+\_\+particle\+\_\+reader}} (std\+::string\+\_\+view filename)
\item 
dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1surface}{surface}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a89eeb6a019a8e1f70f63d33c9a0172de}{make\+\_\+surface\+\_\+reader}} (std\+::string\+\_\+view filename)
\item 
void \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a705f60cbf8cb352c49a54f991294a0f9}{read\+\_\+cells}} (\mbox{\hyperlink{structtraccc_1_1io_1_1cell__reader__output}{cell\+\_\+reader\+\_\+output}} \&out, std\+::string\+\_\+view filename, const \mbox{\hyperlink{namespacetraccc_aa72ada2d62d62e47ad400d82e42f13b2}{geometry}} $\ast$geom, const \mbox{\hyperlink{namespacetraccc_a49d32a4a500a84b0d0a13e18568e18e7}{digitization\+\_\+config}} $\ast$dconfig)
\item 
void \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a936624d8e25bb46b8971d90208395cf6}{read\+\_\+measurements}} (\mbox{\hyperlink{structtraccc_1_1io_1_1measurement__reader__output}{measurement\+\_\+reader\+\_\+output}} \&out, std\+::string\+\_\+view filename, const bool do\+\_\+sort)
\item 
\mbox{\hyperlink{structtraccc_1_1container__types_a9585c833c648097a3bdc8f228a78954e}{measurement\+\_\+container\+\_\+types\+::host}} \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_acd2002704fdd1fe76529855bfe24bb3d}{read\+\_\+measurements\+\_\+container}} (std\+::string\+\_\+view filename, vecmem\+::memory\+\_\+resource $\ast$mr)
\item 
\mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{particle\+\_\+collection\+\_\+types\+::host}} \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a64b48f13e5957c7085e5e3ee6eb255e9}{read\+\_\+particles}} (std\+::string\+\_\+view filename, vecmem\+::memory\+\_\+resource $\ast$mr)
\item 
void \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a29a923a41cfa524bf507a92860f0a9d7}{read\+\_\+spacepoints}} (\mbox{\hyperlink{structtraccc_1_1io_1_1spacepoint__reader__output}{spacepoint\+\_\+reader\+\_\+output}} \&out, std\+::string\+\_\+view filename, std\+::string\+\_\+view meas\+\_\+filename, std\+::string\+\_\+view meas\+\_\+hit\+\_\+map\+\_\+filename, const \mbox{\hyperlink{namespacetraccc_aa72ada2d62d62e47ad400d82e42f13b2}{geometry}} \&geom)
\item 
std\+::map$<$ \mbox{\hyperlink{namespacetraccc_a394d22a5b5acbd46fadc0da0491c6913}{geometry\+\_\+id}}, \mbox{\hyperlink{namespacetraccc_a7d1f91ecd225f32ea85349bf0bc8adb8}{transform3}} $>$ \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a2c02c2a3e24fd0bdeaba820a353b347d}{read\+\_\+surfaces}} (std\+::string\+\_\+view filename)
\begin{DoxyCompactList}\small\item\em Read the geometry information per module and fill into a map. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
T\+R\+A\+C\+CC library, part of the A\+C\+TS project (R\&D line)

(c) 2022 C\+E\+RN for the benefit of the A\+C\+TS project

Mozilla Public License Version 2.\+0

T\+R\+A\+C\+CC library, part of the A\+C\+TS project (R\&D line)

(c) 2023 C\+E\+RN for the benefit of the A\+C\+TS project

Mozilla Public License Version 2.\+0 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_afdfeac15c66ef46f6840215fab184ffa}\label{namespacetraccc_1_1io_1_1csv_afdfeac15c66ef46f6840215fab184ffa}} 
\index{traccc::io::csv@{traccc::io::csv}!make\_cell\_reader@{make\_cell\_reader}}
\index{make\_cell\_reader@{make\_cell\_reader}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{make\_cell\_reader()}{make\_cell\_reader()}}
{\footnotesize\ttfamily dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1cell}{cell}} $>$ traccc\+::io\+::csv\+::make\+\_\+cell\+\_\+reader (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}

Set up an object for reading a C\+SV file containing cell information


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An object that can read the specified C\+SV file 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{13                                                                        \{}
\DoxyCodeLine{14 }
\DoxyCodeLine{15     \textcolor{keywordflow}{return} \{}
\DoxyCodeLine{16         filename.data(),}
\DoxyCodeLine{17         \{\textcolor{stringliteral}{"geometry\_id"}, \textcolor{stringliteral}{"hit\_id"}, \textcolor{stringliteral}{"cannel0"}, \textcolor{stringliteral}{"channel1"}, \textcolor{stringliteral}{"timestamp"}, \textcolor{stringliteral}{"value"}\}\};}
\DoxyCodeLine{18 \}}

\end{DoxyCode}


Referenced by traccc\+::generate\+\_\+hit\+\_\+cell\+\_\+map(), and read\+\_\+cells().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a4f447705f5bd897a7eab36031c7b0b17}\label{namespacetraccc_1_1io_1_1csv_a4f447705f5bd897a7eab36031c7b0b17}} 
\index{traccc::io::csv@{traccc::io::csv}!make\_hit\_reader@{make\_hit\_reader}}
\index{make\_hit\_reader@{make\_hit\_reader}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{make\_hit\_reader()}{make\_hit\_reader()}}
{\footnotesize\ttfamily dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1hit}{hit}} $>$ traccc\+::io\+::csv\+::make\+\_\+hit\+\_\+reader (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}

Set up an object for reading a C\+SV file containing hit information


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An object that can read the specified C\+SV file 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{13                                                                      \{}
\DoxyCodeLine{14 }
\DoxyCodeLine{15     \textcolor{keywordflow}{return} \{filename.data(),}
\DoxyCodeLine{16             \{\textcolor{stringliteral}{"particle\_id"}, \textcolor{stringliteral}{"geometry\_id"}, \textcolor{stringliteral}{"tx"}, \textcolor{stringliteral}{"ty"}, \textcolor{stringliteral}{"tz"}, \textcolor{stringliteral}{"tt"}, \textcolor{stringliteral}{"tpx"}, \textcolor{stringliteral}{"tpy"},}
\DoxyCodeLine{17              \textcolor{stringliteral}{"tpz"}, \textcolor{stringliteral}{"te"}, \textcolor{stringliteral}{"deltapx"}, \textcolor{stringliteral}{"deltapy"}, \textcolor{stringliteral}{"deltapz"}, \textcolor{stringliteral}{"deltae"}, \textcolor{stringliteral}{"index"}\}\};}
\DoxyCodeLine{18 \}}

\end{DoxyCode}


Referenced by traccc\+::event\+\_\+map2\+::event\+\_\+map2(), traccc\+::generate\+\_\+hit\+\_\+map(), traccc\+::generate\+\_\+hit\+\_\+particle\+\_\+map(), G\+T\+E\+S\+T\+\_\+\+T\+E\+S\+T(), and read\+\_\+spacepoints().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a3390a7ecd8afaffdda14bed42c3efa44}\label{namespacetraccc_1_1io_1_1csv_a3390a7ecd8afaffdda14bed42c3efa44}} 
\index{traccc::io::csv@{traccc::io::csv}!make\_measurement\_hit\_id\_reader@{make\_measurement\_hit\_id\_reader}}
\index{make\_measurement\_hit\_id\_reader@{make\_measurement\_hit\_id\_reader}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{make\_measurement\_hit\_id\_reader()}{make\_measurement\_hit\_id\_reader()}}
{\footnotesize\ttfamily dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement__hit__id}{measurement\+\_\+hit\+\_\+id}} $>$ traccc\+::io\+::csv\+::make\+\_\+measurement\+\_\+hit\+\_\+id\+\_\+reader (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}

Set up a reader for measurement$<$-\/$>$hit association information


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An object that can read the specified C\+SV file 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{14                              \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16     \textcolor{keywordflow}{return} \{filename.data(), \{\textcolor{stringliteral}{"measurement\_id"}, \textcolor{stringliteral}{"hit\_id"}\}\};}
\DoxyCodeLine{17 \}}

\end{DoxyCode}


Referenced by traccc\+::event\+\_\+map2\+::event\+\_\+map2(), traccc\+::generate\+\_\+hit\+\_\+map(), G\+T\+E\+S\+T\+\_\+\+T\+E\+S\+T(), and read\+\_\+spacepoints().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_ae3c884413c744e37ef9d9d790d220d73}\label{namespacetraccc_1_1io_1_1csv_ae3c884413c744e37ef9d9d790d220d73}} 
\index{traccc::io::csv@{traccc::io::csv}!make\_measurement\_reader@{make\_measurement\_reader}}
\index{make\_measurement\_reader@{make\_measurement\_reader}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{make\_measurement\_reader()}{make\_measurement\_reader()}}
{\footnotesize\ttfamily dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement}{measurement}} $>$ traccc\+::io\+::csv\+::make\+\_\+measurement\+\_\+reader (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}

Set up an object for reading a C\+SV file containing measurement information


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An object that can read the specified C\+SV file 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{14                              \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16     \textcolor{keywordflow}{return} \{filename.data(),}
\DoxyCodeLine{17             \{\textcolor{stringliteral}{"measurement\_id"}, \textcolor{stringliteral}{"geometry\_id"}, \textcolor{stringliteral}{"local\_key"}, \textcolor{stringliteral}{"local0"}, \textcolor{stringliteral}{"local1"},}
\DoxyCodeLine{18              \textcolor{stringliteral}{"phi"}, \textcolor{stringliteral}{"theta"}, \textcolor{stringliteral}{"time"}, \textcolor{stringliteral}{"var\_local0"}, \textcolor{stringliteral}{"var\_local1"}, \textcolor{stringliteral}{"var\_phi"},}
\DoxyCodeLine{19              \textcolor{stringliteral}{"var\_theta"}, \textcolor{stringliteral}{"var\_time"}\}\};}
\DoxyCodeLine{20 \}}

\end{DoxyCode}


Referenced by traccc\+::event\+\_\+map2\+::event\+\_\+map2(), G\+T\+E\+S\+T\+\_\+\+T\+E\+S\+T(), read\+\_\+measurements(), read\+\_\+measurements\+\_\+container(), and T\+E\+S\+T\+\_\+\+P().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a6340c500b0195045437e7ab40b3f37fd}\label{namespacetraccc_1_1io_1_1csv_a6340c500b0195045437e7ab40b3f37fd}} 
\index{traccc::io::csv@{traccc::io::csv}!make\_particle\_reader@{make\_particle\_reader}}
\index{make\_particle\_reader@{make\_particle\_reader}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{make\_particle\_reader()}{make\_particle\_reader()}}
{\footnotesize\ttfamily dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1particle}{particle}} $>$ traccc\+::io\+::csv\+::make\+\_\+particle\+\_\+reader (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}

Set up an object for reading a C\+SV file containing particle information


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An object that can read the specified C\+SV file 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{14                              \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16     \textcolor{keywordflow}{return} \{filename.data(),}
\DoxyCodeLine{17             \{\textcolor{stringliteral}{"particle\_id"}, \textcolor{stringliteral}{"particle\_type"}, \textcolor{stringliteral}{"process"}, \textcolor{stringliteral}{"vx"}, \textcolor{stringliteral}{"vy"}, \textcolor{stringliteral}{"vz"}, \textcolor{stringliteral}{"vt"},}
\DoxyCodeLine{18              \textcolor{stringliteral}{"px"}, \textcolor{stringliteral}{"py"}, \textcolor{stringliteral}{"pz"}, \textcolor{stringliteral}{"m"}, \textcolor{stringliteral}{"q"}\}\};}
\DoxyCodeLine{19 \}}

\end{DoxyCode}


Referenced by traccc\+::event\+\_\+map2\+::event\+\_\+map2(), traccc\+::generate\+\_\+particle\+\_\+map(), G\+T\+E\+S\+T\+\_\+\+T\+E\+S\+T(), and read\+\_\+particles().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a89eeb6a019a8e1f70f63d33c9a0172de}\label{namespacetraccc_1_1io_1_1csv_a89eeb6a019a8e1f70f63d33c9a0172de}} 
\index{traccc::io::csv@{traccc::io::csv}!make\_surface\_reader@{make\_surface\_reader}}
\index{make\_surface\_reader@{make\_surface\_reader}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{make\_surface\_reader()}{make\_surface\_reader()}}
{\footnotesize\ttfamily dfe\+::\+Named\+Tuple\+Csv\+Reader$<$ \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1surface}{surface}} $>$ traccc\+::io\+::csv\+::make\+\_\+surface\+\_\+reader (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}

Set up an object for reading a C\+SV file containing surface information


\begin{DoxyParams}{Parameters}
{\em filename} & The name of the file to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
An object that can read the specified C\+SV file 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{14                              \{}
\DoxyCodeLine{15 }
\DoxyCodeLine{16     \textcolor{keywordflow}{return} \{filename.data(),}
\DoxyCodeLine{17             \{\textcolor{stringliteral}{"geometry\_id"}, \textcolor{stringliteral}{"cx"}, \textcolor{stringliteral}{"cy"}, \textcolor{stringliteral}{"cz"}, \textcolor{stringliteral}{"rot\_xu"}, \textcolor{stringliteral}{"rot\_xv"}, \textcolor{stringliteral}{"rot\_xw"},}
\DoxyCodeLine{18              \textcolor{stringliteral}{"rot\_zu"}, \textcolor{stringliteral}{"rot\_zv"}, \textcolor{stringliteral}{"rot\_zw"}\}\};}
\DoxyCodeLine{19 \}}

\end{DoxyCode}


Referenced by read\+\_\+surfaces().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a705f60cbf8cb352c49a54f991294a0f9}\label{namespacetraccc_1_1io_1_1csv_a705f60cbf8cb352c49a54f991294a0f9}} 
\index{traccc::io::csv@{traccc::io::csv}!read\_cells@{read\_cells}}
\index{read\_cells@{read\_cells}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{read\_cells()}{read\_cells()}}
{\footnotesize\ttfamily void traccc\+::io\+::csv\+::read\+\_\+cells (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structtraccc_1_1io_1_1cell__reader__output}{cell\+\_\+reader\+\_\+output}} \&}]{out,  }\item[{std\+::string\+\_\+view}]{filename,  }\item[{const \mbox{\hyperlink{namespacetraccc_aa72ada2d62d62e47ad400d82e42f13b2}{geometry}} $\ast$}]{geom = {\ttfamily nullptr},  }\item[{const \mbox{\hyperlink{namespacetraccc_a49d32a4a500a84b0d0a13e18568e18e7}{digitization\+\_\+config}} $\ast$}]{dconfig = {\ttfamily nullptr} }\end{DoxyParamCaption})}

Read cell information from a specific C\+SV file


\begin{DoxyParams}{Parameters}
{\em out} & A cell (host) collection \& a \mbox{\hyperlink{structtraccc_1_1cell__module}{cell\+\_\+module}} collection \\
\hline
{\em filename} & The file to read the cell data from \\
\hline
{\em geom} & The description of the detector geometry \\
\hline
{\em dconfig} & The detector\textquotesingle{}s digitization configuration \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{78                                                                           \{}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{comment}{// Construct the cell reader object.}}
\DoxyCodeLine{81     \textcolor{keyword}{auto} reader = \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_afdfeac15c66ef46f6840215fab184ffa}{make\_cell\_reader}}(filename);}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \textcolor{comment}{// Create cell counter vector.}}
\DoxyCodeLine{84     std::vector<unsigned int> cellCounts;}
\DoxyCodeLine{85     cellCounts.reserve(5000);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     cell\_module\_collection\_types::host\& result\_modules = out.modules;}
\DoxyCodeLine{88     result\_modules.reserve(5000);}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     \textcolor{comment}{// Create a cell collection, which holds on to a flat list of all the cells}}
\DoxyCodeLine{91     \textcolor{comment}{// and the position of their respective cell counter \& module.}}
\DoxyCodeLine{92     std::vector<std::pair<csv::cell, unsigned int>> allCells;}
\DoxyCodeLine{93     allCells.reserve(50000);}
\DoxyCodeLine{94 }
\DoxyCodeLine{95     \textcolor{comment}{// Read all cells from input file.}}
\DoxyCodeLine{96     csv::cell iocell;}
\DoxyCodeLine{97     \textcolor{keywordflow}{while} (reader.read(iocell)) \{}
\DoxyCodeLine{98 }
\DoxyCodeLine{99         \textcolor{comment}{// Look for current module in cell counter vector.}}
\DoxyCodeLine{100         \textcolor{keyword}{auto} rit = std::find\_if(result\_modules.rbegin(), result\_modules.rend(),}
\DoxyCodeLine{101                                 [\&iocell](\textcolor{keyword}{const} cell\_module\& mod) \{}
\DoxyCodeLine{102                                     return mod.surface\_link.value() ==}
\DoxyCodeLine{103                                            iocell.geometry\_id;}
\DoxyCodeLine{104                                 \});}
\DoxyCodeLine{105         \textcolor{keywordflow}{if} (rit == result\_modules.rend()) \{}
\DoxyCodeLine{106             \textcolor{comment}{// Add new cell and new cell counter if a new module is found}}
\DoxyCodeLine{107             \textcolor{keyword}{const} cell\_module mod = get\_module(iocell, geom, dconfig);}
\DoxyCodeLine{108             allCells.push\_back(\{iocell, result\_modules.size()\});}
\DoxyCodeLine{109             result\_modules.push\_back(mod);}
\DoxyCodeLine{110             cellCounts.push\_back(1);}
\DoxyCodeLine{111         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{112             \textcolor{comment}{// Add a new cell and update cell counter if repeat module is found}}
\DoxyCodeLine{113             \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} pos =}
\DoxyCodeLine{114                 std::distance(result\_modules.begin(), rit.base()) -\/ 1;}
\DoxyCodeLine{115             allCells.push\_back(\{iocell, pos\});}
\DoxyCodeLine{116             ++(cellCounts[pos]);}
\DoxyCodeLine{117         \}}
\DoxyCodeLine{118     \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{120     \textcolor{comment}{// Transform the cellCounts vector into a prefix sum for accessing}}
\DoxyCodeLine{121     \textcolor{comment}{// positions in the result vector.}}
\DoxyCodeLine{122     std::partial\_sum(cellCounts.begin(), cellCounts.end(), cellCounts.begin());}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     \textcolor{comment}{// The total number cells.}}
\DoxyCodeLine{125     \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} totalCells = allCells.size();}
\DoxyCodeLine{126 }
\DoxyCodeLine{127     \textcolor{comment}{// Construct the result collection.}}
\DoxyCodeLine{128     cell\_collection\_types::host\& result\_cells = out.cells;}
\DoxyCodeLine{129     result\_cells.resize(totalCells);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     \textcolor{comment}{// Member "-\/1" of the prefix sum vector}}
\DoxyCodeLine{132     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} nCellsZero = 0;}
\DoxyCodeLine{133     \textcolor{comment}{// Fill the result object with the read csv cells}}
\DoxyCodeLine{134     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < totalCells; ++i) \{}
\DoxyCodeLine{135         \textcolor{keyword}{const} csv::cell\& c = allCells[i].first;}
\DoxyCodeLine{136 }
\DoxyCodeLine{137         \textcolor{comment}{// The position of the cell counter this cell belongs to}}
\DoxyCodeLine{138         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\& counterPos = allCells[i].second;}
\DoxyCodeLine{139 }
\DoxyCodeLine{140         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}\& prefix\_sum\_previous =}
\DoxyCodeLine{141             counterPos == 0 ? nCellsZero : cellCounts[counterPos -\/ 1];}
\DoxyCodeLine{142         result\_cells[prefix\_sum\_previous++] = \mbox{\hyperlink{structtraccc_1_1cell}{traccc::cell}}\{}
\DoxyCodeLine{143             c.\mbox{\hyperlink{structtraccc_1_1cell_a921955d3f678441f9aad6d55ebf0a706}{channel0}}, c.channel1, c.value, c.timestamp, counterPos\};}
\DoxyCodeLine{144     \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{146     \textcolor{keywordflow}{if} (cellCounts.size() == 0) \{}
\DoxyCodeLine{147         \textcolor{keywordflow}{return};}
\DoxyCodeLine{148     \}}
\DoxyCodeLine{149     \textcolor{comment}{/* This is might look a bit overcomplicated, and could be made simpler by}}
\DoxyCodeLine{150 \textcolor{comment}{     * having a copy of the prefix sum vector before incrementing its value when}}
\DoxyCodeLine{151 \textcolor{comment}{     * filling the vector. however this seems more efficient, but requires}}
\DoxyCodeLine{152 \textcolor{comment}{     * manually setting the 1st \& 2nd modules instead of just the 1st.}}
\DoxyCodeLine{153 \textcolor{comment}{     */}}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     \textcolor{comment}{// Sort the cells belonging to the first module.}}
\DoxyCodeLine{156     std::sort(result\_cells.begin(), result\_cells.begin() + nCellsZero, comp);}
\DoxyCodeLine{157     \textcolor{comment}{// Sort the cells belonging to the second module.}}
\DoxyCodeLine{158     std::sort(result\_cells.begin() + nCellsZero,}
\DoxyCodeLine{159               result\_cells.begin() + cellCounts[0], comp);}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     \textcolor{comment}{// Sort cells belonging to all other modules.}}
\DoxyCodeLine{162     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 1; i < cellCounts.size() -\/ 1; ++i) \{}
\DoxyCodeLine{163         std::sort(result\_cells.begin() + cellCounts[i -\/ 1],}
\DoxyCodeLine{164                   result\_cells.begin() + cellCounts[i], comp);}
\DoxyCodeLine{165     \}}
\DoxyCodeLine{166 \}}

\end{DoxyCode}


References traccc\+::io\+::cell\+\_\+reader\+\_\+output\+::cells, traccc\+::io\+::csv\+::cell\+::channel0, traccc\+::io\+::csv\+::cell\+::channel1, make\+\_\+cell\+\_\+reader(), traccc\+::io\+::cell\+\_\+reader\+\_\+output\+::modules, traccc\+::io\+::csv\+::cell\+::timestamp, and traccc\+::io\+::csv\+::cell\+::value.



Referenced by traccc\+::io\+::read\+\_\+cells().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a936624d8e25bb46b8971d90208395cf6}\label{namespacetraccc_1_1io_1_1csv_a936624d8e25bb46b8971d90208395cf6}} 
\index{traccc::io::csv@{traccc::io::csv}!read\_measurements@{read\_measurements}}
\index{read\_measurements@{read\_measurements}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{read\_measurements()}{read\_measurements()}}
{\footnotesize\ttfamily void traccc\+::io\+::csv\+::read\+\_\+measurements (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structtraccc_1_1io_1_1measurement__reader__output}{measurement\+\_\+reader\+\_\+output}} \&}]{out,  }\item[{std\+::string\+\_\+view}]{filename,  }\item[{const bool}]{do\+\_\+sort = {\ttfamily true} }\end{DoxyParamCaption})}

Read measurement information from a specific C\+SV file


\begin{DoxyParams}{Parameters}
{\em out} & A measurement \& a \mbox{\hyperlink{structtraccc_1_1cell__module}{cell\+\_\+module}} (host) collections \\
\hline
{\em filename} & The file to read the measurement data from \\
\hline
{\em do\+\_\+sort} & Whether to sort the measurements or not \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{22                                                                     \{}
\DoxyCodeLine{23 }
\DoxyCodeLine{24     \textcolor{comment}{// Construct the measurement reader object.}}
\DoxyCodeLine{25     \textcolor{keyword}{auto} reader = \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_ae3c884413c744e37ef9d9d790d220d73}{make\_measurement\_reader}}(filename);}
\DoxyCodeLine{26 }
\DoxyCodeLine{27     \textcolor{comment}{// Create the result collection.}}
\DoxyCodeLine{28     measurement\_collection\_types::host\& result\_measurements = out.measurements;}
\DoxyCodeLine{29     cell\_module\_collection\_types::host\& result\_modules = out.modules;}
\DoxyCodeLine{30 }
\DoxyCodeLine{31     std::map<geometry\_id, unsigned int> m;}
\DoxyCodeLine{32 }
\DoxyCodeLine{33     \textcolor{comment}{// Read the measurements from the input file.}}
\DoxyCodeLine{34     csv::measurement iomeas;}
\DoxyCodeLine{35     \textcolor{keywordflow}{while} (reader.read(iomeas)) \{}
\DoxyCodeLine{36 }
\DoxyCodeLine{37         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} link;}
\DoxyCodeLine{38         \textcolor{keyword}{auto} it = m.find(iomeas.geometry\_id);}
\DoxyCodeLine{39 }
\DoxyCodeLine{40         \textcolor{keywordflow}{if} (it != m.end()) \{}
\DoxyCodeLine{41             link = (*it).second;}
\DoxyCodeLine{42         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{43             link = result\_modules.size();}
\DoxyCodeLine{44             m[iomeas.geometry\_id] = link;}
\DoxyCodeLine{45             cell\_module mod;}
\DoxyCodeLine{46             mod.surface\_link = detray::geometry::barcode\{iomeas.geometry\_id\};}
\DoxyCodeLine{47             result\_modules.push\_back(mod);}
\DoxyCodeLine{48         \}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50         \textcolor{comment}{// Construct the measurement object.}}
\DoxyCodeLine{51         \mbox{\hyperlink{structtraccc_1_1measurement}{traccc::measurement}} meas;}
\DoxyCodeLine{52         std::array<typename transform3::size\_type, 2u> indices\{0u, 0u\};}
\DoxyCodeLine{53         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a4e1196fbe4ff3927aefc3fdd7b0edd9e}{meas\_dim}} = 0u;}
\DoxyCodeLine{54 }
\DoxyCodeLine{55         \textcolor{comment}{// Local key is a 8 bit char and first and last bit are dummy value. 2 -\/}}
\DoxyCodeLine{56         \textcolor{comment}{// 7th bits are for 6 bound track parameters.}}
\DoxyCodeLine{57         \textcolor{comment}{// Ex1) 0000010 or 2 -\/> meas dim = 1 and [loc0] active -\/> strip or wire}}
\DoxyCodeLine{58         \textcolor{comment}{// Ex2) 0000110 or 6 -\/> meas dim = 2 and [loc0, loc1] active -\/> pixel}}
\DoxyCodeLine{59         \textcolor{comment}{// Ex3) 0000100 or 4 -\/> meas dim = 1 and [loc1] active -\/> annulus}}
\DoxyCodeLine{60         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} ipar = 0; ipar < 2u; ++ipar) \{}
\DoxyCodeLine{61             \textcolor{keywordflow}{if} (((iomeas.local\_key) \& (1 << (ipar + 1))) != 0) \{}
\DoxyCodeLine{62 }
\DoxyCodeLine{63                 \textcolor{keywordflow}{switch} (ipar) \{}
\DoxyCodeLine{64                     \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacetraccc_a65f3496a079e9bdcffaf1d62a5fa4151a7c442b5fe12d5f43c76e4a0adc56d8d4}{e\_bound\_loc0}}: \{}
\DoxyCodeLine{65                         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a23d5f297b506857cafa3feb88c06540c}{local}}[0] = iomeas.local0;}
\DoxyCodeLine{66                         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a9a72a589749a42bfec083a61bc1f6b7a}{variance}}[0] = iomeas.var\_local0;}
\DoxyCodeLine{67                         indices[meas.\mbox{\hyperlink{structtraccc_1_1measurement_a4e1196fbe4ff3927aefc3fdd7b0edd9e}{meas\_dim}}++] = ipar;}
\DoxyCodeLine{68                     \}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{69                     \textcolor{keywordflow}{case} \mbox{\hyperlink{namespacetraccc_a65f3496a079e9bdcffaf1d62a5fa4151a1c164e6843bf2d09b171fdae4c8ec682}{e\_bound\_loc1}}: \{}
\DoxyCodeLine{70                         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a23d5f297b506857cafa3feb88c06540c}{local}}[1] = iomeas.local1;}
\DoxyCodeLine{71                         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a9a72a589749a42bfec083a61bc1f6b7a}{variance}}[1] = iomeas.var\_local1;}
\DoxyCodeLine{72                         indices[meas.\mbox{\hyperlink{structtraccc_1_1measurement_a4e1196fbe4ff3927aefc3fdd7b0edd9e}{meas\_dim}}++] = ipar;}
\DoxyCodeLine{73                     \}; \textcolor{keywordflow}{break};}
\DoxyCodeLine{74                 \}}
\DoxyCodeLine{75             \}}
\DoxyCodeLine{76         \}}
\DoxyCodeLine{77 }
\DoxyCodeLine{78         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a2d6c1a3c814e6a1af385d142d00c4c7a}{subs}}.\mbox{\hyperlink{structtraccc_1_1subspace_a0f7555492f6d578604930482e85dad18}{set\_indices}}(indices);}
\DoxyCodeLine{79         meas.\mbox{\hyperlink{structtraccc_1_1measurement_a8f03b72057618e536bffa637f70f84d0}{surface\_link}} = detray::geometry::barcode\{iomeas.geometry\_id\};}
\DoxyCodeLine{80         meas.\mbox{\hyperlink{structtraccc_1_1measurement_afe3a50efe16166506b7877d898e200aa}{module\_link}} = link;}
\DoxyCodeLine{81 }
\DoxyCodeLine{82         result\_measurements.push\_back(meas);}
\DoxyCodeLine{83     \}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85     \textcolor{keywordflow}{if} (do\_sort) \{}
\DoxyCodeLine{86         std::sort(result\_measurements.begin(), result\_measurements.end(),}
\DoxyCodeLine{87                   measurement\_sort\_comp());}
\DoxyCodeLine{88     \}}
\DoxyCodeLine{89 \}}

\end{DoxyCode}


References traccc\+::e\+\_\+bound\+\_\+loc0, traccc\+::e\+\_\+bound\+\_\+loc1, traccc\+::io\+::csv\+::measurement\+::geometry\+\_\+id, traccc\+::measurement\+::local, traccc\+::io\+::csv\+::measurement\+::local0, traccc\+::io\+::csv\+::measurement\+::local1, traccc\+::io\+::csv\+::measurement\+::local\+\_\+key, make\+\_\+measurement\+\_\+reader(), traccc\+::measurement\+::meas\+\_\+dim, traccc\+::io\+::measurement\+\_\+reader\+\_\+output\+::measurements, traccc\+::measurement\+::module\+\_\+link, traccc\+::io\+::measurement\+\_\+reader\+\_\+output\+::modules, traccc\+::subspace$<$ algebra\+\_\+t, k\+Full\+Size, k\+Size $>$\+::set\+\_\+indices(), traccc\+::measurement\+::subs, traccc\+::cell\+\_\+module\+::surface\+\_\+link, traccc\+::measurement\+::surface\+\_\+link, traccc\+::io\+::csv\+::measurement\+::var\+\_\+local0, traccc\+::io\+::csv\+::measurement\+::var\+\_\+local1, and traccc\+::measurement\+::variance.



Referenced by traccc\+::io\+::read\+\_\+measurements(), and read\+\_\+spacepoints().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_acd2002704fdd1fe76529855bfe24bb3d}\label{namespacetraccc_1_1io_1_1csv_acd2002704fdd1fe76529855bfe24bb3d}} 
\index{traccc::io::csv@{traccc::io::csv}!read\_measurements\_container@{read\_measurements\_container}}
\index{read\_measurements\_container@{read\_measurements\_container}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{read\_measurements\_container()}{read\_measurements\_container()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structtraccc_1_1container__types_a9585c833c648097a3bdc8f228a78954e}{measurement\+\_\+container\+\_\+types\+::host}} traccc\+::io\+::csv\+::read\+\_\+measurements\+\_\+container (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename,  }\item[{vecmem\+::memory\+\_\+resource $\ast$}]{mr }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{92                                                         \{}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{comment}{// Construct the measurement reader object.}}
\DoxyCodeLine{95     \textcolor{keyword}{auto} reader = \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_ae3c884413c744e37ef9d9d790d220d73}{make\_measurement\_reader}}(filename);}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{comment}{// Create the result container.}}
\DoxyCodeLine{98     measurement\_container\_types::host result;}
\DoxyCodeLine{99     \textcolor{keywordflow}{if} (mr != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{100         result = measurement\_container\_types::host\{mr\};}
\DoxyCodeLine{101     \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103     \textcolor{comment}{// Read the measurements from the input file.}}
\DoxyCodeLine{104     csv::measurement iomeas;}
\DoxyCodeLine{105     \textcolor{keywordflow}{while} (reader.read(iomeas)) \{}
\DoxyCodeLine{106 }
\DoxyCodeLine{107         \textcolor{comment}{// Construct the module ID for the measurement.}}
\DoxyCodeLine{108         cell\_module module;}
\DoxyCodeLine{109         module.surface\_link = detray::geometry::barcode\{iomeas.geometry\_id\};}
\DoxyCodeLine{110 }
\DoxyCodeLine{111         \textcolor{comment}{// Construct the measurement object.}}
\DoxyCodeLine{112         \textcolor{keyword}{const} \mbox{\hyperlink{structtraccc_1_1measurement}{traccc::measurement}} meas\{}
\DoxyCodeLine{113             \mbox{\hyperlink{namespacetraccc_a83ee72b67d3c03df43280e5bc169ac7a}{point2}}\{iomeas.local0, iomeas.local1\},}
\DoxyCodeLine{114             \mbox{\hyperlink{namespacetraccc_a2aeabf50e47440329fae3b12310967d1}{variance2}}\{iomeas.var\_local0, iomeas.var\_local1\},}
\DoxyCodeLine{115             detray::geometry::barcode\{iomeas.geometry\_id\}\};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117         \textcolor{comment}{// Find the detector module that this measurement belongs to.}}
\DoxyCodeLine{118         \textcolor{keyword}{const} measurement\_container\_types::host::header\_vector\& headers =}
\DoxyCodeLine{119             result.get\_headers();}
\DoxyCodeLine{120         \textcolor{keyword}{auto} rit = std::find(headers.rbegin(), headers.rend(), module);}
\DoxyCodeLine{121 }
\DoxyCodeLine{122         \textcolor{comment}{// Add the measurement to the correct place in the container.}}
\DoxyCodeLine{123         \textcolor{keywordflow}{if} (rit == headers.rend()) \{}
\DoxyCodeLine{124             \textcolor{keywordflow}{if} (mr != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{125                 result.push\_back(}
\DoxyCodeLine{126                     module,}
\DoxyCodeLine{127                     measurement\_container\_types::host::item\_vector::value\_type(}
\DoxyCodeLine{128                         \{meas\}, mr));}
\DoxyCodeLine{129             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{130                 result.push\_back(}
\DoxyCodeLine{131                     module,}
\DoxyCodeLine{132                     measurement\_container\_types::host::item\_vector::value\_type(}
\DoxyCodeLine{133                         \{meas\}));}
\DoxyCodeLine{134             \}}
\DoxyCodeLine{135         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{136             \textcolor{comment}{// The reverse iterator.base() returns the equivalent normal}}
\DoxyCodeLine{137             \textcolor{comment}{// iterator shifted by 1, so that the (r)end and (r)begin iterators}}
\DoxyCodeLine{138             \textcolor{comment}{// match consistently, due to the extra past-\/the-\/last element}}
\DoxyCodeLine{139             \textcolor{keyword}{auto} idx = std::distance(headers.begin(), rit.base()) -\/ 1;}
\DoxyCodeLine{140             result.at(idx).items.push\_back(meas);}
\DoxyCodeLine{141         \}}
\DoxyCodeLine{142     \}}
\DoxyCodeLine{143 }
\DoxyCodeLine{144     \textcolor{comment}{// Return the container.}}
\DoxyCodeLine{145     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{146 \}}

\end{DoxyCode}


References traccc\+::io\+::csv\+::measurement\+::geometry\+\_\+id, traccc\+::io\+::csv\+::measurement\+::local0, traccc\+::io\+::csv\+::measurement\+::local1, make\+\_\+measurement\+\_\+reader(), traccc\+::cell\+\_\+module\+::surface\+\_\+link, traccc\+::io\+::csv\+::measurement\+::var\+\_\+local0, and traccc\+::io\+::csv\+::measurement\+::var\+\_\+local1.

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a64b48f13e5957c7085e5e3ee6eb255e9}\label{namespacetraccc_1_1io_1_1csv_a64b48f13e5957c7085e5e3ee6eb255e9}} 
\index{traccc::io::csv@{traccc::io::csv}!read\_particles@{read\_particles}}
\index{read\_particles@{read\_particles}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{read\_particles()}{read\_particles()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{particle\+\_\+collection\+\_\+types\+::host}} traccc\+::io\+::csv\+::read\+\_\+particles (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename,  }\item[{vecmem\+::memory\+\_\+resource $\ast$}]{mr = {\ttfamily nullptr} }\end{DoxyParamCaption})}

Read particle information from a specific C\+SV file


\begin{DoxyParams}{Parameters}
{\em filename} & The file to read the particle data from \\
\hline
{\em mr} & The memory resource to create the host collection with \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A particle (host) collection 
\end{DoxyReturn}

\begin{DoxyCode}{0}
\DoxyCodeLine{16                                                                           \{}
\DoxyCodeLine{17 }
\DoxyCodeLine{18     \textcolor{comment}{// Construct the particle reader object.}}
\DoxyCodeLine{19     \textcolor{keyword}{auto} reader = \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a6340c500b0195045437e7ab40b3f37fd}{make\_particle\_reader}}(filename);}
\DoxyCodeLine{20 }
\DoxyCodeLine{21     \textcolor{comment}{// Create the result collection.}}
\DoxyCodeLine{22     particle\_collection\_types::host result;}
\DoxyCodeLine{23     \textcolor{keywordflow}{if} (mr != \textcolor{keyword}{nullptr}) \{}
\DoxyCodeLine{24         result = particle\_collection\_types::host\{mr\};}
\DoxyCodeLine{25     \}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27     \textcolor{comment}{// Read the particles from the input file.}}
\DoxyCodeLine{28     csv::particle part;}
\DoxyCodeLine{29     \textcolor{keywordflow}{while} (reader.read(part)) \{}
\DoxyCodeLine{30         result.push\_back(\{part.particle\_id, part.particle\_type, part.process,}
\DoxyCodeLine{31                           \mbox{\hyperlink{namespacetraccc_a7a1ed25524ba151f7ee54cec655fb3f3}{point3}}\{part.vx, part.vy, part.vz\}, part.vt,}
\DoxyCodeLine{32                           \mbox{\hyperlink{namespacetraccc_a3e92464c509aa7ac245244b6083357c2}{vector3}}\{part.px, part.py, part.pz\}, part.m, part.q\});}
\DoxyCodeLine{33     \}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35     \textcolor{comment}{// Return the collection.}}
\DoxyCodeLine{36     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{37 \}}

\end{DoxyCode}


References traccc\+::io\+::csv\+::particle\+::m, make\+\_\+particle\+\_\+reader(), traccc\+::io\+::csv\+::particle\+::particle\+\_\+id, traccc\+::io\+::csv\+::particle\+::particle\+\_\+type, traccc\+::io\+::csv\+::particle\+::process, traccc\+::io\+::csv\+::particle\+::px, traccc\+::io\+::csv\+::particle\+::py, traccc\+::io\+::csv\+::particle\+::pz, traccc\+::io\+::csv\+::particle\+::q, traccc\+::io\+::csv\+::particle\+::vt, traccc\+::io\+::csv\+::particle\+::vx, traccc\+::io\+::csv\+::particle\+::vy, and traccc\+::io\+::csv\+::particle\+::vz.



Referenced by traccc\+::io\+::read\+\_\+particles().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a29a923a41cfa524bf507a92860f0a9d7}\label{namespacetraccc_1_1io_1_1csv_a29a923a41cfa524bf507a92860f0a9d7}} 
\index{traccc::io::csv@{traccc::io::csv}!read\_spacepoints@{read\_spacepoints}}
\index{read\_spacepoints@{read\_spacepoints}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{read\_spacepoints()}{read\_spacepoints()}}
{\footnotesize\ttfamily void traccc\+::io\+::csv\+::read\+\_\+spacepoints (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structtraccc_1_1io_1_1spacepoint__reader__output}{spacepoint\+\_\+reader\+\_\+output}} \&}]{out,  }\item[{std\+::string\+\_\+view}]{filename,  }\item[{std\+::string\+\_\+view}]{meas\+\_\+filename,  }\item[{std\+::string\+\_\+view}]{meas\+\_\+hit\+\_\+map\+\_\+filename,  }\item[{const \mbox{\hyperlink{namespacetraccc_aa72ada2d62d62e47ad400d82e42f13b2}{geometry}} \&}]{geom }\end{DoxyParamCaption})}

Read spacepoint information from a specific C\+SV file


\begin{DoxyParams}{Parameters}
{\em out} & A spacepoint \& a \mbox{\hyperlink{structtraccc_1_1cell__module}{cell\+\_\+module}} (host) collections \\
\hline
{\em filename} & The file to read the spacepoint data from \\
\hline
{\em geom} & The description of the detector geometry \\
\hline
\end{DoxyParams}

\begin{DoxyCode}{0}
\DoxyCodeLine{27                                             \{}
\DoxyCodeLine{28     \textcolor{comment}{// Read measurements}}
\DoxyCodeLine{29     measurement\_reader\_output meas\_reader\_out;}
\DoxyCodeLine{30     \mbox{\hyperlink{namespacetraccc_1_1io_a84e36824b32d23770ed527b25f810307}{read\_measurements}}(meas\_reader\_out, meas\_filename, \textcolor{keyword}{false});}
\DoxyCodeLine{31 }
\DoxyCodeLine{32     \textcolor{comment}{// Measurement hit id reader}}
\DoxyCodeLine{33     \textcolor{keyword}{auto} mhid\_reader =}
\DoxyCodeLine{34         \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a3390a7ecd8afaffdda14bed42c3efa44}{io::csv::make\_measurement\_hit\_id\_reader}}(meas\_hit\_map\_filename);}
\DoxyCodeLine{35     std::vector<traccc::io::csv::measurement\_hit\_id> measurement\_hit\_ids;}
\DoxyCodeLine{36     \mbox{\hyperlink{structtraccc_1_1io_1_1csv_1_1measurement__hit__id}{traccc::io::csv::measurement\_hit\_id}} io\_mh\_id;}
\DoxyCodeLine{37     \textcolor{keywordflow}{while} (mhid\_reader.read(io\_mh\_id)) \{}
\DoxyCodeLine{38         measurement\_hit\_ids.push\_back(io\_mh\_id);}
\DoxyCodeLine{39     \}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41     \textcolor{comment}{// Construct the spacepoint reader object.}}
\DoxyCodeLine{42     \textcolor{keyword}{auto} reader = \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a4f447705f5bd897a7eab36031c7b0b17}{make\_hit\_reader}}(filename);}
\DoxyCodeLine{43 }
\DoxyCodeLine{44     \textcolor{comment}{// Create the result collection.}}
\DoxyCodeLine{45     spacepoint\_collection\_types::host\& result\_spacepoints = out.spacepoints;}
\DoxyCodeLine{46     cell\_module\_collection\_types::host\& result\_modules = out.modules;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     std::map<geometry\_id, unsigned int> m;}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{comment}{// Read the spacepoints from the input file.}}
\DoxyCodeLine{51     hit iohit;}
\DoxyCodeLine{52     \textcolor{keywordflow}{while} (reader.read(iohit)) \{}
\DoxyCodeLine{53         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} link;}
\DoxyCodeLine{54         \textcolor{keyword}{auto} it = m.find(iohit.geometry\_id);}
\DoxyCodeLine{55         \textcolor{keywordflow}{if} (it != m.end()) \{}
\DoxyCodeLine{56             link = (*it).second;}
\DoxyCodeLine{57         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{58             link = result\_modules.size();}
\DoxyCodeLine{59             m[iohit.geometry\_id] = link;}
\DoxyCodeLine{60             cell\_module mod;}
\DoxyCodeLine{61             mod.surface\_link = detray::geometry::barcode\{iohit.geometry\_id\};}
\DoxyCodeLine{62             mod.placement = geom[iohit.geometry\_id];}
\DoxyCodeLine{63             result\_modules.push\_back(mod);}
\DoxyCodeLine{64         \}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66         \textcolor{comment}{// Construct the global 3D position of the spacepoint.}}
\DoxyCodeLine{67         \textcolor{keyword}{const} \mbox{\hyperlink{namespacetraccc_a7a1ed25524ba151f7ee54cec655fb3f3}{point3}} pos\{iohit.tx, iohit.ty, iohit.tz\};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         \textcolor{comment}{// Construct the local 3D(2D) position of the measurement.}}
\DoxyCodeLine{70         measurement meas;}
\DoxyCodeLine{71         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto} \textcolor{keyword}{const} [meas\_id, \mbox{\hyperlink{namespacetraccc_a29bad86bf1e312ec4db45ee5d1065ca1}{hit\_id}}] : measurement\_hit\_ids) \{}
\DoxyCodeLine{72             \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetraccc_a29bad86bf1e312ec4db45ee5d1065ca1}{hit\_id}} == result\_spacepoints.size()) \{}
\DoxyCodeLine{73                 meas = meas\_reader\_out.measurements[meas\_id];}
\DoxyCodeLine{74             \}}
\DoxyCodeLine{75         \}}
\DoxyCodeLine{76 }
\DoxyCodeLine{77         \textcolor{comment}{// Create the spacepoint object (with its member measurement) from all}}
\DoxyCodeLine{78         \textcolor{comment}{// this information.}}
\DoxyCodeLine{79         \textcolor{keyword}{const} \mbox{\hyperlink{structtraccc_1_1spacepoint}{traccc::spacepoint}} sp\{pos, meas\};}
\DoxyCodeLine{80 }
\DoxyCodeLine{81         result\_spacepoints.push\_back(sp);}
\DoxyCodeLine{82     \}}
\DoxyCodeLine{83 \}}

\end{DoxyCode}


References traccc\+::io\+::csv\+::hit\+::geometry\+\_\+id, make\+\_\+hit\+\_\+reader(), make\+\_\+measurement\+\_\+hit\+\_\+id\+\_\+reader(), traccc\+::io\+::measurement\+\_\+reader\+\_\+output\+::measurements, traccc\+::io\+::spacepoint\+\_\+reader\+\_\+output\+::modules, traccc\+::cell\+\_\+module\+::placement, read\+\_\+measurements(), traccc\+::io\+::spacepoint\+\_\+reader\+\_\+output\+::spacepoints, traccc\+::cell\+\_\+module\+::surface\+\_\+link, traccc\+::io\+::csv\+::hit\+::tx, traccc\+::io\+::csv\+::hit\+::ty, and traccc\+::io\+::csv\+::hit\+::tz.



Referenced by traccc\+::io\+::read\+\_\+spacepoints().

\mbox{\Hypertarget{namespacetraccc_1_1io_1_1csv_a2c02c2a3e24fd0bdeaba820a353b347d}\label{namespacetraccc_1_1io_1_1csv_a2c02c2a3e24fd0bdeaba820a353b347d}} 
\index{traccc::io::csv@{traccc::io::csv}!read\_surfaces@{read\_surfaces}}
\index{read\_surfaces@{read\_surfaces}!traccc::io::csv@{traccc::io::csv}}
\doxysubsubsection{\texorpdfstring{read\_surfaces()}{read\_surfaces()}}
{\footnotesize\ttfamily std\+::map$<$ \mbox{\hyperlink{namespacetraccc_a394d22a5b5acbd46fadc0da0491c6913}{geometry\+\_\+id}}, \mbox{\hyperlink{namespacetraccc_a7d1f91ecd225f32ea85349bf0bc8adb8}{transform3}} $>$ traccc\+::io\+::csv\+::read\+\_\+surfaces (\begin{DoxyParamCaption}\item[{std\+::string\+\_\+view}]{filename }\end{DoxyParamCaption})}



Read the geometry information per module and fill into a map. 


\begin{DoxyCode}{0}
\DoxyCodeLine{18                                                                        \{}
\DoxyCodeLine{19 }
\DoxyCodeLine{20     \textcolor{comment}{// Construct the surface reader object.}}
\DoxyCodeLine{21     \textcolor{keyword}{auto} reader = \mbox{\hyperlink{namespacetraccc_1_1io_1_1csv_a89eeb6a019a8e1f70f63d33c9a0172de}{make\_surface\_reader}}(filename);}
\DoxyCodeLine{22 }
\DoxyCodeLine{23     \textcolor{comment}{// Fill an std::map with entries from the file.}}
\DoxyCodeLine{24     std::map<geometry\_id, transform3> result;}
\DoxyCodeLine{25     surface surf;}
\DoxyCodeLine{26     \textcolor{keywordflow}{while} (reader.read(surf)) \{}
\DoxyCodeLine{27         result.insert(}
\DoxyCodeLine{28             \{surf.geometry\_id,}
\DoxyCodeLine{29              \mbox{\hyperlink{namespacetraccc_a7d1f91ecd225f32ea85349bf0bc8adb8}{transform3}}\{\mbox{\hyperlink{namespacetraccc_a3e92464c509aa7ac245244b6083357c2}{vector3}}\{surf.cx, surf.cy, surf.cz\},}
\DoxyCodeLine{30                         \mbox{\hyperlink{namespacetraccc_a3e92464c509aa7ac245244b6083357c2}{vector3}}\{surf.rot\_xw, surf.rot\_yw, surf.rot\_zw\},}
\DoxyCodeLine{31                         \mbox{\hyperlink{namespacetraccc_a3e92464c509aa7ac245244b6083357c2}{vector3}}\{surf.rot\_xu, surf.rot\_yu, surf.rot\_zu\}\}\});}
\DoxyCodeLine{32     \}}
\DoxyCodeLine{33     \textcolor{keywordflow}{return} result;}
\DoxyCodeLine{34 \}}

\end{DoxyCode}


References traccc\+::io\+::csv\+::surface\+::cx, traccc\+::io\+::csv\+::surface\+::cy, traccc\+::io\+::csv\+::surface\+::cz, traccc\+::io\+::csv\+::surface\+::geometry\+\_\+id, make\+\_\+surface\+\_\+reader(), traccc\+::io\+::csv\+::surface\+::rot\+\_\+xu, traccc\+::io\+::csv\+::surface\+::rot\+\_\+xw, traccc\+::io\+::csv\+::surface\+::rot\+\_\+yu, traccc\+::io\+::csv\+::surface\+::rot\+\_\+yw, traccc\+::io\+::csv\+::surface\+::rot\+\_\+zu, and traccc\+::io\+::csv\+::surface\+::rot\+\_\+zw.



Referenced by traccc\+::io\+::details\+::read\+\_\+surfaces().

