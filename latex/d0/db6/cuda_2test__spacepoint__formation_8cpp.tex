\hypertarget{cuda_2test__spacepoint__formation_8cpp}{}\doxysection{tests/cuda/test\+\_\+spacepoint\+\_\+formation.cpp File Reference}
\label{cuda_2test__spacepoint__formation_8cpp}\index{tests/cuda/test\_spacepoint\_formation.cpp@{tests/cuda/test\_spacepoint\_formation.cpp}}
{\ttfamily \#include \char`\"{}traccc/cuda/seeding/experimental/spacepoint\+\_\+formation.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/definitions/common.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/edm/spacepoint.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/detectors/create\+\_\+telescope\+\_\+detector.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/intersection/detail/trajectories.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/cuda/device\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$vecmem/memory/cuda/managed\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$vecmem/utils/cuda/async\+\_\+copy.\+hpp$>$}\newline
{\ttfamily \#include $<$gtest/gtest.\+h$>$}\newline
Include dependency graph for test\+\_\+spacepoint\+\_\+formation.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/d8e/cuda_2test__spacepoint__formation_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{cuda_2test__spacepoint__formation_8cpp_ad9e9765aab8585e635258570b0528de4}{T\+E\+ST}} (\mbox{\hyperlink{classtraccc_1_1spacepoint__formation}{spacepoint\+\_\+formation}}, cuda)
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{cuda_2test__spacepoint__formation_8cpp_ad9e9765aab8585e635258570b0528de4}\label{cuda_2test__spacepoint__formation_8cpp_ad9e9765aab8585e635258570b0528de4}} 
\index{test\_spacepoint\_formation.cpp@{test\_spacepoint\_formation.cpp}!TEST@{TEST}}
\index{TEST@{TEST}!test\_spacepoint\_formation.cpp@{test\_spacepoint\_formation.cpp}}
\doxysubsubsection{\texorpdfstring{TEST()}{TEST()}}
{\footnotesize\ttfamily T\+E\+ST (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{classtraccc_1_1spacepoint__formation}{spacepoint\+\_\+formation}}}]{,  }\item[{cuda}]{ }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{28                                  \{}
\DoxyCodeLine{29 }
\DoxyCodeLine{30     \textcolor{comment}{// Memory resource used by the EDM.}}
\DoxyCodeLine{31     vecmem::cuda::managed\_memory\_resource mng\_mr;}
\DoxyCodeLine{32     \mbox{\hyperlink{structtraccc_1_1memory__resource}{traccc::memory\_resource}} mr\{mng\_mr\};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34     \textcolor{comment}{// Cuda stream}}
\DoxyCodeLine{35     \mbox{\hyperlink{classtraccc_1_1cuda_1_1stream}{traccc::cuda::stream}} stream;}
\DoxyCodeLine{36 }
\DoxyCodeLine{37     \textcolor{comment}{// Cuda copy objects}}
\DoxyCodeLine{38     vecmem::cuda::async\_copy copy\{stream.\mbox{\hyperlink{classtraccc_1_1cuda_1_1stream_ad8224b3cebfca8079e035a10a9b1e20f}{cudaStream}}()\};}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{comment}{// Use rectangle surfaces}}
\DoxyCodeLine{41     detray::mask<detray::rectangle2D<>> rectangle\{}
\DoxyCodeLine{42         0u, 10000.f * detray::unit<scalar>::mm,}
\DoxyCodeLine{43         10000.f * detray::unit<scalar>::mm\};}
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \textcolor{comment}{// Plane alignment direction (aligned to x-\/axis)}}
\DoxyCodeLine{46     detray::detail::ray<transform3> traj\{\{0, 0, 0\}, 0, \{1, 0, 0\}, -\/1\};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \textcolor{comment}{// Position of planes (in mm unit)}}
\DoxyCodeLine{49     std::vector<scalar> plane\_positions = \{20.f,  40.f,  60.f,  80.f, 100.f,}
\DoxyCodeLine{50                                            120.f, 140.f, 160.f, 180.f\};}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     detray::tel\_det\_config<> tel\_cfg\{rectangle\};}
\DoxyCodeLine{53     tel\_cfg.positions(plane\_positions);}
\DoxyCodeLine{54     tel\_cfg.pilot\_track(traj);}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \textcolor{comment}{// Create telescope geometry}}
\DoxyCodeLine{57     \textcolor{keyword}{auto} [det, name\_map] = create\_telescope\_detector(mng\_mr, tel\_cfg);}
\DoxyCodeLine{58     \textcolor{keyword}{using} device\_detector\_type =}
\DoxyCodeLine{59         detray::detector<detray::telescope\_metadata<detray::rectangle2D<>>,}
\DoxyCodeLine{60                          detray::device\_container\_types>;}
\DoxyCodeLine{61 }
\DoxyCodeLine{62     \textcolor{comment}{// Surface lookup}}
\DoxyCodeLine{63     \textcolor{keyword}{auto} surfaces = det.surface\_lookup();}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{comment}{// Prepare measurement collection}}
\DoxyCodeLine{66     \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{measurement\_collection\_types::host}} measurements\{\&mng\_mr\};}
\DoxyCodeLine{67 }
\DoxyCodeLine{68     \textcolor{comment}{// Add a measurement at the first plane}}
\DoxyCodeLine{69     measurements.push\_back(\{\{7.f, 2.f\}, \{0.f, 0.f\}, surfaces[0].barcode()\});}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     \textcolor{comment}{// Add a measurement at the last plane}}
\DoxyCodeLine{72     measurements.push\_back(\{\{10.f, 15.f\}, \{0.f, 0.f\}, surfaces[8u].barcode()\});}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \textcolor{comment}{// Run spacepoint formation}}
\DoxyCodeLine{75     \mbox{\hyperlink{classtraccc_1_1cuda_1_1experimental_1_1spacepoint__formation}{traccc::cuda::experimental::spacepoint\_formation<device\_detector\_type>}}}
\DoxyCodeLine{76         sp\_formation(mr, copy, stream);}
\DoxyCodeLine{77     \textcolor{keyword}{auto} spacepoints\_buffer =}
\DoxyCodeLine{78         sp\_formation(\mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{detray::get\_data}}(det), \mbox{\hyperlink{namespacetraccc_a503d2d50b981602cbc71693ad215b298}{vecmem::get\_data}}(measurements));}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \mbox{\hyperlink{structtraccc_1_1collection__types_af0070c88384f71011d7c52f29d4c45af}{spacepoint\_collection\_types::device}} spacepoints(spacepoints\_buffer);}
\DoxyCodeLine{81 }
\DoxyCodeLine{82     \textcolor{comment}{// Check the results}}
\DoxyCodeLine{83     EXPECT\_EQ(copy.get\_size(spacepoints\_buffer), 2u);}
\DoxyCodeLine{84     std::set<point3> test;}
\DoxyCodeLine{85     test.insert(spacepoints[0].global);}
\DoxyCodeLine{86     test.insert(spacepoints[1].global);}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     std::set<point3> ref;}
\DoxyCodeLine{89     ref.insert(\{180.f, 10.f, 15.f\});}
\DoxyCodeLine{90     ref.insert(\{20.f, 7.f, 2.f\});}
\DoxyCodeLine{91 }
\DoxyCodeLine{92     EXPECT\_EQ(test, ref);}
\DoxyCodeLine{93 \}}

\end{DoxyCode}


References traccc\+::cuda\+::stream\+::cuda\+Stream(), and traccc\+::get\+\_\+data().

