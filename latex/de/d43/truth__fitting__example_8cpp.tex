\hypertarget{truth__fitting__example_8cpp}{}\doxysection{examples/run/cpu/truth\+\_\+fitting\+\_\+example.cpp File Reference}
\label{truth__fitting__example_8cpp}\index{examples/run/cpu/truth\_fitting\_example.cpp@{examples/run/cpu/truth\_fitting\_example.cpp}}
{\ttfamily \#include \char`\"{}traccc/definitions/common.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/definitions/primitives.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/fitting/fitting\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/fitting/kalman\+\_\+filter/kalman\+\_\+fitter.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+geometry.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/read\+\_\+measurements.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/utils.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/common\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/detector\+\_\+input\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/handle\+\_\+argument\+\_\+errors.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/propagation\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/resolution/fitting\+\_\+performance\+\_\+writer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/utils/seed\+\_\+generator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/core/detector.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/core/detector\+\_\+metadata.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/detectors/bfield.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/io/common/detector\+\_\+reader.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/propagator/navigator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/propagator/propagator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/propagator/rk\+\_\+stepper.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$exception$>$}\newline
{\ttfamily \#include $<$iomanip$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
Include dependency graph for truth\+\_\+fitting\+\_\+example.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{db/dd0/truth__fitting__example_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{truth__fitting__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{truth__fitting__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{truth__fitting__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{truth\_fitting\_example.cpp@{truth\_fitting\_example.cpp}!main@{main}}
\index{main@{main}!truth\_fitting\_example.cpp@{truth\_fitting\_example.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}

Type declarations

Standard deviations for seed track parameters
\begin{DoxyCode}{0}
\DoxyCodeLine{45                                  \{}
\DoxyCodeLine{46     \textcolor{comment}{// Set up the program options}}
\DoxyCodeLine{47     po::options\_description desc(\textcolor{stringliteral}{"Allowed options"});}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \textcolor{comment}{// Add options}}
\DoxyCodeLine{50     desc.add\_options()(\textcolor{stringliteral}{"help,h"}, \textcolor{stringliteral}{"Give some help with the program's options"});}
\DoxyCodeLine{51     \mbox{\hyperlink{structtraccc_1_1common__options}{traccc::common\_options}} common\_opts(desc);}
\DoxyCodeLine{52     \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc::detector\_input\_options}} det\_opts(desc);}
\DoxyCodeLine{53     \mbox{\hyperlink{structtraccc_1_1propagation__options}{traccc::propagation\_options<scalar>}} propagation\_opts(desc);}
\DoxyCodeLine{54 }
\DoxyCodeLine{55     po::variables\_map vm;}
\DoxyCodeLine{56     po::store(po::parse\_command\_line(argc, argv, desc), vm);}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{comment}{// Check errors}}
\DoxyCodeLine{59     \mbox{\hyperlink{namespacetraccc_a018e1f5ae8dbab3e118c08cfb905be01}{traccc::handle\_argument\_errors}}(vm, desc);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{comment}{// Read options}}
\DoxyCodeLine{62     common\_opts.read(vm);}
\DoxyCodeLine{63     det\_opts.read(vm);}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     propagation\_opts.read(vm);}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     std::cout << \textcolor{stringliteral}{"Running "} << argv[0] << \textcolor{stringliteral}{" "} << common\_opts.input\_directory}
\DoxyCodeLine{68               << \textcolor{stringliteral}{" "} << common\_opts.events << std::endl;}
\DoxyCodeLine{69 }
\DoxyCodeLine{71     \textcolor{keyword}{using} host\_detector\_type = detray::detector<detray::default\_metadata,}
\DoxyCodeLine{72                                                 detray::host\_container\_types>;}
\DoxyCodeLine{73 }
\DoxyCodeLine{74     \textcolor{keyword}{using} b\_field\_t = covfie::field<detray::bfield::const\_bknd\_t>;}
\DoxyCodeLine{75     \textcolor{keyword}{using} rk\_stepper\_type =}
\DoxyCodeLine{76         detray::rk\_stepper<b\_field\_t::view\_t, \mbox{\hyperlink{namespacetraccc_a7d1f91ecd225f32ea85349bf0bc8adb8}{traccc::transform3}},}
\DoxyCodeLine{77                            detray::constrained\_step<>>;}
\DoxyCodeLine{78 }
\DoxyCodeLine{79     \textcolor{keyword}{using} host\_navigator\_type = detray::navigator<const host\_detector\_type>;}
\DoxyCodeLine{80     \textcolor{keyword}{using} host\_fitter\_type =}
\DoxyCodeLine{81         \mbox{\hyperlink{classtraccc_1_1kalman__fitter}{traccc::kalman\_fitter<rk\_stepper\_type, host\_navigator\_type>}};}
\DoxyCodeLine{82 }
\DoxyCodeLine{83     \textcolor{comment}{// Memory resources used by the application.}}
\DoxyCodeLine{84     vecmem::host\_memory\_resource host\_mr;}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     \textcolor{comment}{// Performance writer}}
\DoxyCodeLine{87     \mbox{\hyperlink{classtraccc_1_1fitting__performance__writer}{traccc::fitting\_performance\_writer}} fit\_performance\_writer(}
\DoxyCodeLine{88         \mbox{\hyperlink{structtraccc_1_1fitting__performance__writer_1_1config}{traccc::fitting\_performance\_writer::config}}\{\});}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{comment}{    /*****************************}}
\DoxyCodeLine{91 \textcolor{comment}{     * Build a geometry}}
\DoxyCodeLine{92 \textcolor{comment}{     *****************************/}}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{comment}{// B field value and its type}}
\DoxyCodeLine{95     \textcolor{comment}{// @TODO: Set B field as argument}}
\DoxyCodeLine{96     \textcolor{keyword}{const} \mbox{\hyperlink{namespacetraccc_a3e92464c509aa7ac245244b6083357c2}{traccc::vector3}} B\{0, 0, 2 * detray::unit<traccc::scalar>::T\};}
\DoxyCodeLine{97     \textcolor{keyword}{auto} field = detray::bfield::create\_const\_field(B);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99     \textcolor{comment}{// Read the detector}}
\DoxyCodeLine{100     detray::io::detector\_reader\_config reader\_cfg\{\};}
\DoxyCodeLine{101     reader\_cfg.add\_file(\mbox{\hyperlink{namespacetraccc_1_1io_adc4b3b42d06cb8ec657cdc35dec6a58f}{traccc::io::data\_directory}}() + det\_opts.detector\_file);}
\DoxyCodeLine{102     \textcolor{keywordflow}{if} (!det\_opts.material\_file.empty()) \{}
\DoxyCodeLine{103         reader\_cfg.add\_file(\mbox{\hyperlink{namespacetraccc_1_1io_adc4b3b42d06cb8ec657cdc35dec6a58f}{traccc::io::data\_directory}}() +}
\DoxyCodeLine{104                             det\_opts.material\_file);}
\DoxyCodeLine{105     \}}
\DoxyCodeLine{106     \textcolor{keywordflow}{if} (!det\_opts.grid\_file.empty()) \{}
\DoxyCodeLine{107         reader\_cfg.add\_file(\mbox{\hyperlink{namespacetraccc_1_1io_adc4b3b42d06cb8ec657cdc35dec6a58f}{traccc::io::data\_directory}}() + det\_opts.grid\_file);}
\DoxyCodeLine{108     \}}
\DoxyCodeLine{109     \textcolor{keyword}{const} \textcolor{keyword}{auto} [host\_det, names] =}
\DoxyCodeLine{110         detray::io::read\_detector<host\_detector\_type>(host\_mr, reader\_cfg);}
\DoxyCodeLine{111 }
\DoxyCodeLine{112 \textcolor{comment}{    /*****************************}}
\DoxyCodeLine{113 \textcolor{comment}{     * Do the reconstruction}}
\DoxyCodeLine{114 \textcolor{comment}{     *****************************/}}
\DoxyCodeLine{115 }
\DoxyCodeLine{117     \textcolor{keyword}{static} constexpr std::array<scalar, e\_bound\_size> stddevs = \{}
\DoxyCodeLine{118         0.03 * detray::unit<scalar>::mm,}
\DoxyCodeLine{119         0.03 * detray::unit<scalar>::mm,}
\DoxyCodeLine{120         0.017,}
\DoxyCodeLine{121         0.017,}
\DoxyCodeLine{122         0.01 / detray::unit<scalar>::GeV,}
\DoxyCodeLine{123         1 * detray::unit<scalar>::ns\};}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{comment}{// Fitting algorithm object}}
\DoxyCodeLine{126     \textcolor{keyword}{typename} \mbox{\hyperlink{classtraccc_1_1fitting__algorithm_acfb92fd90e59587020bacc978ebe275c}{traccc::fitting\_algorithm<host\_fitter\_type>::config\_type}} fit\_cfg;}
\DoxyCodeLine{127     fit\_cfg.step\_constraint = propagation\_opts.step\_constraint;}
\DoxyCodeLine{128     \mbox{\hyperlink{classtraccc_1_1fitting__algorithm}{traccc::fitting\_algorithm<host\_fitter\_type>}} host\_fitting(fit\_cfg);}
\DoxyCodeLine{129 }
\DoxyCodeLine{130     \textcolor{comment}{// Seed generator}}
\DoxyCodeLine{131     \mbox{\hyperlink{structtraccc_1_1seed__generator}{traccc::seed\_generator<host\_detector\_type>}} sg(host\_det, stddevs);}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{comment}{// Iterate over events}}
\DoxyCodeLine{134     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} = common\_opts.skip;}
\DoxyCodeLine{135          \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} < common\_opts.events + common\_opts.skip; ++\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}) \{}
\DoxyCodeLine{136 }
\DoxyCodeLine{137         \textcolor{comment}{// Truth Track Candidates}}
\DoxyCodeLine{138         \mbox{\hyperlink{structtraccc_1_1event__map2}{traccc::event\_map2}} evt\_map2(\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}, common\_opts.input\_directory,}
\DoxyCodeLine{139                                     common\_opts.input\_directory,}
\DoxyCodeLine{140                                     common\_opts.input\_directory);}
\DoxyCodeLine{141 }
\DoxyCodeLine{142         \mbox{\hyperlink{classtraccc_1_1host__container}{traccc::track\_candidate\_container\_types::host}} truth\_track\_candidates =}
\DoxyCodeLine{143             evt\_map2.generate\_truth\_candidates(sg, host\_mr);}
\DoxyCodeLine{144 }
\DoxyCodeLine{145         \textcolor{comment}{// Run fitting}}
\DoxyCodeLine{146         \textcolor{keyword}{auto} track\_states =}
\DoxyCodeLine{147             host\_fitting(host\_det, field, truth\_track\_candidates);}
\DoxyCodeLine{148 }
\DoxyCodeLine{149         std::cout << \textcolor{stringliteral}{"Number of fitted tracks: "} << track\_states.size()}
\DoxyCodeLine{150                   << std::endl;}
\DoxyCodeLine{151 }
\DoxyCodeLine{152         \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} n\_fitted\_tracks = track\_states.size();}
\DoxyCodeLine{153 }
\DoxyCodeLine{154         \textcolor{keywordflow}{if} (common\_opts.check\_performance) \{}
\DoxyCodeLine{155 }
\DoxyCodeLine{156             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < n\_fitted\_tracks; i++) \{}
\DoxyCodeLine{157                 \textcolor{keyword}{const} \textcolor{keyword}{auto}\& trk\_states\_per\_track = track\_states.at(i).items;}
\DoxyCodeLine{158 }
\DoxyCodeLine{159                 \textcolor{keyword}{const} \textcolor{keyword}{auto}\& fit\_info = track\_states[i].header;}
\DoxyCodeLine{160 }
\DoxyCodeLine{161                 fit\_performance\_writer.write(trk\_states\_per\_track, fit\_info,}
\DoxyCodeLine{162                                              host\_det, evt\_map2);}
\DoxyCodeLine{163             \}}
\DoxyCodeLine{164         \}}
\DoxyCodeLine{165     \}}
\DoxyCodeLine{166 }
\DoxyCodeLine{167     \textcolor{keywordflow}{if} (common\_opts.check\_performance) \{}
\DoxyCodeLine{168         fit\_performance\_writer.finalize();}
\DoxyCodeLine{169     \}}
\DoxyCodeLine{170 }
\DoxyCodeLine{171     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{172 \}}

\end{DoxyCode}


References traccc\+::common\+\_\+options\+::check\+\_\+performance, traccc\+::io\+::data\+\_\+directory(), traccc\+::detector\+\_\+input\+\_\+options\+::detector\+\_\+file, event, traccc\+::common\+\_\+options\+::events, traccc\+::event\+\_\+map2\+::generate\+\_\+truth\+\_\+candidates(), traccc\+::detector\+\_\+input\+\_\+options\+::grid\+\_\+file, traccc\+::handle\+\_\+argument\+\_\+errors(), traccc\+::common\+\_\+options\+::input\+\_\+directory, traccc\+::detector\+\_\+input\+\_\+options\+::material\+\_\+file, traccc\+::detector\+\_\+input\+\_\+options\+::read(), traccc\+::common\+\_\+options\+::read(), traccc\+::propagation\+\_\+options$<$ scalar\+\_\+t $>$\+::read(), traccc\+::common\+\_\+options\+::skip, and traccc\+::propagation\+\_\+options$<$ scalar\+\_\+t $>$\+::step\+\_\+constraint.

