\hypertarget{simulate_8cpp}{}\doxysection{examples/simulation/simulate.cpp File Reference}
\label{simulate_8cpp}\index{examples/simulation/simulate.cpp@{examples/simulation/simulate.cpp}}
{\ttfamily \#include \char`\"{}traccc/definitions/primitives.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/edm/track\+\_\+parameters.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/utils.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/common\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/detector\+\_\+input\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/handle\+\_\+argument\+\_\+errors.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/particle\+\_\+gen\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/options/propagation\+\_\+options.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/simulation/measurement\+\_\+smearer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/simulation/simulator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/simulation/smearing\+\_\+writer.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/core/detector.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/core/detector\+\_\+metadata.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/detectors/bfield.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/io/common/detector\+\_\+reader.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/propagator/navigator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/propagator/propagator.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/propagator/rk\+\_\+stepper.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}detray/simulation/event\+\_\+generator/track\+\_\+generators.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$boost/filesystem.\+hpp$>$}\newline
Include dependency graph for simulate.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{df/d32/simulate_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{simulate_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{simulate_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{simulate_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{simulate.cpp@{simulate.cpp}!main@{main}}
\index{main@{main}!simulate.cpp@{simulate.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}

Type declarations
\begin{DoxyCode}{0}
\DoxyCodeLine{43                                  \{}
\DoxyCodeLine{44 }
\DoxyCodeLine{45     \textcolor{comment}{// Set up the program options}}
\DoxyCodeLine{46     po::options\_description desc(\textcolor{stringliteral}{"Allowed options"});}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \textcolor{comment}{// Add options}}
\DoxyCodeLine{49     desc.add\_options()(\textcolor{stringliteral}{"help,h"}, \textcolor{stringliteral}{"Give some help with the program's options"});}
\DoxyCodeLine{50     desc.add\_options()(\textcolor{stringliteral}{"output\_directory"}, po::value<std::string>()-\/>required(),}
\DoxyCodeLine{51                        \textcolor{stringliteral}{"specify the directory of output data"});}
\DoxyCodeLine{52     desc.add\_options()(\textcolor{stringliteral}{"events"}, po::value<unsigned int>()-\/>required(),}
\DoxyCodeLine{53                        \textcolor{stringliteral}{"number of events"});}
\DoxyCodeLine{54     \mbox{\hyperlink{structtraccc_1_1detector__input__options}{traccc::detector\_input\_options}} det\_opts(desc);}
\DoxyCodeLine{55     \mbox{\hyperlink{structtraccc_1_1particle__gen__options}{traccc::particle\_gen\_options<scalar>}} pg\_opts(desc);}
\DoxyCodeLine{56     \mbox{\hyperlink{structtraccc_1_1propagation__options}{traccc::propagation\_options<scalar>}} propagation\_opts(desc);}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     po::variables\_map vm;}
\DoxyCodeLine{59     po::store(po::parse\_command\_line(argc, argv, desc), vm);}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{comment}{// Check errors}}
\DoxyCodeLine{62     \mbox{\hyperlink{namespacetraccc_a018e1f5ae8dbab3e118c08cfb905be01}{traccc::handle\_argument\_errors}}(vm, desc);}
\DoxyCodeLine{63 }
\DoxyCodeLine{65     \textcolor{keyword}{using} host\_detector\_type = detray::detector<>;}
\DoxyCodeLine{66     \textcolor{keyword}{using} uniform\_gen\_t =}
\DoxyCodeLine{67         detray::random\_numbers<scalar, std::uniform\_real\_distribution<scalar>,}
\DoxyCodeLine{68                                std::seed\_seq>;}
\DoxyCodeLine{69     \textcolor{keyword}{using} generator\_type =}
\DoxyCodeLine{70         detray::random\_track\_generator<\mbox{\hyperlink{namespacetraccc_a50d288f62d4a051cca68e9071c6318e8}{traccc::free\_track\_parameters}},}
\DoxyCodeLine{71                                        uniform\_gen\_t>;}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     \textcolor{comment}{// Read options}}
\DoxyCodeLine{74     \textcolor{keyword}{auto} output\_directory = vm[\textcolor{stringliteral}{"output\_directory"}].as<std::string>();}
\DoxyCodeLine{75     \textcolor{keyword}{auto} events = vm[\textcolor{stringliteral}{"events"}].as<\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int}>();}
\DoxyCodeLine{76     det\_opts.read(vm);}
\DoxyCodeLine{77     pg\_opts.read(vm);}
\DoxyCodeLine{78     propagation\_opts.read(vm);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{comment}{// B field value and its type}}
\DoxyCodeLine{81     \textcolor{comment}{// @TODO: Set B field as argument}}
\DoxyCodeLine{82     \textcolor{keyword}{using} b\_field\_t = covfie::field<detray::bfield::const\_bknd\_t>;}
\DoxyCodeLine{83     \textcolor{keyword}{const} \mbox{\hyperlink{namespacetraccc_a3e92464c509aa7ac245244b6083357c2}{traccc::vector3}} B\{0, 0, 2 * detray::unit<traccc::scalar>::T\};}
\DoxyCodeLine{84     \textcolor{keyword}{auto} field = detray::bfield::create\_const\_field(B);}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     \textcolor{comment}{// Read the detector}}
\DoxyCodeLine{87     detray::io::detector\_reader\_config reader\_cfg\{\};}
\DoxyCodeLine{88     reader\_cfg.add\_file(\mbox{\hyperlink{namespacetraccc_1_1io_adc4b3b42d06cb8ec657cdc35dec6a58f}{traccc::io::data\_directory}}() + det\_opts.detector\_file);}
\DoxyCodeLine{89     \textcolor{keywordflow}{if} (!det\_opts.material\_file.empty()) \{}
\DoxyCodeLine{90         reader\_cfg.add\_file(\mbox{\hyperlink{namespacetraccc_1_1io_adc4b3b42d06cb8ec657cdc35dec6a58f}{traccc::io::data\_directory}}() +}
\DoxyCodeLine{91                             det\_opts.material\_file);}
\DoxyCodeLine{92     \}}
\DoxyCodeLine{93     \textcolor{keywordflow}{if} (!det\_opts.grid\_file.empty()) \{}
\DoxyCodeLine{94         reader\_cfg.add\_file(\mbox{\hyperlink{namespacetraccc_1_1io_adc4b3b42d06cb8ec657cdc35dec6a58f}{traccc::io::data\_directory}}() + det\_opts.grid\_file);}
\DoxyCodeLine{95     \}}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{comment}{// Memory resource used by the EDM.}}
\DoxyCodeLine{98     vecmem::host\_memory\_resource host\_mr;}
\DoxyCodeLine{99 }
\DoxyCodeLine{100     \textcolor{keyword}{auto} [host\_det, names] =}
\DoxyCodeLine{101         detray::io::read\_detector<host\_detector\_type>(host\_mr, reader\_cfg);}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{comment}{    /***************************}}
\DoxyCodeLine{104 \textcolor{comment}{     * Generate simulation data}}
\DoxyCodeLine{105 \textcolor{comment}{     ***************************/}}
\DoxyCodeLine{106 }
\DoxyCodeLine{107     \textcolor{comment}{// Origin of particles}}
\DoxyCodeLine{108     generator\_type::configuration gen\_cfg\{\};}
\DoxyCodeLine{109     gen\_cfg.n\_tracks(pg\_opts.gen\_nparticles);}
\DoxyCodeLine{110     gen\_cfg.origin(pg\_opts.vertex);}
\DoxyCodeLine{111     gen\_cfg.origin\_stddev(pg\_opts.vertex\_stddev);}
\DoxyCodeLine{112     gen\_cfg.phi\_range(pg\_opts.phi\_range[0], pg\_opts.phi\_range[1]);}
\DoxyCodeLine{113     gen\_cfg.theta\_range(pg\_opts.theta\_range[0], pg\_opts.theta\_range[1]);}
\DoxyCodeLine{114     gen\_cfg.mom\_range(pg\_opts.mom\_range[0], pg\_opts.mom\_range[1]);}
\DoxyCodeLine{115     gen\_cfg.charge(pg\_opts.charge);}
\DoxyCodeLine{116     generator\_type generator(gen\_cfg);}
\DoxyCodeLine{117 }
\DoxyCodeLine{118     \textcolor{comment}{// Smearing value for measurements}}
\DoxyCodeLine{119     \mbox{\hyperlink{structtraccc_1_1measurement__smearer}{traccc::measurement\_smearer<transform3>}} meas\_smearer(}
\DoxyCodeLine{120         50 * detray::unit<scalar>::um, 50 * detray::unit<scalar>::um);}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     \textcolor{keyword}{using} writer\_type =}
\DoxyCodeLine{123         \mbox{\hyperlink{structtraccc_1_1smearing__writer}{traccc::smearing\_writer<traccc::measurement\_smearer<transform3>}}>;}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{comment}{// Writer config}}
\DoxyCodeLine{126     \textcolor{keyword}{typename} writer\_type::config smearer\_writer\_cfg\{meas\_smearer\};}
\DoxyCodeLine{127 }
\DoxyCodeLine{128     \textcolor{comment}{// Run simulator}}
\DoxyCodeLine{129     \textcolor{keyword}{const} std::string full\_path = \mbox{\hyperlink{classtraccc_1_1tests_1_1data__test_af6b7f5d32e3d14efb3d61b8489ca822d}{io::data\_directory}}() + output\_directory;}
\DoxyCodeLine{130 }
\DoxyCodeLine{131     boost::filesystem::create\_directories(full\_path);}
\DoxyCodeLine{132 }
\DoxyCodeLine{133     \textcolor{keyword}{auto} sim = \mbox{\hyperlink{structtraccc_1_1simulator}{traccc::simulator}}<host\_detector\_type, b\_field\_t, generator\_type,}
\DoxyCodeLine{134                                  writer\_type>(}
\DoxyCodeLine{135         events, host\_det, field, std::move(generator),}
\DoxyCodeLine{136         std::move(smearer\_writer\_cfg), full\_path);}
\DoxyCodeLine{137 }
\DoxyCodeLine{138     sim.\mbox{\hyperlink{structtraccc_1_1simulator_a7692d409a08f9d6bcad077939784c27c}{get\_config}}().\mbox{\hyperlink{structtraccc_1_1simulator_1_1config_aab33c45d2c2bd351ecab0ce3ab489f9f}{step\_constraint}} = propagation\_opts.step\_constraint;}
\DoxyCodeLine{139     sim.get\_config().overstep\_tolerance = propagation\_opts.overstep\_tolerance;}
\DoxyCodeLine{140 }
\DoxyCodeLine{141     sim.run();}
\DoxyCodeLine{142 }
\DoxyCodeLine{143     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{144 \}}

\end{DoxyCode}


References traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::charge, traccc\+::io\+::data\+\_\+directory(), traccc\+::tests\+::data\+\_\+test\+::data\+\_\+directory, traccc\+::detector\+\_\+input\+\_\+options\+::detector\+\_\+file, traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::gen\+\_\+nparticles, traccc\+::simulator$<$ detector\+\_\+t, bfield\+\_\+t, track\+\_\+generator\+\_\+t, writer\+\_\+t $>$\+::get\+\_\+config(), traccc\+::detector\+\_\+input\+\_\+options\+::grid\+\_\+file, traccc\+::handle\+\_\+argument\+\_\+errors(), traccc\+::detector\+\_\+input\+\_\+options\+::material\+\_\+file, traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::mom\+\_\+range, traccc\+::propagation\+\_\+options$<$ scalar\+\_\+t $>$\+::overstep\+\_\+tolerance, traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::phi\+\_\+range, traccc\+::detector\+\_\+input\+\_\+options\+::read(), traccc\+::propagation\+\_\+options$<$ scalar\+\_\+t $>$\+::read(), traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::read(), traccc\+::propagation\+\_\+options$<$ scalar\+\_\+t $>$\+::step\+\_\+constraint, traccc\+::simulator$<$ detector\+\_\+t, bfield\+\_\+t, track\+\_\+generator\+\_\+t, writer\+\_\+t $>$\+::config\+::step\+\_\+constraint, traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::theta\+\_\+range, traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::vertex, and traccc\+::particle\+\_\+gen\+\_\+options$<$ scalar\+\_\+t $>$\+::vertex\+\_\+stddev.

