\hypertarget{io__dec__par__example_8cpp}{}\doxysection{examples/run/openmp/io\+\_\+dec\+\_\+par\+\_\+example.cpp File Reference}
\label{io__dec__par__example_8cpp}\index{examples/run/openmp/io\_dec\_par\_example.cpp@{examples/run/openmp/io\_dec\_par\_example.cpp}}
{\ttfamily \#include \char`\"{}traccc/clusterization/clusterization\+\_\+algorithm.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/clusterization/spacepoint\+\_\+formation.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/edm/cell.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/edm/measurement.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/edm/spacepoint.\+hpp\char`\"{}}\newline
{\ttfamily \#include \char`\"{}traccc/io/demonstrator\+\_\+edm.\+hpp\char`\"{}}\newline
{\ttfamily \#include $<$vecmem/memory/host\+\_\+memory\+\_\+resource.\+hpp$>$}\newline
{\ttfamily \#include $<$boost/program\+\_\+options.\+hpp$>$}\newline
{\ttfamily \#include $<$chrono$>$}\newline
{\ttfamily \#include $<$exception$>$}\newline
{\ttfamily \#include $<$iostream$>$}\newline
Include dependency graph for io\+\_\+dec\+\_\+par\+\_\+example.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{da/d56/io__dec__par__example_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespacetraccc_afa443e6c8da7c7d421aa4538e7da6070}{traccc\+::demonstrator\+\_\+result}} \mbox{\hyperlink{io__dec__par__example_8cpp_a2280d45109980acc30541590e2778923}{run}} (\mbox{\hyperlink{namespacetraccc_a6e17f4a1fd3b062b9fecc4a22ce47e8a}{traccc\+::demonstrator\+\_\+input}} input\+\_\+data, vecmem\+::host\+\_\+memory\+\_\+resource resource)
\item 
int \mbox{\hyperlink{io__dec__par__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main}} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{io__dec__par__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}\label{io__dec__par__example_8cpp_a0ddf1224851353fc92bfbff6f499fa97}} 
\index{io\_dec\_par\_example.cpp@{io\_dec\_par\_example.cpp}!main@{main}}
\index{main@{main}!io\_dec\_par\_example.cpp@{io\_dec\_par\_example.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$}]{argv\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})}


\begin{DoxyCode}{0}
\DoxyCodeLine{102                                  \{}
\DoxyCodeLine{103 }
\DoxyCodeLine{104     \textcolor{comment}{// Set up the program options.}}
\DoxyCodeLine{105     po::options\_description desc(\textcolor{stringliteral}{"Allowed options"});}
\DoxyCodeLine{106     desc.add\_options()(\textcolor{stringliteral}{"help,h"}, \textcolor{stringliteral}{"Give some help with the program's options"});}
\DoxyCodeLine{107     desc.add\_options()(\textcolor{stringliteral}{"detector\_file"}, po::value<std::string>()-\/>required(),}
\DoxyCodeLine{108                        \textcolor{stringliteral}{"specify detector file"});}
\DoxyCodeLine{109     desc.add\_options()(\textcolor{stringliteral}{"cell\_directory"}, po::value<std::string>()-\/>required(),}
\DoxyCodeLine{110                        \textcolor{stringliteral}{"specify the directory of cell files"});}
\DoxyCodeLine{111     desc.add\_options()(\textcolor{stringliteral}{"events"}, po::value<int>()-\/>required(),}
\DoxyCodeLine{112                        \textcolor{stringliteral}{"number of events"});}
\DoxyCodeLine{113 }
\DoxyCodeLine{114     \textcolor{comment}{// Interpret the program options.}}
\DoxyCodeLine{115     po::variables\_map vm;}
\DoxyCodeLine{116     po::store(po::parse\_command\_line(argc, argv, desc), vm);}
\DoxyCodeLine{117 }
\DoxyCodeLine{118     \textcolor{comment}{// Print a help message if the user asked for it.}}
\DoxyCodeLine{119     \textcolor{keywordflow}{if} (vm.count(\textcolor{stringliteral}{"help"})) \{}
\DoxyCodeLine{120         std::cout << desc << std::endl;}
\DoxyCodeLine{121         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{122     \}}
\DoxyCodeLine{123 }
\DoxyCodeLine{124     \textcolor{comment}{// Handle any and all errors.}}
\DoxyCodeLine{125     \textcolor{keywordflow}{try} \{}
\DoxyCodeLine{126         po::notify(vm);}
\DoxyCodeLine{127     \} \textcolor{keywordflow}{catch} (\textcolor{keyword}{const} std::exception\& ex) \{}
\DoxyCodeLine{128         std::cerr << \textcolor{stringliteral}{"Couldn't interpret command line options because of:\(\backslash\)n\(\backslash\)n"}}
\DoxyCodeLine{129                   << ex.what() << \textcolor{stringliteral}{"\(\backslash\)n\(\backslash\)n"}}
\DoxyCodeLine{130                   << desc << std::endl;}
\DoxyCodeLine{131         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{132     \}}
\DoxyCodeLine{133 }
\DoxyCodeLine{134     \textcolor{keyword}{auto} \mbox{\hyperlink{test__mapper_8cpp_a902d72422a60bd9a079e899a54f552c1}{detector\_file}} = vm[\textcolor{stringliteral}{"detector\_file"}].as<std::string>();}
\DoxyCodeLine{135     \textcolor{keyword}{auto} cell\_directory = vm[\textcolor{stringliteral}{"cell\_directory"}].as<std::string>();}
\DoxyCodeLine{136     \textcolor{keyword}{auto} \mbox{\hyperlink{namespacetraccc_af412a9ab8cc2a30a664acd9f62bb83da}{data\_format}} = vm[\textcolor{stringliteral}{"data\_format"}].as<std::string>();}
\DoxyCodeLine{137     \textcolor{keyword}{auto} events = vm[\textcolor{stringliteral}{"events"}].as<\textcolor{keywordtype}{int}>();}
\DoxyCodeLine{138 }
\DoxyCodeLine{139     std::cout << \textcolor{stringliteral}{"Running "} << argv[0] << \textcolor{stringliteral}{" "} << \mbox{\hyperlink{test__mapper_8cpp_a902d72422a60bd9a079e899a54f552c1}{detector\_file}} << \textcolor{stringliteral}{" "}}
\DoxyCodeLine{140               << cell\_directory << \textcolor{stringliteral}{" "} << events << std::endl;}
\DoxyCodeLine{141 }
\DoxyCodeLine{142     \textcolor{keyword}{auto} start = std::chrono::system\_clock::now();}
\DoxyCodeLine{143     vecmem::host\_memory\_resource resource;}
\DoxyCodeLine{144     set\_default\_resource(\&resource);}
\DoxyCodeLine{145 }
\DoxyCodeLine{146     \textcolor{keyword}{auto} end = std::chrono::system\_clock::now();}
\DoxyCodeLine{147     std::chrono::duration<double> diff = end -\/ start;}
\DoxyCodeLine{148     std::cout << \textcolor{stringliteral}{"Total execution time: "} << diff.count() << \textcolor{stringliteral}{" sec."}}
\DoxyCodeLine{149               << std::endl;}
\DoxyCodeLine{150 \}}

\end{DoxyCode}


References detector\+\_\+file.

\mbox{\Hypertarget{io__dec__par__example_8cpp_a2280d45109980acc30541590e2778923}\label{io__dec__par__example_8cpp_a2280d45109980acc30541590e2778923}} 
\index{io\_dec\_par\_example.cpp@{io\_dec\_par\_example.cpp}!run@{run}}
\index{run@{run}!io\_dec\_par\_example.cpp@{io\_dec\_par\_example.cpp}}
\doxysubsubsection{\texorpdfstring{run()}{run()}}
{\footnotesize\ttfamily \mbox{\hyperlink{namespacetraccc_afa443e6c8da7c7d421aa4538e7da6070}{traccc\+::demonstrator\+\_\+result}} run (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{namespacetraccc_a6e17f4a1fd3b062b9fecc4a22ce47e8a}{traccc\+::demonstrator\+\_\+input}}}]{input\+\_\+data,  }\item[{vecmem\+::host\+\_\+memory\+\_\+resource}]{resource }\end{DoxyParamCaption})}

T\+R\+A\+C\+CC library, part of the A\+C\+TS project (R\&D line)

(c) 2021-\/2022 C\+E\+RN for the benefit of the A\+C\+TS project

Mozilla Public License Version 2.\+0 
\begin{DoxyCode}{0}
\DoxyCodeLine{34                                                                      \{}
\DoxyCodeLine{35 }
\DoxyCodeLine{36     \textcolor{comment}{// Algorithms}}
\DoxyCodeLine{37     \mbox{\hyperlink{classtraccc_1_1clusterization__algorithm}{traccc::clusterization\_algorithm}} ca(resource);}
\DoxyCodeLine{38     \mbox{\hyperlink{classtraccc_1_1spacepoint__formation}{traccc::spacepoint\_formation}} sf(resource);}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{comment}{// Output stats}}
\DoxyCodeLine{41     uint64\_t n\_modules = 0;}
\DoxyCodeLine{42     uint64\_t n\_cells = 0;}
\DoxyCodeLine{43     uint64\_t n\_measurements = 0;}
\DoxyCodeLine{44     uint64\_t n\_spacepoints = 0;}
\DoxyCodeLine{45 }
\DoxyCodeLine{46     \textcolor{keyword}{auto} startAlgorithms = std::chrono::system\_clock::now();}
\DoxyCodeLine{47 }
\DoxyCodeLine{48     \mbox{\hyperlink{namespacetraccc_afa443e6c8da7c7d421aa4538e7da6070}{traccc::demonstrator\_result}} aggregated\_results(input\_data.size(),}
\DoxyCodeLine{49                                                    \&resource);}
\DoxyCodeLine{50 }
\DoxyCodeLine{51 \textcolor{preprocessor}{\#pragma omp parallel for reduction (+:n\_modules, n\_cells, n\_measurements, n\_spacepoints)}}
\DoxyCodeLine{52     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} \mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}} = 0; \textcolor{keyword}{event} < input\_data.size(); ++\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}) \{}
\DoxyCodeLine{53         \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::cell\_collection\_types::host}}\& cells\_per\_event =}
\DoxyCodeLine{54             input\_data.operator[](\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}).cells;}
\DoxyCodeLine{55 }
\DoxyCodeLine{56         \mbox{\hyperlink{structtraccc_1_1collection__types_ab1b46d2f1f58a16bde873c1aa3f4557d}{traccc::cell\_module\_collection\_types::host}}\& modules\_per\_event =}
\DoxyCodeLine{57             input\_data.operator[](\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}).modules;}
\DoxyCodeLine{58 }
\DoxyCodeLine{59         \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{60 \textcolor{comment}{            Clusterization}}
\DoxyCodeLine{61 \textcolor{comment}{          -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63         \textcolor{keyword}{auto} measurements\_per\_event = ca(cells\_per\_event, modules\_per\_event);}
\DoxyCodeLine{64 }
\DoxyCodeLine{65         \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{66 \textcolor{comment}{            Spacepoint formation}}
\DoxyCodeLine{67 \textcolor{comment}{          -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69         \textcolor{keyword}{auto} spacepoints\_per\_event =}
\DoxyCodeLine{70             sf(measurements\_per\_event, modules\_per\_event);}
\DoxyCodeLine{71 }
\DoxyCodeLine{72         \textcolor{comment}{/*-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{73 \textcolor{comment}{          Statistics}}
\DoxyCodeLine{74 \textcolor{comment}{          -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/*/}}
\DoxyCodeLine{75 }
\DoxyCodeLine{76         n\_modules += modules\_per\_event.size();}
\DoxyCodeLine{77         n\_cells += cells\_per\_event.size();}
\DoxyCodeLine{78         n\_measurements += measurements\_per\_event.size();}
\DoxyCodeLine{79         n\_spacepoints += spacepoints\_per\_event.size();}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{preprocessor}{\#pragma omp critical}}
\DoxyCodeLine{82         aggregated\_results[\mbox{\hyperlink{test__mapper_8cpp_aa79e3eff1ed8e629ebc8e3268c4805f9}{event}}] =}
\DoxyCodeLine{83             \mbox{\hyperlink{structtraccc_1_1result}{traccc::result}}(\{measurements\_per\_event, spacepoints\_per\_event\});}
\DoxyCodeLine{84     \}}
\DoxyCodeLine{85 }
\DoxyCodeLine{86     \textcolor{keyword}{auto} endAlgorithms = std::chrono::system\_clock::now();}
\DoxyCodeLine{87     std::chrono::duration<double> diffAlgo = endAlgorithms -\/ startAlgorithms;}
\DoxyCodeLine{88     std::cout << \textcolor{stringliteral}{"Algorithms time: "} << diffAlgo.count() << \textcolor{stringliteral}{" sec."}}
\DoxyCodeLine{89               << std::endl;}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     std::cout << \textcolor{stringliteral}{"==> Statistics ... "} << std::endl;}
\DoxyCodeLine{92     std::cout << \textcolor{stringliteral}{"-\/ read    "} << n\_cells << \textcolor{stringliteral}{" cells from "} << n\_modules}
\DoxyCodeLine{93               << \textcolor{stringliteral}{" modules"} << std::endl;}
\DoxyCodeLine{94     std::cout << \textcolor{stringliteral}{"-\/ created "} << n\_measurements << \textcolor{stringliteral}{" measurements. "}}
\DoxyCodeLine{95               << std::endl;}
\DoxyCodeLine{96     std::cout << \textcolor{stringliteral}{"-\/ created "} << n\_spacepoints << \textcolor{stringliteral}{" spacepoints. "} << std::endl;}
\DoxyCodeLine{97 }
\DoxyCodeLine{98     \textcolor{keywordflow}{return} aggregated\_results;}
\DoxyCodeLine{99 \}}

\end{DoxyCode}


References event.



Referenced by traccc\+::futhark\+::component\+\_\+connection\+::operator()(), and traccc\+::futhark\+::spacepoint\+\_\+formation\+::operator()().

