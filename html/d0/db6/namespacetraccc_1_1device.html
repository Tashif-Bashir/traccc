<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>traccc: traccc::device Namespace Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">traccc
   &#160;<span id="projectnumber">02</span>
   </div>
   <div id="projectbrief">&#39;tracccisapartofactsprojectatcern.Itisfocusedtowardsthetrackreconstructionoftheparticles&#39;</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d7/d7b/namespacetraccc.html">traccc</a></li><li class="navelem"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html">device</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#namespaces">Namespaces</a> &#124;
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">traccc::device Namespace Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr class="memitem:db/d86/namespacetraccc_1_1device_1_1details"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d86/namespacetraccc_1_1device_1_1details.html">details</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:d6/da0/namespacetraccc_1_1device_1_1experimental"><td class="memItemLeft" align="right" valign="top"> &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/da0/namespacetraccc_1_1device_1_1experimental.html">experimental</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d5c/classtraccc_1_1device_1_1container__d2h__copy__alg.html">container_d2h_copy_alg</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d8d/classtraccc_1_1device_1_1container__h2d__copy__alg.html">container_h2d_copy_alg</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d8/d32/structtraccc_1_1device_1_1device__doublet.html">device_doublet</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Doublet of middle-bottom or middle-top spacepoints.  <a href="../../d8/d32/structtraccc_1_1device_1_1device__doublet.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html">device_triplet</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Triplets of bottom, middle and top spacepoints.  <a href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html">doublet_counter</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of doublets for one specific middle spacepoint.  <a href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/db7/structtraccc_1_1device_1_1finding__global__counter.html">finding_global_counter</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/d18/structtraccc_1_1device_1_1prefix__sum__buffer.html">prefix_sum_buffer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d0a/structtraccc_1_1device_1_1seeding__global__counter.html">seeding_global_counter</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Total number of doublets and triplets found in seeding.  <a href="../../d5/d0a/structtraccc_1_1device_1_1seeding__global__counter.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html">triplet_counter</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of triplets for one specific Mid-Bottom Doublet.  <a href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html">triplet_counter_spM</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of triplets for one specific middle spacepoint.  <a href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:aec5610a925cef95697843cc4e8b38bcb"><td class="memItemLeft" align="right" valign="top">typedef thrust::pair&lt; std::size_t, std::size_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a></td></tr>
<tr class="memdesc:aec5610a925cef95697843cc4e8b38bcb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for the individual elements in the prefix sum vector.  <a href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">More...</a><br /></td></tr>
<tr class="separator:aec5610a925cef95697843cc4e8b38bcb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa455dcfea1cafcf634e98d29957158c1"><td class="memItemLeft" align="right" valign="top">typedef vecmem::vector&lt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aa455dcfea1cafcf634e98d29957158c1">prefix_sum_t</a></td></tr>
<tr class="memdesc:aa455dcfea1cafcf634e98d29957158c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convenience type definition for the return value of the helper function.  <a href="../../d0/db6/namespacetraccc_1_1device.html#aa455dcfea1cafcf634e98d29957158c1">More...</a><br /></td></tr>
<tr class="separator:aa455dcfea1cafcf634e98d29957158c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade298ff55a1bdb496e412262cdb66433"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> = vecmem::data::vector_view&lt; int &gt;::size_type</td></tr>
<tr class="separator:ade298ff55a1bdb496e412262cdb66433"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c67d5b48697c4ad899f28ae69120e33"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a1c67d5b48697c4ad899f28ae69120e33">prefix_sum_buffer_t</a> = <a class="el" href="../../d4/d18/structtraccc_1_1device_1_1prefix__sum__buffer.html">prefix_sum_buffer</a></td></tr>
<tr class="separator:a1c67d5b48697c4ad899f28ae69120e33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14889993c5b104c16822c9ac949b3fa6"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a14889993c5b104c16822c9ac949b3fa6">device_doublet_collection_types</a> = <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt; <a class="el" href="../../d8/d32/structtraccc_1_1device_1_1device__doublet.html">device_doublet</a> &gt;</td></tr>
<tr class="memdesc:a14889993c5b104c16822c9ac949b3fa6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare all device doublet collection types.  <a href="../../d0/db6/namespacetraccc_1_1device.html#a14889993c5b104c16822c9ac949b3fa6">More...</a><br /></td></tr>
<tr class="separator:a14889993c5b104c16822c9ac949b3fa6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb2c4cc2cf52bc55a5d99d90145dccb6"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#abb2c4cc2cf52bc55a5d99d90145dccb6">device_triplet_collection_types</a> = <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt; <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html">device_triplet</a> &gt;</td></tr>
<tr class="memdesc:abb2c4cc2cf52bc55a5d99d90145dccb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare all device triplet collection types.  <a href="../../d0/db6/namespacetraccc_1_1device.html#abb2c4cc2cf52bc55a5d99d90145dccb6">More...</a><br /></td></tr>
<tr class="separator:abb2c4cc2cf52bc55a5d99d90145dccb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad75aaaae6cf52b2ea760947d7832254"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aad75aaaae6cf52b2ea760947d7832254">doublet_counter_collection_types</a> = <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt; <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html">doublet_counter</a> &gt;</td></tr>
<tr class="memdesc:aad75aaaae6cf52b2ea760947d7832254"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare all doublet counter collection types.  <a href="../../d0/db6/namespacetraccc_1_1device.html#aad75aaaae6cf52b2ea760947d7832254">More...</a><br /></td></tr>
<tr class="separator:aad75aaaae6cf52b2ea760947d7832254"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f7630c49e9c5a3d23245f542526f4f0"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a2f7630c49e9c5a3d23245f542526f4f0">triplet_counter_spM_collection_types</a> = <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt; <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html">triplet_counter_spM</a> &gt;</td></tr>
<tr class="memdesc:a2f7630c49e9c5a3d23245f542526f4f0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare all triplet counter spM collection types.  <a href="../../d0/db6/namespacetraccc_1_1device.html#a2f7630c49e9c5a3d23245f542526f4f0">More...</a><br /></td></tr>
<tr class="separator:a2f7630c49e9c5a3d23245f542526f4f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07a09a5bd10fd62d71ec0a77079b9b07"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a07a09a5bd10fd62d71ec0a77079b9b07">triplet_counter_collection_types</a> = <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt; <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html">triplet_counter</a> &gt;</td></tr>
<tr class="memdesc:a07a09a5bd10fd62d71ec0a77079b9b07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Declare all triplet counter collection types.  <a href="../../d0/db6/namespacetraccc_1_1device.html#a07a09a5bd10fd62d71ec0a77079b9b07">More...</a><br /></td></tr>
<tr class="separator:a07a09a5bd10fd62d71ec0a77079b9b07"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a560c561636e8700675394f3f5a7d7e5d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a560c561636e8700675394f3f5a7d7e5d">aggregate_cluster</a> (const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a2c17f74f33da865b1fb58c83e44ecb71">cell_collection_types::const_device</a> &amp;cells, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a2c17f74f33da865b1fb58c83e44ecb71">cell_module_collection_types::const_device</a> &amp;modules, const vecmem::data::vector_view&lt; unsigned short &gt; f_view, const unsigned int start, const unsigned int end, const unsigned short cid, <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html">measurement</a> &amp;out, vecmem::data::vector_view&lt; unsigned int &gt; cell_links, const unsigned int link)</td></tr>
<tr class="separator:a560c561636e8700675394f3f5a7d7e5d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a581cd4e1e686b1e742185eac2da41369"><td class="memTemplParams" colspan="2">template&lt;typename barrier_t &gt; </td></tr>
<tr class="memitem:a581cd4e1e686b1e742185eac2da41369"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a581cd4e1e686b1e742185eac2da41369">ccl_kernel</a> (const index_t threadId, const index_t blckDim, const unsigned int blockId, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">cell_collection_types::const_view</a> cells_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">cell_module_collection_types::const_view</a> modules_view, const index_t max_cells_per_partition, const index_t target_cells_per_partition, unsigned int &amp;partition_start, unsigned int &amp;partition_end, unsigned int &amp;outi, index_t *f, index_t *gf, barrier_t &amp;barrier, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">measurement_collection_types::view</a> measurements_view, unsigned int &amp;measurement_count, vecmem::data::vector_view&lt; unsigned int &gt; cell_links)</td></tr>
<tr class="separator:a581cd4e1e686b1e742185eac2da41369"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad06299bae21c8e751058d3c70ee6a857"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ad06299bae21c8e751058d3c70ee6a857">form_spacepoints</a> (const std::size_t globalIndex, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a> measurements_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">cell_module_collection_types::const_view</a> modules_view, const unsigned int measurement_count, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">spacepoint_collection_types::view</a> spacepoints_view)</td></tr>
<tr class="separator:ad06299bae21c8e751058d3c70ee6a857"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2fc626e715c5d48a0d3261d70d479dd5"><td class="memTemplParams" colspan="2">template&lt;typename barrier_t &gt; </td></tr>
<tr class="memitem:a2fc626e715c5d48a0d3261d70d479dd5"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a2fc626e715c5d48a0d3261d70d479dd5">fast_sv_1</a> (index_t *f, index_t *gf, unsigned char adjc[MAX_CELLS_PER_THREAD], index_t adjv[MAX_CELLS_PER_THREAD][8], const index_t tid, const index_t blckDim, barrier_t &amp;barrier)</td></tr>
<tr class="separator:a2fc626e715c5d48a0d3261d70d479dd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32c38f509eef5398c63cc66721db1a83"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a32c38f509eef5398c63cc66721db1a83">is_adjacent</a> (<a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> ac0, <a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> ac1, <a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> bc0, <a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> bc1)</td></tr>
<tr class="separator:a32c38f509eef5398c63cc66721db1a83"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8368c09597104f9b3fecf98b4a1111d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ab8368c09597104f9b3fecf98b4a1111d">reduce_problem_cell</a> (const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a2c17f74f33da865b1fb58c83e44ecb71">cell_collection_types::const_device</a> &amp;cells, const unsigned short cid, const unsigned int start, const unsigned int end, unsigned char &amp;adjc, unsigned short adjv[8])</td></tr>
<tr class="separator:ab8368c09597104f9b3fecf98b4a1111d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c2b528a06357f0ac89eae726d2b31ca"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a7c2b528a06357f0ac89eae726d2b31ca">fill_prefix_sum</a> (const std::size_t globalIndex, const vecmem::data::vector_view&lt; const <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> &gt; &amp;sizes_view, vecmem::data::vector_view&lt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a> &gt; ps_view)</td></tr>
<tr class="separator:a7c2b528a06357f0ac89eae726d2b31ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a782823d57c341df346a3589010537dbf"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95b39033664ff24e9b2f42ef43041ad0">TRACCC_HOST</a> <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a1c67d5b48697c4ad899f28ae69120e33">prefix_sum_buffer_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a782823d57c341df346a3589010537dbf">make_prefix_sum_buffer</a> (const std::vector&lt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> &gt; &amp;sizes, vecmem::copy &amp;copy, const <a class="el" href="../../dc/db2/structtraccc_1_1memory__resource.html">traccc::memory_resource</a> &amp;mr)</td></tr>
<tr class="separator:a782823d57c341df346a3589010537dbf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd5f48af899ba8e1b750fd5fd7d46c46"><td class="memTemplParams" colspan="2">template&lt;typename detector_t &gt; </td></tr>
<tr class="memitem:acd5f48af899ba8e1b750fd5fd7d46c46"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#acd5f48af899ba8e1b750fd5fd7d46c46">apply_interaction</a> (std::size_t globalIndex, typename detector_t::view_type det_data, vecmem::data::jagged_vector_view&lt; detray::intersection2D&lt; typename detector_t::surface_type, typename detector_t::transform3 &gt;&gt; nav_candidates_buffer, const int n_params, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a> params_view)</td></tr>
<tr class="separator:acd5f48af899ba8e1b750fd5fd7d46c46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a125de08cb9b6520cb3516fe95c2544a9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a125de08cb9b6520cb3516fe95c2544a9">build_tracks</a> (std::size_t globalIndex, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a> measurements_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a> seeds_view, vecmem::data::jagged_vector_view&lt; const <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html">candidate_link</a> &gt; links_view, vecmem::data::jagged_vector_view&lt; const unsigned int &gt; param_to_link_view, vecmem::data::vector_view&lt; const typename <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html#a43e4355337d1d689215e7a0c69b86636">candidate_link::link_index_type</a> &gt; tips_view, <a class="el" href="../../d1/d93/structtraccc_1_1container__types.html#a3344afd1f08f09bcec6d7206d380b26c">track_candidate_container_types::view</a> track_candidates_view)</td></tr>
<tr class="separator:a125de08cb9b6520cb3516fe95c2544a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2875a7c6e478ac6bc7a5cc80dc49dcd4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a2875a7c6e478ac6bc7a5cc80dc49dcd4">count_measurements</a> (std::size_t globalIndex, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a> params_view, vecmem::data::vector_view&lt; const detray::geometry::barcode &gt; barcodes_view, vecmem::data::vector_view&lt; const unsigned int &gt; upper_bounds_view, const unsigned int n_in_params, vecmem::data::vector_view&lt; unsigned int &gt; n_measurements_view, vecmem::data::vector_view&lt; unsigned int &gt; ref_meas_idx_view, unsigned int &amp;n_measurements_sum)</td></tr>
<tr class="separator:a2875a7c6e478ac6bc7a5cc80dc49dcd4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a0635de6424316c6518818af669c01a"><td class="memTemplParams" colspan="2">template&lt;typename detector_t , typename config_t &gt; </td></tr>
<tr class="memitem:a5a0635de6424316c6518818af669c01a"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a5a0635de6424316c6518818af669c01a">find_tracks</a> (std::size_t globalIndex, const config_t cfg, typename detector_t::view_type det_data, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a> measurements_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a> in_params_view, vecmem::data::vector_view&lt; const unsigned int &gt; n_measurements_prefix_sum_view, vecmem::data::vector_view&lt; const unsigned int &gt; ref_meas_idx_view, const unsigned int step, const unsigned int &amp;n_max_candidates, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a> out_params_view, vecmem::data::vector_view&lt; <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html">candidate_link</a> &gt; links_view, unsigned int &amp;n_candidates)</td></tr>
<tr class="separator:a5a0635de6424316c6518818af669c01a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee8f3ca7cc59d443151e6da536f1fb36"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aee8f3ca7cc59d443151e6da536f1fb36">make_barcode_sequence</a> (std::size_t globalIndex, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a> uniques_view, vecmem::data::vector_view&lt; detray::geometry::barcode &gt; barcodes_view)</td></tr>
<tr class="separator:aee8f3ca7cc59d443151e6da536f1fb36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fbc8641d583065ed1ebc98503d01f10"><td class="memTemplParams" colspan="2">template&lt;typename propagator_t , typename bfield_t , typename config_t &gt; </td></tr>
<tr class="memitem:a5fbc8641d583065ed1ebc98503d01f10"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a5fbc8641d583065ed1ebc98503d01f10">propagate_to_next_surface</a> (std::size_t globalIndex, const config_t cfg, typename propagator_t::detector_type::view_type det_data, bfield_t field_data, vecmem::data::jagged_vector_view&lt; typename propagator_t::intersection_type &gt; nav_candidates_buffer, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a> in_params_view, vecmem::data::vector_view&lt; const <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html">candidate_link</a> &gt; links_view, const unsigned int step, const unsigned int &amp;n_in_params, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a> out_params_view, vecmem::data::vector_view&lt; unsigned int &gt; param_to_link_view, vecmem::data::vector_view&lt; typename <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html#a43e4355337d1d689215e7a0c69b86636">candidate_link::link_index_type</a> &gt; tips_view, unsigned int &amp;n_out_params)</td></tr>
<tr class="separator:a5fbc8641d583065ed1ebc98503d01f10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97659978710a9e2d389c05b9ee4397ae"><td class="memTemplParams" colspan="2">template&lt;typename fitter_t , typename detector_view_t &gt; </td></tr>
<tr class="memitem:a97659978710a9e2d389c05b9ee4397ae"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a97659978710a9e2d389c05b9ee4397ae">fit</a> (std::size_t globalIndex, detector_view_t det_data, const typename fitter_t::bfield_type field_data, const typename fitter_t::config_type cfg, vecmem::data::jagged_vector_view&lt; typename fitter_t::intersection_type &gt; nav_candidates_buffer, <a class="el" href="../../d1/d93/structtraccc_1_1container__types.html#aa6a3c3afb08abf3aad41b6002ef8b48f">track_candidate_container_types::const_view</a> track_candidates_view, <a class="el" href="../../d1/d93/structtraccc_1_1container__types.html#a3344afd1f08f09bcec6d7206d380b26c">track_state_container_types::view</a> track_states_view)</td></tr>
<tr class="separator:a97659978710a9e2d389c05b9ee4397ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b62b54a150cb456973d25f7a5399ddc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a9b62b54a150cb456973d25f7a5399ddc">count_doublets</a> (std::size_t globalIndex, const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;config, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;sp_view, const vecmem::data::vector_view&lt; const <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a> &gt; &amp;sp_ps_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">doublet_counter_collection_types::view</a> doublet_view, unsigned int &amp;nMidBot, unsigned int &amp;nMidTop)</td></tr>
<tr class="separator:a9b62b54a150cb456973d25f7a5399ddc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28d9d10c00bd5852e135b3add3f873ab"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a28d9d10c00bd5852e135b3add3f873ab">count_grid_capacities</a> (const std::size_t globalIndex, const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;config, const sp_grid::axis_p0_type &amp;phi_axis, const sp_grid::axis_p1_type &amp;z_axis, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;spacepoints, vecmem::data::vector_view&lt; unsigned int &gt; grid_capacities)</td></tr>
<tr class="separator:a28d9d10c00bd5852e135b3add3f873ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a697e375f53a1b9c334205c81c71746e4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a697e375f53a1b9c334205c81c71746e4">count_triplets</a> (std::size_t globalIndex, const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;config, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;sp_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;dc_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_doublet_collection_types::const_view</a> &amp;mid_bot_doublet_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_doublet_collection_types::const_view</a> &amp;mid_top_doublet_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">triplet_counter_spM_collection_types::view</a> spM_tc, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">triplet_counter_collection_types::view</a> mb_tc)</td></tr>
<tr class="separator:a697e375f53a1b9c334205c81c71746e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af41f49ac70ec91a9e0065d1586027506"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#af41f49ac70ec91a9e0065d1586027506">estimate_track_params</a> (const std::size_t globalIndex, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;spacepoints_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">seed_collection_types::const_view</a> &amp;seeds_view, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a3e92464c509aa7ac245244b6083357c2">vector3</a> &amp;bfield, const std::array&lt; <a class="el" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">traccc::scalar</a>, <a class="el" href="../../d7/d7b/namespacetraccc.html#a65f3496a079e9bdcffaf1d62a5fa4151af60fe71ca99e61d0a0d70fb431aabc04">traccc::e_bound_size</a> &gt; &amp;stddev, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a> params_view)</td></tr>
<tr class="separator:af41f49ac70ec91a9e0065d1586027506"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaad2fcfe8fb236f1ecb1ac7309370237"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aaad2fcfe8fb236f1ecb1ac7309370237">find_doublets</a> (std::size_t globalIndex, const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;config, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;sp_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;dc_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_doublet_collection_types::view</a> mb_doublets_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_doublet_collection_types::view</a> mt_doublets_view)</td></tr>
<tr class="separator:aaad2fcfe8fb236f1ecb1ac7309370237"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac06f2e5b055c83e3ef9362207f325b3"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aac06f2e5b055c83e3ef9362207f325b3">find_triplets</a> (std::size_t globalIndex, const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;config, const <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html">seedfilter_config</a> &amp;filter_config, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;sp_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;dc_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_doublet_collection_types::const_view</a> &amp;mid_top_doublet_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_spM_collection_types::const_view</a> &amp;spM_tc_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_collection_types::const_view</a> &amp;tc_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_triplet_collection_types::view</a> triplet_view)</td></tr>
<tr class="separator:aac06f2e5b055c83e3ef9362207f325b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5cd1251ac7c7ded70369df125d151e5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ab5cd1251ac7c7ded70369df125d151e5">populate_grid</a> (unsigned int globalIndex, const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;config, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;spacepoints_view, <a class="el" href="../../d7/d7b/namespacetraccc.html#a5044143e89d8abc4a09e7829850cdfdc">sp_grid_view</a> grid_view)</td></tr>
<tr class="separator:ab5cd1251ac7c7ded70369df125d151e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0aea434e4a014b6fd621ebd0d7100fbe"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a0aea434e4a014b6fd621ebd0d7100fbe">reduce_triplet_counts</a> (const std::size_t globalIndex, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;dc_view, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">triplet_counter_spM_collection_types::view</a> spM_tc_view, unsigned int &amp;num_triplets)</td></tr>
<tr class="separator:a0aea434e4a014b6fd621ebd0d7100fbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ada5aab00f224f7d53c4b717042d099c4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ada5aab00f224f7d53c4b717042d099c4">select_seeds</a> (const std::size_t globalIndex, const <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html">seedfilter_config</a> &amp;filter_config, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;spacepoints_view, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;internal_sp_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_spM_collection_types::const_view</a> &amp;spM_tc_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_collection_types::const_view</a> &amp;tc_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_triplet_collection_types::const_view</a> &amp;triplet_view, <a class="el" href="../../db/d24/structtraccc_1_1triplet.html">triplet</a> *data, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">seed_collection_types::view</a> seed_view)</td></tr>
<tr class="separator:ada5aab00f224f7d53c4b717042d099c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab5df4029912b7c1cd4d2186bf9434a1d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ab5df4029912b7c1cd4d2186bf9434a1d">update_triplet_weights</a> (const std::size_t globalIndex, const <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html">seedfilter_config</a> &amp;filter_config, const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;sp_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_spM_collection_types::const_view</a> &amp;spM_tc_view, const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_collection_types::const_view</a> &amp;tc_view, <a class="el" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> *data, <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_triplet_collection_types::view</a> triplet_view)</td></tr>
<tr class="separator:ab5df4029912b7c1cd4d2186bf9434a1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>TRACCC library, part of the ACTS project (R&amp;D line)</p>
<p>(c) 2022 CERN for the benefit of the ACTS project</p>
<p>Mozilla Public License Version 2.0</p>
<p>TRACCC library, part of the ACTS project (R&amp;D line)</p>
<p>(c) 2022-2023 CERN for the benefit of the ACTS project</p>
<p>Mozilla Public License Version 2.0</p>
<p>TRACCC library, part of the ACTS project (R&amp;D line)</p>
<p>(c) 2023 CERN for the benefit of the ACTS project</p>
<p>Mozilla Public License Version 2.0</p>
<p>TRACCC library, part of the ACTS project (R&amp;D line)</p>
<p>(c) 2021-2023 CERN for the benefit of the ACTS project</p>
<p>Mozilla Public License Version 2.0</p>
<p>TRACCC library, part of the ACTS project (R&amp;D line)</p>
<p>(c) 2021-2022 CERN for the benefit of the ACTS project</p>
<p>Mozilla Public License Version 2.0 </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a14889993c5b104c16822c9ac949b3fa6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a14889993c5b104c16822c9ac949b3fa6">&#9670;&nbsp;</a></span>device_doublet_collection_types</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a14889993c5b104c16822c9ac949b3fa6">traccc::device::device_doublet_collection_types</a> = typedef <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt;<a class="el" href="../../d8/d32/structtraccc_1_1device_1_1device__doublet.html">device_doublet</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Declare all device doublet collection types. </p>

</div>
</div>
<a id="abb2c4cc2cf52bc55a5d99d90145dccb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb2c4cc2cf52bc55a5d99d90145dccb6">&#9670;&nbsp;</a></span>device_triplet_collection_types</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#abb2c4cc2cf52bc55a5d99d90145dccb6">traccc::device::device_triplet_collection_types</a> = typedef <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt;<a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html">device_triplet</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Declare all device triplet collection types. </p>

</div>
</div>
<a id="aad75aaaae6cf52b2ea760947d7832254"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aad75aaaae6cf52b2ea760947d7832254">&#9670;&nbsp;</a></span>doublet_counter_collection_types</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aad75aaaae6cf52b2ea760947d7832254">traccc::device::doublet_counter_collection_types</a> = typedef <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt;<a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html">doublet_counter</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Declare all doublet counter collection types. </p>

</div>
</div>
<a id="a1c67d5b48697c4ad899f28ae69120e33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c67d5b48697c4ad899f28ae69120e33">&#9670;&nbsp;</a></span>prefix_sum_buffer_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a1c67d5b48697c4ad899f28ae69120e33">traccc::device::prefix_sum_buffer_t</a> = typedef <a class="el" href="../../d4/d18/structtraccc_1_1device_1_1prefix__sum__buffer.html">prefix_sum_buffer</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aec5610a925cef95697843cc4e8b38bcb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aec5610a925cef95697843cc4e8b38bcb">&#9670;&nbsp;</a></span>prefix_sum_element_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef thrust::pair&lt;std::size_t, std::size_t&gt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">traccc::device::prefix_sum_element_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Type for the individual elements in the prefix sum vector. </p>

</div>
</div>
<a id="ade298ff55a1bdb496e412262cdb66433"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ade298ff55a1bdb496e412262cdb66433">&#9670;&nbsp;</a></span>prefix_sum_size_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">traccc::device::prefix_sum_size_t</a> = typedef vecmem::data::vector_view&lt;int&gt;::size_type</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa455dcfea1cafcf634e98d29957158c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa455dcfea1cafcf634e98d29957158c1">&#9670;&nbsp;</a></span>prefix_sum_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef vecmem::vector&lt;<a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a>&gt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aa455dcfea1cafcf634e98d29957158c1">traccc::device::prefix_sum_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convenience type definition for the return value of the helper function. </p>

</div>
</div>
<a id="a07a09a5bd10fd62d71ec0a77079b9b07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a07a09a5bd10fd62d71ec0a77079b9b07">&#9670;&nbsp;</a></span>triplet_counter_collection_types</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a07a09a5bd10fd62d71ec0a77079b9b07">traccc::device::triplet_counter_collection_types</a> = typedef <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt;<a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html">triplet_counter</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Declare all triplet counter collection types. </p>

</div>
</div>
<a id="a2f7630c49e9c5a3d23245f542526f4f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f7630c49e9c5a3d23245f542526f4f0">&#9670;&nbsp;</a></span>triplet_counter_spM_collection_types</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a2f7630c49e9c5a3d23245f542526f4f0">traccc::device::triplet_counter_spM_collection_types</a> = typedef <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html">collection_types</a>&lt;<a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html">triplet_counter_spM</a>&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Declare all triplet counter spM collection types. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a560c561636e8700675394f3f5a7d7e5d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a560c561636e8700675394f3f5a7d7e5d">&#9670;&nbsp;</a></span>aggregate_cluster()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::aggregate_cluster </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a2c17f74f33da865b1fb58c83e44ecb71">cell_collection_types::const_device</a> &amp;&#160;</td>
          <td class="paramname"><em>cells</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a2c17f74f33da865b1fb58c83e44ecb71">cell_module_collection_types::const_device</a> &amp;&#160;</td>
          <td class="paramname"><em>modules</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vecmem::data::vector_view&lt; unsigned short &gt;&#160;</td>
          <td class="paramname"><em>f_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned short&#160;</td>
          <td class="paramname"><em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html">measurement</a> &amp;&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>cell_links</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>link</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function which looks for cells which share the same "parent" index and aggregates them into a cluster.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cells</td><td>collection of cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">modules</td><td>collection of modules to which the cells are linked to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">f</td><td>array of "parent" indices for all cells in this partition </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>partition start point this cell belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>partition end point this cell belongs to </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cid</td><td>current cell id </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>cluster to fill </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                             {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keyword">const</span> vecmem::device_vector&lt;unsigned short&gt; f(f_view);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    vecmem::device_vector&lt;unsigned int&gt; cell_links_device(cell_links);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">     * Now, we iterate over all other cells to check if they belong</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">     * to our cluster. Note that we can start at the current index</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">     * because no cell is ever a child of a cluster owned by a cell</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">     * with a higher ID.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> totalWeight = 0.;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#a83ee72b67d3c03df43280e5bc169ac7a">point2</a> mean{0., 0.}, var{0., 0.};</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> module_link = cells[cid + start].module_link;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">const</span> cell_module this_module = modules.at(module_link);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> partition_size = end - start;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> maxChannel1 = std::numeric_limits&lt;channel_id&gt;::min();</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> j = cid; j &lt; partition_size; j++) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        assert(j &lt; f.size());</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos = j + start;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">         * Terminate the process earlier if we have reached a cell sufficiently</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">         * in a different module.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keywordflow">if</span> (cells[pos].module_link != module_link) {</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keyword">const</span> cell this_cell = cells[pos];</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">         * If the value of this cell is equal to our, that means it</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         * is part of our cluster. In that case, we take its values</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">         * for position and add them to our accumulators.</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">if</span> (f[j] == cid) {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keywordflow">if</span> (this_cell.channel1 &gt; maxChannel1) {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                maxChannel1 = this_cell.channel1;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">float</span> weight = <a class="code" href="../../d3/d75/namespacetraccc_1_1detail.html#ab8b9563129faf8333be30d0895d1a6a6">traccc::detail::signal_cell_modelling</a>(</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                this_cell.activation, this_module);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">if</span> (weight &gt; this_module.threshold) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                totalWeight += this_cell.activation;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#a83ee72b67d3c03df43280e5bc169ac7a">point2</a> cell_position =</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                    <a class="code" href="../../d3/d75/namespacetraccc_1_1detail.html#a7a2d59fbc63350abdfe5e2af688d24ad">traccc::detail::position_from_cell</a>(this_cell, this_module);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#a83ee72b67d3c03df43280e5bc169ac7a">point2</a> prev = mean;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#a83ee72b67d3c03df43280e5bc169ac7a">point2</a> diff = cell_position - prev;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                mean = prev + (weight / totalWeight) * diff;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">char</span> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                    var[i] = var[i] +</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                             weight * (diff[i]) * (cell_position[i] - mean[i]);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            cell_links_device.at(pos) = link;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">         * Terminate the process earlier if we have reached a cell sufficiently</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">         * far away from the cluster in the dominant axis.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keywordflow">if</span> (this_cell.channel1 &gt; maxChannel1 + 1) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">if</span> (totalWeight &gt; <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a><span class="keyword">&gt;</span>(0.)) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">char</span> i = 0; i &lt; 2; ++i) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            var[i] /= totalWeight;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> pitch = this_module.pixel.get_pitch();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        var = var + <a class="code" href="../../d7/d7b/namespacetraccc.html#a83ee72b67d3c03df43280e5bc169ac7a">point2</a>{pitch[0] * pitch[0] / <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a><span class="keyword">&gt;</span>(12.),</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                           pitch[1] * pitch[1] / <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a><span class="keyword">&gt;</span>(12.)};</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">     * Fill output vector with calculated cluster properties</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    out.local = mean;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    out.variance = var;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    out.surface_link = this_module.surface_link;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    out.module_link = module_link;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// The following will need to be filled properly &quot;soon&quot;.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    out.meas_dim = 2u;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../de/d75/structtraccc_1_1cell.html#a961705010a177a31c0fd1b40d7ec7bc3">traccc::cell::activation</a>, <a class="el" href="../../de/d75/structtraccc_1_1cell.html#a59bd8e0f6c1562c21d74f7e12eae49e9">traccc::cell::channel1</a>, <a class="el" href="../../db/d96/structtraccc_1_1pixel__data.html#a78d3ebf434749f822a9de3eae97e9d72">traccc::pixel_data::get_pitch()</a>, <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#a23d5f297b506857cafa3feb88c06540c">traccc::measurement::local</a>, <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#a4e1196fbe4ff3927aefc3fdd7b0edd9e">traccc::measurement::meas_dim</a>, <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#afe3a50efe16166506b7877d898e200aa">traccc::measurement::module_link</a>, <a class="el" href="../../dc/d5d/structtraccc_1_1cell__module.html#ab435849a012678d81f05dfbf76d36899">traccc::cell_module::pixel</a>, <a class="el" href="../../d3/d75/namespacetraccc_1_1detail.html#a7a2d59fbc63350abdfe5e2af688d24ad">traccc::detail::position_from_cell()</a>, <a class="el" href="../../d3/d75/namespacetraccc_1_1detail.html#ab8b9563129faf8333be30d0895d1a6a6">traccc::detail::signal_cell_modelling()</a>, <a class="el" href="../../dc/d5d/structtraccc_1_1cell__module.html#a883c62a59d8c058ce6215ad50fd7a1b4">traccc::cell_module::surface_link</a>, <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#a8f03b72057618e536bffa637f70f84d0">traccc::measurement::surface_link</a>, <a class="el" href="../../dc/d5d/structtraccc_1_1cell__module.html#a99429b52c9c629eb4344f6e2605d0fdf">traccc::cell_module::threshold</a>, and <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#a9a72a589749a42bfec083a61bc1f6b7a">traccc::measurement::variance</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a581cd4e1e686b1e742185eac2da41369">ccl_kernel()</a>.</p>

</div>
</div>
<a id="acd5f48af899ba8e1b750fd5fd7d46c46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd5f48af899ba8e1b750fd5fd7d46c46">&#9670;&nbsp;</a></span>apply_interaction()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename detector_t &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::apply_interaction </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">typename detector_t::view_type&#160;</td>
          <td class="paramname"><em>det_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::jagged_vector_view&lt; detray::intersection2D&lt; typename detector_t::surface_type, typename detector_t::transform3 &gt;&gt;&#160;</td>
          <td class="paramname"><em>nav_candidates_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>n_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>params_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function applying the Pre material interaction to tracks spawned by bound track parameters</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">det_data</td><td>Detector view object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nav_candidates_buffer</td><td>Buffer for navigation candidates </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_params</td><td>The number of parameters (or tracks) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">params_view</td><td>Collection of output bound track_parameters </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                                                             {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// Type definitions</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">using</span> transform3_type = <span class="keyword">typename</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#a7d1f91ecd225f32ea85349bf0bc8adb8">detector_t::transform3</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">using</span> intersection_type =</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        detray::intersection2D&lt;<span class="keyword">typename</span> detector_t::surface_type,</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                               transform3_type&gt;;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">using</span> interactor_type =</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        detray::pointwise_material_interactor&lt;transform3_type&gt;;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// Detector</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    detector_t det(det_data);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// Navigation candidate buffer</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    vecmem::jagged_device_vector&lt;intersection_type&gt; nav_candidates(</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        nav_candidates_buffer);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160; </div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// in param</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    bound_track_parameters_collection_types::device params(params_view);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= n_params) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="keyword">auto</span>&amp; bound_param = params.at(globalIndex);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">// Get intersection at surface</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keyword">const</span> detray::surface&lt;detector_t&gt; sf{det, bound_param.surface_link()};</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">using</span> cxt_t = <span class="keyword">typename</span> detector_t::geometry_context;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">const</span> cxt_t ctx{};</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> free_vec = sf.bound_to_free_vector(ctx, bound_param.vector());</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; mask_store = det.mask_store();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    intersection_type sfi;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    sfi.sf_desc = det.surface(bound_param.surface_link());</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    sf.template visit_mask&lt;detray::intersection_update&gt;(</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        detray::detail::ray&lt;transform3_type&gt;(free_vec), sfi,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        det.transform_store());</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Apply interactor</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">typename</span> interactor_type::state interactor_state;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    interactor_type{}.update(</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        bound_param, interactor_state,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(detray::navigation::direction::e_forward), sf,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        sfi.cos_incidence_angle);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a125de08cb9b6520cb3516fe95c2544a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a125de08cb9b6520cb3516fe95c2544a9">&#9670;&nbsp;</a></span>build_tracks()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::build_tracks </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>measurements_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>seeds_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::jagged_vector_view&lt; const <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html">candidate_link</a> &gt;&#160;</td>
          <td class="paramname"><em>links_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::jagged_vector_view&lt; const unsigned int &gt;&#160;</td>
          <td class="paramname"><em>param_to_link_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; const typename <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html#a43e4355337d1d689215e7a0c69b86636">candidate_link::link_index_type</a> &gt;&#160;</td>
          <td class="paramname"><em>tips_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d93/structtraccc_1_1container__types.html#a3344afd1f08f09bcec6d7206d380b26c">track_candidate_container_types::view</a>&#160;</td>
          <td class="paramname"><em>track_candidates_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function for building full tracks from the link container: The full tracks are built using the link container and tip link container. Since every link holds an information of the link from the previous step, we can build a full track by iterating from a tip link backwardly.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurements_view</td><td>Measurements container view </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seeds_view</td><td>Seed container view </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">link_view</td><td>Link container view </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">param_to_link_view</td><td>Container for param index -&gt; link index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tips_view</td><td>Tip link container view </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">track_candidates_view</td><td>Track candidate container view </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                                               {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    measurement_collection_types::const_device measurements(measurements_view);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    bound_track_parameters_collection_types::const_device seeds(seeds_view);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160; </div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    vecmem::jagged_device_vector&lt;const candidate_link&gt; links(links_view);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    vecmem::jagged_device_vector&lt;const unsigned int&gt; param_to_link(</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        param_to_link_view);</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    vecmem::device_vector&lt;const typename candidate_link::link_index_type&gt; tips(</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        tips_view);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    track_candidate_container_types::device track_candidates(</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        track_candidates_view);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= tips.size()) {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    }</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> tip = tips.at(globalIndex);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keyword">auto</span>&amp; seed = track_candidates[globalIndex].header;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keyword">auto</span> cands_per_track = track_candidates[globalIndex].items;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// Get the link corresponding to tip</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">auto</span> L = links[tip.first][tip.second];</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Resize the candidates with the exact size</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    cands_per_track.resize(tip.first + 1);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// Reversely iterate to fill the track candidates</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = cands_per_track.rbegin(); it != cands_per_track.rend();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;         it++) {</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keyword">auto</span>&amp; cand = *it;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        cand = {measurements.at(L.meas_idx)};</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">// Break the loop if the iterator is at the first candidate and fill the</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="comment">// seed</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">if</span> (it == cands_per_track.rend() - 1) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            seed = seeds.at(L.previous.second);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> l_pos = param_to_link[L.previous.first][L.previous.second];</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160; </div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        L = links[L.previous.first][l_pos];</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d4/d1a/classtraccc_1_1device__container.html#a34cb53957444108c83348852dbc6c907">traccc::device_container&lt; header_t, item_t &gt;::at()</a>.</p>

</div>
</div>
<a id="a581cd4e1e686b1e742185eac2da41369"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a581cd4e1e686b1e742185eac2da41369">&#9670;&nbsp;</a></span>ccl_kernel()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename barrier_t &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::ccl_kernel </td>
          <td>(</td>
          <td class="paramtype">const index_t&#160;</td>
          <td class="paramname"><em>threadId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const index_t&#160;</td>
          <td class="paramname"><em>blckDim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>blockId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">cell_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>cells_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">cell_module_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>modules_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const index_t&#160;</td>
          <td class="paramname"><em>max_cells_per_partition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const index_t&#160;</td>
          <td class="paramname"><em>target_cells_per_partition</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>partition_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>partition_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>outi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">index_t *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">index_t *&#160;</td>
          <td class="paramname"><em>gf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">barrier_t &amp;&#160;</td>
          <td class="paramname"><em>barrier</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">measurement_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>measurements_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>measurement_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>cell_links</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function which reads raw detector cells and turns them into measurements.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">threadId</td><td>current thread index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blckDim</td><td>current thread block size </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blckId</td><td>current thread block index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cells_view</td><td>collection of cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">modules_view</td><td>collection of modules to which the cells are linked </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_cells_per_partition</td><td>maximum number of cells per thread block </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">target_cells_per_partition</td><td>average number of cells per thread block </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">partition_start</td><td>partition start point for this thread block </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">partition_end</td><td>partition end point for this thread block </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">outi</td><td>number of measurements for this partition </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">f</td><td>array of "parent" indices for all cells in this partition </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">gf</td><td>array of "grandparent" indices for all cells in this partition </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">barrier</td><td>A generic object for block-wide synchronisation </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurements_view</td><td>collection of measurements </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">measurement_count</td><td>number of measurements </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cell_links</td><td>collection of links to measurements each cell is put into </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                                                    {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// Get device copy of input parameters</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keyword">const</span> cell_collection_types::const_device cells_device(cells_view);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">const</span> cell_module_collection_types::const_device modules_device(</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        modules_view);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    measurement_collection_types::device measurements_device(measurements_view);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160; </div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_cells = cells_device.size();</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">     * First, we determine the exact range of cells that is to be examined</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">     * by this block of threads. We start from an initial range determined</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">     * by the block index multiplied by the target number of cells per</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">     * block. We then shift both the start and the end of the block forward</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">     * (to a later point in the array); start and end may be moved different</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">     * amounts.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (threadId == 0) {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> start = blockId * target_cells_per_partition;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        assert(start &lt; num_cells);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> end =</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            std::min(num_cells, start + target_cells_per_partition);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        outi = 0;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">         * Next, shift the starting point to a position further in the</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">         * array; the purpose of this is to ensure that we are not operating</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">         * on any cells that have been claimed by the previous block (if</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">         * any).</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        <span class="keywordflow">while</span> (start != 0 &amp;&amp;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;               cells_device[start - 1].module_link ==</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                   cells_device[start].module_link &amp;&amp;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;               cells_device[start].channel1 &lt;=</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                   cells_device[start - 1].channel1 + 1) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            ++start;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160; </div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">         * Then, claim as many cells as we need past the naive end of the</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">         * current block to ensure that we do not end our partition on a</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">         * cell that is not a possible boundary!</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordflow">while</span> (end &lt; num_cells &amp;&amp;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;               cells_device[end - 1].module_link ==</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                   cells_device[end].module_link &amp;&amp;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;               cells_device[end].channel1 &lt;=</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                   cells_device[end - 1].channel1 + 1) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            ++end;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        partition_start = start;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        partition_end = end;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// Vector of indices of the adjacent cells</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    index_t adjv[MAX_CELLS_PER_THREAD][8];</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">     * The number of adjacent cells for each cell must start at zero, to</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">     * avoid uninitialized memory. adjv does not need to be zeroed, as</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">     * we will only access those values if adjc indicates that the value</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">     * is set.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="comment">// Number of adjacent cells</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> adjc[MAX_CELLS_PER_THREAD];</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="comment">// It seems that sycl runs into undefined behaviour when calling</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="comment">// group synchronisation functions when some threads have already run</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// into a return. As such, we cannot use returns in this kernel.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="comment">// Get partition for this thread group</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    <span class="keyword">const</span> index_t size = partition_end - partition_start;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    assert(size &lt;= max_cells_per_partition);</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordflow">for</span> (index_t tst = 0; tst &lt; MAX_CELLS_PER_THREAD; ++tst) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        adjc[tst] = 0;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">for</span> (index_t tst = 0, cid; (cid = tst * blckDim + threadId) &lt; size; ++tst) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">         * Look for adjacent cells to the current one.</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#ab8368c09597104f9b3fecf98b4a1111d">device::reduce_problem_cell</a>(cells_device, cid, partition_start,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                    partition_end, adjc[tst], adjv[tst]);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="keywordflow">for</span> (index_t tst = 0; tst &lt; MAX_CELLS_PER_THREAD; ++tst) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keyword">const</span> index_t cid = tst * blckDim + threadId;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">         * At the start, the values of f and gf should be equal to the</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">         * ID of the cell.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        f[cid] = cid;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        gf[cid] = cid;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">     * Now that the data has initialized, we synchronize again before we</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">     * move onto the actual processing part.</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">     * Run FastSV algorithm, which will update the father index to that of</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">     * the cell belonging to the same cluster with the lowest index.</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#a2fc626e715c5d48a0d3261d70d479dd5">fast_sv_1</a>(&amp;f[0], &amp;gf[0], adjc, adjv, threadId, blckDim, barrier);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">     * Count the number of clusters by checking how many cells have</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">     * themself assigned as a parent.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    <span class="keywordflow">for</span> (index_t tst = 0, cid; (cid = tst * blckDim + threadId) &lt; size; ++tst) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> (f[cid] == cid) {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            <span class="comment">// Increment the summary values in the header object.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            vecmem::device_atomic_ref&lt;<span class="keywordtype">unsigned</span> int,</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                      vecmem::device_address_space::local&gt;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                atom(outi);</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            atom.fetch_add(1);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">     * Add the number of clusters of each thread block to the total</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">     * number of clusters. At the same time, a cluster id is retrieved</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">     * for the next data processing step.</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">     * Note that this might be not the same cluster as has been treated</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">     * previously. However, since each thread block spawns a the maximum</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">     * amount of threads per block, this has no sever implications.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keywordflow">if</span> (threadId == 0) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        vecmem::device_atomic_ref&lt;<span class="keywordtype">unsigned</span> int,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                  vecmem::device_address_space::global&gt;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            atom(measurement_count);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        outi = atom.fetch_add(outi);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">     * Get the position to fill the measurements found in this thread group.</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> groupPos = outi;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160; </div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160; </div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (threadId == 0) {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        outi = 0;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160; </div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    barrier.blockBarrier();</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="keyword">const</span> vecmem::data::vector_view&lt;unsigned short&gt; f_view(</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        max_cells_per_partition, &amp;f[0]);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="keywordflow">for</span> (index_t tst = 0, cid; (cid = tst * blckDim + threadId) &lt; size; ++tst) {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="keywordflow">if</span> (f[cid] == cid) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">             * If we are a cluster owner, atomically claim a position in the</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">             * output array which we can write to.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            vecmem::device_atomic_ref&lt;<span class="keywordtype">unsigned</span> int,</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                                      vecmem::device_address_space::local&gt;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                atom(outi);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keywordtype">id</span> = atom.fetch_add(1);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160; </div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#a560c561636e8700675394f3f5a7d7e5d">device::aggregate_cluster</a>(cells_device, modules_device, f_view,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                                      partition_start, partition_end, cid,</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                                      measurements_device[groupPos + <span class="keywordtype">id</span>],</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                                      cell_links, groupPos + <span class="keywordtype">id</span>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a560c561636e8700675394f3f5a7d7e5d">aggregate_cluster()</a>, <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a2fc626e715c5d48a0d3261d70d479dd5">fast_sv_1()</a>, and <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ab8368c09597104f9b3fecf98b4a1111d">reduce_problem_cell()</a>.</p>

</div>
</div>
<a id="a9b62b54a150cb456973d25f7a5399ddc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b62b54a150cb456973d25f7a5399ddc">&#9670;&nbsp;</a></span>count_doublets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::count_doublets </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>sp_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vecmem::data::vector_view&lt; const <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>sp_ps_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">doublet_counter_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>doublet_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nMidBot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>nMidTop</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for calculating the number of spacepoint doublets</p>
<p>The count is necessary for allocating the appropriate amount of memory for storing the information of the candidates in a next step.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Seedfinder configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_view</td><td>The spacepoint grid to count doublets on </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_ps_view</td><td>Prefix sum for iterating over the spacepoint grid </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">doublet_view</td><td>Collection storing the number of doublets for each spacepoint </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nMidBot</td><td>Total number of middle-bottom doublets </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">nMidTop</td><td>Total number of middle-top doublets </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                           {</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    vecmem::device_vector&lt;const prefix_sum_element_t&gt; sp_prefix_sum(sp_ps_view);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= sp_prefix_sum.size()) {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Get the middle spacepoint that we need to be looking at.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a> middle_sp_idx = sp_prefix_sum[globalIndex];</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// Set up the device containers.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">const_sp_grid_device</a> <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>(sp_view);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    doublet_counter_collection_types::device doublet_counter(doublet_view);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Get the spacepoint that we&#39;re evaluating in this thread, and treat that</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// as the &quot;middle&quot; spacepoint.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; middle_sp =</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(middle_sp_idx.first).at(middle_sp_idx.second);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// The the IDs of the neighbouring bins along the phi and Z axes of the</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// grid.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">const</span> detray::dindex_range phi_bins =</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().range(middle_sp.phi(), config.neighbor_scope);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">const</span> detray::dindex_range z_bins =</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p1().range(middle_sp.z(), config.neighbor_scope);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    assert(z_bins[0] &lt;= z_bins[1]);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// The number of middle-bottom candidates found for this thread&#39;s middle</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// spacepoint.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_mb_cand = 0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// The number of middle-top candidates found for this thread&#39;s middle</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// spacepoint.</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_mt_cand = 0;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Iterate over all of the neighboring phi bins, including the same bin that</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// the middle spacepoint is in. The loop over the phi bins needs to take</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// into account that we may iterate over the &quot;wrap around point&quot; of the</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// axis.</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordflow">for</span> (detray::dindex phi_bin_iterator = phi_bins[0];</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;         phi_bin_iterator &lt;=</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;         (phi_bins[1] +</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;          (phi_bins[0] &gt; phi_bins[1] ? <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().n_bins : 0));</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;         ++phi_bin_iterator) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">// Set up the phi bin index that we are actually meant to use inside of</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="comment">// the loop. We could also use a modulo operation here, but that would</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="comment">// be slightly more expensive in this specific case.</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keyword">const</span> detray::dindex phi_bin =</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            (phi_bin_iterator &gt;= <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().n_bins</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                 ? phi_bin_iterator - <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().n_bins</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                 : phi_bin_iterator);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">// Iterate over all of the neighboring Z bins, including the same bin</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">// that the middle spacepoint is in. This is a much easier iteration, as</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment">// the Z axis does not &quot;wrap around&quot;.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">for</span> (detray::dindex z_bin = z_bins[0]; z_bin &lt;= z_bins[1]; ++z_bin) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">// Ask the grid for all of the spacepoints in this specific bin.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keyword">typename</span> <a class="code" href="../../da/dad/namespacetraccc_1_1details_1_1functor.html#a357582a9a6874cb71ff052105af32ab2">const_sp_grid_device::serialized_storage::const_reference</a></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                spacepoints = <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(phi_bin, z_bin);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="comment">// Loop over all of those spacepoints.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keywordflow">for</span> (<span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; other_sp : spacepoints) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="comment">// Check if this spacepoint is a compatible &quot;bottom&quot; spacepoint</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="comment">// to the thread&#39;s &quot;middle&quot; spacepoint.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordflow">if</span> (doublet_finding_helper::isCompatible&lt;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                        details::spacepoint_type::bottom&gt;(middle_sp, other_sp,</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                                                          config)) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    ++n_mb_cand;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="comment">// Check if this spacepoint is a compatible &quot;top&quot; spacepoint to</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                <span class="comment">// the thread&#39;s &quot;middle&quot; spacepoint.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordflow">if</span> (doublet_finding_helper::isCompatible&lt;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                        details::spacepoint_type::top&gt;(middle_sp, other_sp,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                                       config)) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    ++n_mt_cand;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Add the counts if compatible bottom *AND* top candidates were found for</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// the middle spacepoint in question.</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">if</span> ((n_mb_cand &gt; 0) &amp;&amp; (n_mt_cand &gt; 0)) {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="comment">// Increment the summary values in the header object.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        vecmem::device_atomic_ref&lt;unsigned int&gt; numMidBot(nMidBot);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> posBot = numMidBot.fetch_add(n_mb_cand);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        vecmem::device_atomic_ref&lt;unsigned int&gt; numMidTop(nMidTop);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> posTop = numMidTop.fetch_add(n_mt_cand);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        <span class="comment">// Add the number of candidates for the &quot;current bin&quot;.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        doublet_counter.push_back(</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            {{<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(middle_sp_idx.first),</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;              <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(middle_sp_idx.second)},</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;             n_mb_cand,</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;             n_mt_cand,</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;             posBot,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;             posTop});</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cda71f262d796bed1ab30e8a2d5a8ddee6f">traccc::details::bottom</a>, <a class="el" href="../../dd/d78/structtraccc_1_1doublet__finding__helper.html#a208065db4a4af892094b49367d9f0aa6">traccc::doublet_finding_helper::isCompatible()</a>, <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#af67455f2be06f852fc5aa60b05053153">traccc::seedfinder_config::neighbor_scope</a>, <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#aaa38422e5479ae1dba0936f914a4893c">traccc::internal_spacepoint&lt; spacepoint_t &gt;::phi()</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cdab28354b543375bfa94dabaeda722927f">traccc::details::top</a>, and <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#abb33de685f9235fe3fc2fbccbc3526cc">traccc::internal_spacepoint&lt; spacepoint_t &gt;::z()</a>.</p>

</div>
</div>
<a id="a28d9d10c00bd5852e135b3add3f873ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a28d9d10c00bd5852e135b3add3f873ab">&#9670;&nbsp;</a></span>count_grid_capacities()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::count_grid_capacities </td>
          <td>(</td>
          <td class="paramtype">const std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const sp_grid::axis_p0_type &amp;&#160;</td>
          <td class="paramname"><em>phi_axis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const sp_grid::axis_p1_type &amp;&#160;</td>
          <td class="paramname"><em>z_axis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spacepoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>grid_capacities</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for calculating the capacity for the spacepoint grid</p>
<p>Before filling the spacepoint grid with the spacepoints that belong to each grid bin, we need to calculate how big each of those bins are going to be.</p>
<p>This function needs to be called separately for every spacepoint of the event.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Seedfinder configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">phi_axis</td><td>The circular &amp;Phi axis describing the geometry </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">z_axis</td><td>The linear Z axis describing the geometry </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spacepoints</td><td>All the spacepoints of the event </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">grid_capacities</td><td>Capacity required for each spacepoint grid bin </td></tr>
  </table>
  </dd>
</dl>
<p>Check out if the spacepoint can be used for seeding.</p>
<p>Check out if the spacepoint can be used for seeding.</p>
<div class="fragment"><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;                                                              {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keyword">const</span> spacepoint_collection_types::const_device spacepoints(</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        spacepoints_view);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= spacepoints.size()) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">const</span> spacepoint sp = spacepoints.at(globalIndex);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7b/namespacetraccc.html#a4e12ff4b9f7297ad771d4fe8ecc17304">is_valid_sp</a>(config, sp) != detray::detail::invalid_value&lt;size_t&gt;()) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="comment">// Find the grid bin that the spacepoint belongs to.</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; isp(sp, globalIndex,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                                                  config.beamPos);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        <span class="keyword">const</span> std::size_t bin_index =</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            phi_axis.bin(isp.phi()) + phi_axis.bins() * z_axis.bin(isp.z());</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="comment">// Increase the capacity of the grid bin.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        vecmem::device_vector&lt;unsigned int&gt; grid_capacities(</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            grid_capacities_view);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        vecmem::device_atomic_ref&lt;unsigned int&gt; bin_content(</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            grid_capacities[bin_index]);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        bin_content.fetch_add(1);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#ad5a0905e9ce28b8501fa21bad52520bd">traccc::seedfinder_config::beamPos</a>, <a class="el" href="../../d7/d7b/namespacetraccc.html#a4e12ff4b9f7297ad771d4fe8ecc17304">traccc::is_valid_sp()</a>, <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#aaa38422e5479ae1dba0936f914a4893c">traccc::internal_spacepoint&lt; spacepoint_t &gt;::phi()</a>, and <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#abb33de685f9235fe3fc2fbccbc3526cc">traccc::internal_spacepoint&lt; spacepoint_t &gt;::z()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d3/d36/structtraccc_1_1alpaka_1_1CountGridCapacityKernel.html#a332e97d475dd7d42643973f1bc20f616">traccc::alpaka::CountGridCapacityKernel::operator()()</a>, and <a class="el" href="../../df/deb/classtraccc_1_1kokkos_1_1spacepoint__binning.html#a1ba66ab0c511ed951052cb28e1412d55">traccc::kokkos::spacepoint_binning::operator()()</a>.</p>

</div>
</div>
<a id="a2875a7c6e478ac6bc7a5cc80dc49dcd4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2875a7c6e478ac6bc7a5cc80dc49dcd4">&#9670;&nbsp;</a></span>count_measurements()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::count_measurements </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>params_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; const detray::geometry::barcode &gt;&#160;</td>
          <td class="paramname"><em>barcodes_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; const unsigned int &gt;&#160;</td>
          <td class="paramname"><em>upper_bounds_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>n_in_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>n_measurements_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>ref_meas_idx_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>n_measurements_sum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function evalulating the number of measurements to be iterated per thread and the total number of measurements</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">params_view</td><td>Input parameters view object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">barcodes_view</td><td>Barcodes view object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">upper_bounds</td><td>Upper bounds of measurements w.r.t geometry ID </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">n_measurements_view</td><td>The number of measurements per parameter </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ref_meas_idx</td><td>The first index of measurements per parameter </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">n_measurements_sum</td><td>The sum of the number of measurements per parameter </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                      {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    bound_track_parameters_collection_types::const_device params(params_view);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    vecmem::device_vector&lt;const detray::geometry::barcode&gt; barcodes(</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        barcodes_view);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    vecmem::device_vector&lt;const unsigned int&gt; upper_bounds(upper_bounds_view);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    vecmem::device_vector&lt;unsigned int&gt; n_measurements(n_measurements_view);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    vecmem::device_vector&lt;unsigned int&gt; ref_meas_idx(ref_meas_idx_view);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= n_in_params) {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    }</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// Get barcode</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> bcd = params.at(globalIndex).surface_link();</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> lo =</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        thrust::lower_bound(thrust::seq, barcodes.begin(), barcodes.end(), bcd);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> bcd_id = std::distance(barcodes.begin(), lo);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// Get the reference measurement index and the number of measurements per</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="comment">// parameter</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    ref_meas_idx.at(globalIndex) =</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        lo == barcodes.begin() ? 0u : upper_bounds[bcd_id - 1];</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    n_measurements.at(globalIndex) =</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        upper_bounds[bcd_id] - ref_meas_idx.at(globalIndex);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// Increase the total number of measurements with atomic addition</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    vecmem::device_atomic_ref&lt;unsigned int&gt; n_meas_sum(n_measurements_sum);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    n_meas_sum.fetch_add(n_measurements.at(globalIndex));</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a697e375f53a1b9c334205c81c71746e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a697e375f53a1b9c334205c81c71746e4">&#9670;&nbsp;</a></span>count_triplets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::count_triplets </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>sp_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>dc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_doublet_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>mid_bot_doublet_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_doublet_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>mid_top_doublet_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">triplet_counter_spM_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>spM_tc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">triplet_counter_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>mb_tc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for calculating the number of spacepoint triplets</p>
<p>The count is necessary for allocating the appropriate amount of memory for storing the information of the candidates in a next step.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Seedfinder configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_view</td><td>The spacepoint grid to count triplets on </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_view</td><td>Collection of doublet counters </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mid_bot_doublet_view</td><td>Collection storing the midBot doublets </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mid_top_doublet_view</td><td>Collection storing the midTop doublets </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">spM_tc</td><td>Collection storing the number of triplets per middle spacepoint </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mb_tc</td><td>Collection storing the number of triplets per midBottom doublet </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                                                     {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// Create device copy of input parameters</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const</span> device_doublet_collection_types::const_device mid_bot_doublet_device(</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        mid_bot_doublet_view);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= mid_bot_doublet_device.size()) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    }</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// Get current mid bottom doublet</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">const</span> device_doublet mid_bot = mid_bot_doublet_device.at(globalIndex);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// Create device copy of input parameters</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">const</span> device_doublet_collection_types::const_device mid_top_doublet_device(</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        mid_top_doublet_view);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keyword">const</span> doublet_counter_collection_types::const_device dc_device(dc_view);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// Create device copy of output parameterss</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    triplet_counter_collection_types::device mb_triplet_counter(mb_tc_view);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    triplet_counter_spM_collection_types::device spM_triplet_counter(</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        spM_tc_view);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">// Get all spacepoints</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">const_sp_grid_device</a> internal_sp_device(sp_view);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> counter_link = mid_bot.counter_link;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">const</span> doublet_counter doublet_counts = dc_device.at(counter_link);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// middle spacepoint</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">const</span> sp_location spM_loc = doublet_counts.m_spM;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> spM =</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        internal_sp_device.bin(spM_loc.bin_idx)[spM_loc.sp_idx];</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">const</span> sp_location spB_loc = mid_bot.sp2;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="comment">// bottom spacepoint</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> spB =</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        internal_sp_device.bin(spB_loc.bin_idx)[spB_loc.sp_idx];</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">// Apply the conformal transformation to middle-bot doublet</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html">traccc::lin_circle</a> lb = doublet_finding_helper::transform_coordinates&lt;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        details::spacepoint_type::bottom&gt;(spM, spB);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// Calculate some physical quantities required for triplet compatibility</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// check</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> iSinTheta2 = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a><span class="keyword">&gt;</span>(1.) + lb.<a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">cotTheta</a>() * lb.<a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">cotTheta</a>();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> scatteringInRegion2 = config.maxScatteringAngle2 * iSinTheta2;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    scatteringInRegion2 *= config.sigmaScattering * config.sigmaScattering;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="comment">// These two quantities are used as output parameters in</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// triplet_finding_helper::isCompatible but their values are irrelevant</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> curvature, impact_parameter;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="comment">// find the reference (start) index of the mid-top doublet container</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="comment">// item vector, where the doublets are recorded</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mt_start_idx = doublet_counts.m_posMidTop;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mt_end_idx = mt_start_idx + doublet_counts.m_nMidTop;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// number of triplets per middle-bot doublet</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_triplets_per_mb = 0;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// iterate over mid-top doublets</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = mt_start_idx; i &lt; mt_end_idx; ++i) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d7/dca/structtraccc_1_1sp__location.html">traccc::sp_location</a> spT_loc = mid_top_doublet_device[i].sp2;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> spT =</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            internal_sp_device.bin(spT_loc.<a class="code" href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">bin_idx</a>)[spT_loc.<a class="code" href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">sp_idx</a>];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">// Apply the conformal transformation to middle-top doublet</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html">traccc::lin_circle</a> lt = doublet_finding_helper::transform_coordinates&lt;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            details::spacepoint_type::top&gt;(spM, spT);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="comment">// Check if mid-bot and mid-top doublets can form a triplet</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">if</span> (triplet_finding_helper::isCompatible(</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                spM, lb, lt, config, iSinTheta2, scatteringInRegion2, curvature,</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                impact_parameter)) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            num_triplets_per_mb++;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="comment">// if the number of triplets per mb is larger than 0, write the triplet</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="comment">// counter into the collection</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="keywordflow">if</span> (num_triplets_per_mb &gt; 0) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        triplet_counter_spM&amp; header = spM_triplet_counter.at(counter_link);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        vecmem::device_atomic_ref&lt;unsigned int&gt; nTriplets(header.m_nTriplets);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> posTriplets =</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            nTriplets.fetch_add(num_triplets_per_mb);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        mb_triplet_counter.push_back(</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            {spB_loc, counter_link, num_triplets_per_mb, posTriplets});</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">traccc::sp_location::bin_idx</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cda71f262d796bed1ab30e8a2d5a8ddee6f">traccc::details::bottom</a>, <a class="el" href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">traccc::lin_circle::cotTheta()</a>, <a class="el" href="../../d8/d32/structtraccc_1_1device_1_1device__doublet.html#ae40d195247b91593255114ac01e6a6af">traccc::device::device_doublet::counter_link</a>, <a class="el" href="../../dc/d8e/structtraccc_1_1triplet__finding__helper.html#a2bcf66c0ebe8c89242f0f132e81a76ab">traccc::triplet_finding_helper::isCompatible()</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a75265b59ac68b59b0946f7f4045ddf2c">traccc::device::doublet_counter::m_nMidTop</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#a42fd8a48c0ecc021ef4b726b9770eb8e">traccc::device::triplet_counter_spM::m_nTriplets</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a6e3e93741b9c09b7d805c341aa885cbe">traccc::device::doublet_counter::m_posMidTop</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a3c736589d98a42e5bd7e5138e403f3f7">traccc::device::doublet_counter::m_spM</a>, <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#ad621edcb12b86883b431e8c581da51ef">traccc::seedfinder_config::maxScatteringAngle2</a>, <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#a599852ee91a92905c57cd532b5659d1c">traccc::seedfinder_config::sigmaScattering</a>, <a class="el" href="../../d8/d32/structtraccc_1_1device_1_1device__doublet.html#a1c8a27498081e9f053bf712f59a29825">traccc::device::device_doublet::sp2</a>, <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">traccc::sp_location::sp_idx</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cdab28354b543375bfa94dabaeda722927f">traccc::details::top</a>, and <a class="el" href="../../dd/d78/structtraccc_1_1doublet__finding__helper.html#ad5f94a6c063d05a2f46cd7340b71ce77">traccc::doublet_finding_helper::transform_coordinates()</a>.</p>

</div>
</div>
<a id="af41f49ac70ec91a9e0065d1586027506"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af41f49ac70ec91a9e0065d1586027506">&#9670;&nbsp;</a></span>estimate_track_params()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::estimate_track_params </td>
          <td>(</td>
          <td class="paramtype">const std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spacepoints_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">seed_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>seeds_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a3e92464c509aa7ac245244b6083357c2">vector3</a> &amp;&#160;</td>
          <td class="paramname"><em>bfield</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::array&lt; <a class="el" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">traccc::scalar</a>, <a class="el" href="../../d7/d7b/namespacetraccc.html#a65f3496a079e9bdcffaf1d62a5fa4151af60fe71ca99e61d0a0d70fb431aabc04">traccc::e_bound_size</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>stddev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>params_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for calculating the bound track parameters for each seed</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spacepoints_view</td><td>Collection storing the spacepoints </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seeds_view</td><td>Collection storing the seeds </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bfield</td><td>B field </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">stddev</td><td>Standard deviation of seed parameters </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">params_view</td><td>Collection storing the bound track parameters </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                                                             {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keyword">const</span> seed_collection_types::const_device seeds_device(seeds_view);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= seeds_device.size()) {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    }</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> spacepoint_collection_types::const_device spacepoints_device(</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        spacepoints_view);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    bound_track_parameters_collection_types::device params_device(params_view);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keyword">const</span> seed&amp; this_seed = seeds_device.at(globalIndex);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// Get bound track parameter</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#a49b1ec1e09c6b63a918d97428dd51f2e">bound_track_parameters</a> track_params;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    track_params.set_vector(<a class="code" href="../../d7/d7b/namespacetraccc.html#a88606a40b404017f29254d1316716919">seed_to_bound_vector</a>(spacepoints_device, this_seed,</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                                 bfield, <a class="code" href="../../d7/d7b/namespacetraccc.html#a6cf70f42326684dce8af8f18664292af">PION_MASS_MEV</a>));</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Set Covariance</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keywordflow">for</span> (std::size_t i = 0; i &lt; <a class="code" href="../../d7/d7b/namespacetraccc.html#a65f3496a079e9bdcffaf1d62a5fa4151af60fe71ca99e61d0a0d70fb431aabc04">e_bound_size</a>; i++) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        getter::element(track_params.covariance(), i, i) =</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            stddev[i] * stddev[i];</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Get geometry ID for bottom spacepoint</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; spB = spacepoints_device.at(this_seed.spB_link);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    track_params.set_surface_link(spB.meas.surface_link);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// Save the object into global memory.</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    params_device[globalIndex] = track_params;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/d7b/namespacetraccc.html#a65f3496a079e9bdcffaf1d62a5fa4151af60fe71ca99e61d0a0d70fb431aabc04">traccc::e_bound_size</a>, <a class="el" href="../../d7/d7b/namespacetraccc.html#a6cf70f42326684dce8af8f18664292af">traccc::PION_MASS_MEV</a>, <a class="el" href="../../d7/d7b/namespacetraccc.html#a88606a40b404017f29254d1316716919">traccc::seed_to_bound_vector()</a>, and <a class="el" href="../../d0/d91/structtraccc_1_1seed.html#a7512f47f320dbca9526195b63be24008">traccc::seed::spB_link</a>.</p>

</div>
</div>
<a id="a2fc626e715c5d48a0d3261d70d479dd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2fc626e715c5d48a0d3261d70d479dd5">&#9670;&nbsp;</a></span>fast_sv_1()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename barrier_t &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::fast_sv_1 </td>
          <td>(</td>
          <td class="paramtype">index_t *&#160;</td>
          <td class="paramname"><em>f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">index_t *&#160;</td>
          <td class="paramname"><em>gf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char&#160;</td>
          <td class="paramname"><em>adjc</em>[MAX_CELLS_PER_THREAD], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">index_t&#160;</td>
          <td class="paramname"><em>adjv</em>[MAX_CELLS_PER_THREAD][8], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const index_t&#160;</td>
          <td class="paramname"><em>tid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const index_t&#160;</td>
          <td class="paramname"><em>blckDim</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">barrier_t &amp;&#160;</td>
          <td class="paramname"><em>barrier</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Implementation of a FastSV algorithm with the following steps: 1) mix of stochastic and aggressive hooking 2) shortcutting</p>
<p>The implementation corresponds to an adapted versiion of Algorithm 3 of the following paper: <a href="https://www.sciencedirect.com/science/article/pii/S0743731520302689">https://www.sciencedirect.com/science/article/pii/S0743731520302689</a> </p><pre class="fragment">                This array only gets updated at the end of the iteration
                to prevent race conditions.
</pre> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">adjc</td><td>The number of adjacent cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">adjv</td><td>Vector of adjacent cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tid</td><td>The thread index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blckDim</td><td>The block size </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">f</td><td>array holding the parent cell ID for the current iteration. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">gf</td><td>array holding grandparent cell ID from the previous iteration. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">barrier</td><td>A generic object for block-wide synchronisation </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                                                 {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">     * The algorithm finishes if an iteration leaves the arrays unchanged.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">     * This varible will be set if a change is made, and dictates if another</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">     * loop is necessary.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keywordtype">bool</span> gf_changed;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">         * Reset the end-parameter to false, so we can set it to true if we</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">         * make a change to the gf array.</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        gf_changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">         * The algorithm executes in a loop of three distinct parallel</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">         * stages. In this first one, a mix of stochastic and aggressive</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         * hooking, we examine adjacent cells and copy their grand parents</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">         * cluster ID if it is lower than ours, essentially merging the two</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">         * together.</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        <span class="keywordflow">for</span> (index_t tst = 0; tst &lt; MAX_CELLS_PER_THREAD; ++tst) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="keyword">const</span> index_t cid = tst * blckDim + tid;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            __builtin_assume(adjc[tst] &lt;= 8);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> k = 0; k &lt; adjc[tst]; ++k) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                index_t q = gf[adjv[tst][k]];</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="keywordflow">if</span> (gf[cid] &gt; q) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                    f[f[cid]] = q;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                    f[cid] = q;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">         * Each stage in this algorithm must be preceded by a</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">         * synchronization barrier!</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        barrier.blockBarrier();</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">for</span> (index_t tst = 0; tst &lt; MAX_CELLS_PER_THREAD; ++tst) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keyword">const</span> index_t cid = tst * blckDim + tid;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">             * The second stage is shortcutting, which is an optimisation that</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">             * allows us to look at any shortcuts in the cluster IDs that we</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">             * can merge without adjacency information.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keywordflow">if</span> (f[cid] &gt; gf[cid]) {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                f[cid] = gf[cid];</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        }</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">         * Synchronize before the final stage.</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        barrier.blockBarrier();</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="preprocessor">#pragma unroll</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keywordflow">for</span> (index_t tst = 0; tst &lt; MAX_CELLS_PER_THREAD; ++tst) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;            <span class="keyword">const</span> index_t cid = tst * blckDim + tid;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">             * Update the array for the next generation, keeping track of any</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">             * changes we make.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keywordflow">if</span> (gf[cid] != f[f[cid]]) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                gf[cid] = f[f[cid]];</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                gf_changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;            }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">         * To determine whether we need another iteration, we use block</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">         * voting mechanics. Each thread checks if it has made any changes</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">         * to the arrays, and votes. If any thread votes true, all threads</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">         * will return a true value and go to the next iteration. Only if</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">         * all threads return false will the loop exit.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    } <span class="keywordflow">while</span> (barrier.blockOr(gf_changed));</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a581cd4e1e686b1e742185eac2da41369">ccl_kernel()</a>.</p>

</div>
</div>
<a id="a7c2b528a06357f0ac89eae726d2b31ca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c2b528a06357f0ac89eae726d2b31ca">&#9670;&nbsp;</a></span>fill_prefix_sum()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::fill_prefix_sum </td>
          <td>(</td>
          <td class="paramtype">const std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const vecmem::data::vector_view&lt; const <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>sizes_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">prefix_sum_element_t</a> &gt;&#160;</td>
          <td class="paramname"><em>ps_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function filling the prefix sum for a "size vector"</p>
<p>This simple function is just meant to translate the received "size vector" into a "prefix sum". I.e. into a list of index pairs that would allow visiting all elements of the jagged vector described by this "size vector".</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sizes_view</td><td>View on the sizes of the "inner vectors" of a jagged vector </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ps_view</td><td>View on the result vector of index pairs </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                                                         {</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160; </div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    <span class="keyword">const</span> vecmem::device_vector&lt;const prefix_sum_size_t&gt; sizes(sizes_view);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    vecmem::device_vector&lt;prefix_sum_element_t&gt; result(ps_view);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= sizes.size()) {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> previous =</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        (globalIndex == 0) ? 0 : sizes[globalIndex - 1];</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> current = sizes[globalIndex];</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> i = 0; i &lt; current - previous; ++i) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        result.at(previous + i) = {globalIndex, i};</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../d5/d9e/namespacetraccc_1_1kokkos.html#ac6275a34fac6619caab789d57a5c0209">traccc::kokkos::make_prefix_sum_buff()</a>, and <a class="el" href="../../d9/df5/structtraccc_1_1alpaka_1_1PrefixSumBuffKernel.html#a748eb28412fd45af409e8e631586c27f">traccc::alpaka::PrefixSumBuffKernel::operator()()</a>.</p>

</div>
</div>
<a id="aaad2fcfe8fb236f1ecb1ac7309370237"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaad2fcfe8fb236f1ecb1ac7309370237">&#9670;&nbsp;</a></span>find_doublets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::find_doublets </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>sp_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>dc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_doublet_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>mb_doublets_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_doublet_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>mt_doublets_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function finding all of the spacepoint doublets</p>
<p>Based on the information collected by <code><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a9b62b54a150cb456973d25f7a5399ddc">traccc::device::count_doublets</a></code> it can fill collection with the specific doublet pairs that exist in the event.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Seedfinder configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_view</td><td>The spacepoint grid to find doublets on </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_view</td><td>Collection with the number of doublets to find </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mb_doublets_view</td><td>Collection of middle-bottom doublets </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">mt_doublets_view</td><td>Collection of middle-top doublets </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                                          {</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> doublet_counter_collection_types::const_device doublet_counts(</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        dc_view);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= doublet_counts.size()) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    }</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// Get the middle spacepoint that we need to be looking at.</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">const</span> doublet_counter middle_sp_counter = doublet_counts.at(globalIndex);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// Set up the device containers.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">const_sp_grid_device</a> <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>(sp_view);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    device_doublet_collection_types::device mb_doublets(mb_doublets_view);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    device_doublet_collection_types::device mt_doublets(mt_doublets_view);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// Get the spacepoint that we&#39;re evaluating in this thread, and treat that</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// as the &quot;middle&quot; spacepoint.</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; middle_sp =</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(middle_sp_counter.m_spM.bin_idx)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            .at(middle_sp_counter.m_spM.sp_idx);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160; </div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="comment">// Find the reference (start) index of the doublet container item vector,</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="comment">// where the doublets are recorded.</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mid_bot_start_idx = middle_sp_counter.m_posMidBot;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mid_top_start_idx = middle_sp_counter.m_posMidTop;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// The running indices for the middle-bottom and middle-top pairs.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mid_bot_idx = 0, mid_top_idx = 0;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// The the IDs of the neighbouring bins along the phi and Z axes of the</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// grid.</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keyword">const</span> detray::dindex_range phi_bins =</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().range(middle_sp.phi(), config.neighbor_scope);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="keyword">const</span> detray::dindex_range z_bins =</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p1().range(middle_sp.z(), config.neighbor_scope);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    assert(z_bins[0] &lt;= z_bins[1]);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// Iterate over all of the neighboring phi bins, including the same bin that</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="comment">// the middle spacepoint is in. The loop over the phi bins needs to take</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// into account that we may iterate over the &quot;wrap around point&quot; of the</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// axis.</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="keywordflow">for</span> (detray::dindex phi_bin_iterator = phi_bins[0];</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;         phi_bin_iterator &lt;=</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;         (phi_bins[1] +</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;          (phi_bins[0] &gt; phi_bins[1] ? <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().n_bins : 0));</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;         ++phi_bin_iterator) {</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="comment">// Set up the phi bin index that we are actually meant to use inside of</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="comment">// the loop. We could also use a modulo operation here, but that would</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="comment">// be slightly more expensive in this specific case.</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keyword">const</span> detray::dindex phi_bin =</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            (phi_bin_iterator &gt;= <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().n_bins</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                 ? phi_bin_iterator - <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().n_bins</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                 : phi_bin_iterator);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160; </div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">// Iterate over all of the neighboring Z bins, including the same bin</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">// that the middle spacepoint is in. This is a much easier iteration, as</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="comment">// the Z axis does not &quot;wrap around&quot;.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">for</span> (detray::dindex z_bin = z_bins[0]; z_bin &lt;= z_bins[1]; ++z_bin) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="comment">// Ask the grid for all of the spacepoints in this specific bin.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keyword">typename</span> <a class="code" href="../../da/dad/namespacetraccc_1_1details_1_1functor.html#a357582a9a6874cb71ff052105af32ab2">const_sp_grid_device::serialized_storage::const_reference</a></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                spacepoints = <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(phi_bin, z_bin);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="comment">// Construct the &quot;single index&quot; that refers to this phi-Z bin.</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> other_bin_idx =</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                phi_bin + z_bin * <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.axis_p0().bins();</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = spacepoints.size();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="comment">// Loop over all of those spacepoints.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> other_sp_idx = 0; other_sp_idx &lt; size;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                 ++other_sp_idx) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="comment">// Access the &quot;other spacepoint&quot;.</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; other_sp =</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    spacepoints.at(other_sp_idx);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="comment">// Check if this spacepoint is a compatible &quot;bottom&quot; spacepoint</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="comment">// to the thread&#39;s &quot;middle&quot; spacepoint.</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">if</span> (doublet_finding_helper::isCompatible&lt;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                        details::spacepoint_type::bottom&gt;(middle_sp, other_sp,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                                          config)) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160; </div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    <span class="comment">// Add it as a candidate to the middle-bottom container.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos = mid_bot_start_idx + mid_bot_idx++;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                    assert(pos &lt; mb_doublets.size());</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                    mb_doublets.at(pos) = {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        {other_bin_idx, other_sp_idx},</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(globalIndex)};</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="comment">// Check if this spacepoint is a compatible &quot;top&quot; spacepoint to</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="comment">// the thread&#39;s &quot;middle&quot; spacepoint.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="keywordflow">if</span> (doublet_finding_helper::isCompatible&lt;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        details::spacepoint_type::top&gt;(middle_sp, other_sp,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                                       config)) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    <span class="comment">// Add it as a candidate to the middle-top container.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos = mid_top_start_idx + mid_top_idx++;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    assert(pos &lt; mt_doublets.size());</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    mt_doublets.at(pos) = {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                        {other_bin_idx, other_sp_idx},</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                        <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(globalIndex)};</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">traccc::sp_location::bin_idx</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cda71f262d796bed1ab30e8a2d5a8ddee6f">traccc::details::bottom</a>, <a class="el" href="../../dd/d78/structtraccc_1_1doublet__finding__helper.html#a208065db4a4af892094b49367d9f0aa6">traccc::doublet_finding_helper::isCompatible()</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#addce8fa393d5e6ced84b74fb55bab734">traccc::device::doublet_counter::m_posMidBot</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a6e3e93741b9c09b7d805c341aa885cbe">traccc::device::doublet_counter::m_posMidTop</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a3c736589d98a42e5bd7e5138e403f3f7">traccc::device::doublet_counter::m_spM</a>, <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#af67455f2be06f852fc5aa60b05053153">traccc::seedfinder_config::neighbor_scope</a>, <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#aaa38422e5479ae1dba0936f914a4893c">traccc::internal_spacepoint&lt; spacepoint_t &gt;::phi()</a>, <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">traccc::sp_location::sp_idx</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cdab28354b543375bfa94dabaeda722927f">traccc::details::top</a>, and <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#abb33de685f9235fe3fc2fbccbc3526cc">traccc::internal_spacepoint&lt; spacepoint_t &gt;::z()</a>.</p>

</div>
</div>
<a id="a5a0635de6424316c6518818af669c01a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a0635de6424316c6518818af669c01a">&#9670;&nbsp;</a></span>find_tracks()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename detector_t , typename config_t &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::find_tracks </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const config_t&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">typename detector_t::view_type&#160;</td>
          <td class="paramname"><em>det_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>measurements_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>in_params_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; const unsigned int &gt;&#160;</td>
          <td class="paramname"><em>n_measurements_prefix_sum_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; const unsigned int &gt;&#160;</td>
          <td class="paramname"><em>ref_meas_idx_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int &amp;&#160;</td>
          <td class="paramname"><em>n_max_candidates</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>out_params_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html">candidate_link</a> &gt;&#160;</td>
          <td class="paramname"><em>links_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>n_candidates</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function for combinatorial finding. If the chi2 of the measurement &lt; chi2_max, its measurement index and the index of the link from the previous step are added to the link container.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>Track finding config object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">det_data</td><td>Detector view object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurements_view</td><td>Measurements container view </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">upper_bounds_view</td><td>Upper bounds of measurements unique w.r.t barcode </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">in_params_view</td><td>Input parameters </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_measurements_prefix_sum_view</td><td>Prefix sum of the number of measurements per parameter </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">ref_meas_idx_view</td><td>The first index of measurements per parameter </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">step</td><td>Step index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_max_candidates</td><td>Number of maximum candidates </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_params_view</td><td>Output parameters </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">links_view</td><td>link container for the current step </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">n_candidates</td><td>The number of candidates for the current step </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;                                {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// Detector</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    detector_t det(det_data);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Measurement</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    measurement_collection_types::const_device measurements(measurements_view);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// Input parameters</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    bound_track_parameters_collection_types::const_device in_params(</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        in_params_view);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Output parameters</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    bound_track_parameters_collection_types::device out_params(out_params_view);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// Links</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    vecmem::device_vector&lt;candidate_link&gt; links(links_view);</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// Prefix sum of the number of measurements per parameter</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    vecmem::device_vector&lt;const unsigned int&gt; n_measurements_prefix_sum(</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        n_measurements_prefix_sum_view);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// Reference (first) measurement index per parameter</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    vecmem::device_vector&lt;const unsigned int&gt; ref_meas_idx(ref_meas_idx_view);</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// Last step ID</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> previous_step =</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        (step == 0) ? std::numeric_limits&lt;unsigned int&gt;::max() : step - 1;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_measurements_sum = n_measurements_prefix_sum.back();</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stride = globalIndex * cfg.n_measurements_per_thread;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    vecmem::device_vector&lt;const unsigned int&gt;::iterator lo1;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i_meas = 0; i_meas &lt; cfg.n_measurements_per_thread;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;         i_meas++) {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> idx = stride + i_meas;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keywordflow">if</span> (idx &gt;= n_measurements_sum) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160; </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">if</span> (i_meas == 0 || idx == *lo1) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            lo1 = thrust::lower_bound(thrust::seq,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                      n_measurements_prefix_sum.begin(),</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                                      n_measurements_prefix_sum.end(), idx + 1);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> in_param_id =</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            std::distance(n_measurements_prefix_sum.begin(), lo1);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="keyword">const</span> detray::geometry::barcode bcd =</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            in_params.at(in_param_id).surface_link();</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset =</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;            lo1 == n_measurements_prefix_sum.begin() ? idx : idx - *(lo1 - 1);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> meas_idx = ref_meas_idx.at(in_param_id) + offset;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a49b1ec1e09c6b63a918d97428dd51f2e">bound_track_parameters</a> in_par = in_params.at(in_param_id);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160; </div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span>&amp; meas = measurements.at(meas_idx);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        track_state&lt;typename detector_t::transform3&gt; trk_state(meas);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keyword">const</span> detray::surface&lt;detector_t&gt; sf{det, bcd};</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">// Run the Kalman update</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        sf.template visit_mask&lt;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            gain_matrix_updater&lt;typename detector_t::transform3&gt;&gt;(trk_state,</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                                                                  in_par);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="comment">// Get the chi-square</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> chi2 = trk_state.filtered_chi2();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">if</span> (chi2 &lt; cfg.chi2_max) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="comment">// Add measurement candidates to link</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            vecmem::device_atomic_ref&lt;unsigned int&gt; num_candidates(</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                n_candidates);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> l_pos = num_candidates.fetch_add(1);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160; </div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">if</span> (l_pos &gt;= n_max_candidates) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                n_candidates = n_max_candidates;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            links[l_pos] = {{previous_step, in_param_id}, meas_idx};</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160; </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            out_params[l_pos] = trk_state.filtered();</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="aac06f2e5b055c83e3ef9362207f325b3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac06f2e5b055c83e3ef9362207f325b3">&#9670;&nbsp;</a></span>find_triplets()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::find_triplets </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html">seedfilter_config</a> &amp;&#160;</td>
          <td class="paramname"><em>filter_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>sp_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>dc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_doublet_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>mid_top_doublet_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_spM_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spM_tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_triplet_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>triplet_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function finding all of the spacepoint triplets</p>
<p>Based on the information collected by <code><a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a697e375f53a1b9c334205c81c71746e4">traccc::device::count_triplets</a></code> it can fill collection with the specific triplets that exist in the event.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Seedfinder configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filter_config</td><td>Seedfilter configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_view</td><td>The spacepoint grid to find triplets on </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_view</td><td>Collection of doublet counters </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">mid_top_doublet_view</td><td>Collection with the mid top doublets </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spM_tc_view</td><td>Collection with the number of triplets per spM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tc_view</td><td>Collection with the number of triplets per midBot doublet </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">triplet_view</td><td>Collection of triplets </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                                                      {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const</span> triplet_counter_collection_types::const_device triplet_counts(</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        tc_view);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= triplet_counts.size()) {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    }</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Get device copy of input parameters</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">const</span> doublet_counter_collection_types::const_device doublet_counts(</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        dc_view);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keyword">const</span> device_doublet_collection_types::const_device mid_top_doublet_device(</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        mid_top_doublet_view);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">const_sp_grid_device</a> <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>(sp_view);</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">const</span> triplet_counter_spM_collection_types::const_device triplet_counts_spM(</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        spM_tc_view);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="comment">// Get the current work item information</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="keyword">const</span> triplet_counter mid_bot_counter = triplet_counts.at(globalIndex);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">const</span> triplet_counter_spM spM_counter =</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        triplet_counts_spM.at(mid_bot_counter.spM_counter_link);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keyword">const</span> doublet_counter doublet_count =</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        doublet_counts.at(mid_bot_counter.spM_counter_link);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">const</span> sp_location spM_loc = spM_counter.spM;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">const</span> sp_location spB_loc = mid_bot_counter.spB;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// middle spacepoint</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> spM =</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(spM_loc.bin_idx)[spM_loc.sp_idx];</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// bottom spacepoint</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> spB =</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(spB_loc.bin_idx)[spB_loc.sp_idx];</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Set up the device result collection</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    device_triplet_collection_types::device triplets(triplet_view);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160; </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="comment">// Apply the conformal transformation to middle-bot doublet</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html">traccc::lin_circle</a> lb = doublet_finding_helper::transform_coordinates&lt;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        details::spacepoint_type::bottom&gt;(spM, spB);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Calculate some physical quantities required for triplet compatibility</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// check</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> iSinTheta2 = 1 + lb.<a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">cotTheta</a>() * lb.<a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">cotTheta</a>();</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> scatteringInRegion2 = config.maxScatteringAngle2 * iSinTheta2 *</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                                       config.sigmaScattering *</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                                       config.sigmaScattering;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="comment">// These two quantities are used as output parameters in</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    <span class="comment">// triplet_finding_helper::isCompatible but their values are irrelevant</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> curvature, impact_parameter;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// find the reference (start) index of the mid-top doublet collection</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// item vector, where the doublets are recorded</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mt_start_idx = doublet_count.m_posMidTop;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mt_end_idx = mt_start_idx + doublet_count.m_nMidTop;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="comment">// The position in which these triplets should be filled is the sum of the</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// position for all triplets which share the same middle spacepoint</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// and the one for those which also share the same bottom spacepoint.</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> posTriplets =</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        mid_bot_counter.posTriplets + spM_counter.posTriplets;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="comment">// iterate over mid-top doublets</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = mt_start_idx; i &lt; mt_end_idx; ++i) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keyword">const</span> sp_location spT_loc = mid_top_doublet_device[i].sp2;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> spT =</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(spT_loc.bin_idx)[spT_loc.sp_idx];</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <span class="comment">// Apply the conformal transformation to middle-top doublet</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html">traccc::lin_circle</a> lt =</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            doublet_finding_helper::transform_coordinates&lt;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                details::spacepoint_type::top&gt;(spM, spT);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment">// Check if mid-bot and mid-top doublets can form a triplet</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">if</span> (triplet_finding_helper::isCompatible(</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                spM, lb, lt, config, iSinTheta2, scatteringInRegion2, curvature,</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                impact_parameter)) {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="comment">// Add triplet to jagged vector</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            triplets.at(posTriplets++) = device_triplet(</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                {spT_loc, <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(globalIndex), curvature,</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                 -impact_parameter * filter_config.impactWeightFactor,</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                 lb.<a class="code" href="../../d1/d20/structtraccc_1_1lin__circle.html#ab35afbdb99bb552cc8a85cf517aabfbc">Zo</a>()});</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">traccc::sp_location::bin_idx</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cda71f262d796bed1ab30e8a2d5a8ddee6f">traccc::details::bottom</a>, <a class="el" href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">traccc::lin_circle::cotTheta()</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#ab4dc18842ae03b2b47a1e4c33d11e739">traccc::seedfilter_config::impactWeightFactor</a>, <a class="el" href="../../dc/d8e/structtraccc_1_1triplet__finding__helper.html#a2bcf66c0ebe8c89242f0f132e81a76ab">traccc::triplet_finding_helper::isCompatible()</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a75265b59ac68b59b0946f7f4045ddf2c">traccc::device::doublet_counter::m_nMidTop</a>, <a class="el" href="../../da/d27/structtraccc_1_1device_1_1doublet__counter.html#a6e3e93741b9c09b7d805c341aa885cbe">traccc::device::doublet_counter::m_posMidTop</a>, <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#ad621edcb12b86883b431e8c581da51ef">traccc::seedfinder_config::maxScatteringAngle2</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#a87b4bc7c651c85cc1f358022e157411f">traccc::device::triplet_counter_spM::posTriplets</a>, <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#a627caf65afde62b0f88982e41d734417">traccc::device::triplet_counter::posTriplets</a>, <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#a599852ee91a92905c57cd532b5659d1c">traccc::seedfinder_config::sigmaScattering</a>, <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">traccc::sp_location::sp_idx</a>, <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#a2bb92311f2868cd2430e6d805587d1ea">traccc::device::triplet_counter::spB</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#ad053bf6f6b3d4e571d13dda13e4b5358">traccc::device::triplet_counter_spM::spM</a>, <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#a1f2b6669bd4dd2461885917cf7d32fcb">traccc::device::triplet_counter::spM_counter_link</a>, <a class="el" href="../../df/d72/namespacetraccc_1_1details.html#ad6f0fdca83bc59ab474c5693370421cdab28354b543375bfa94dabaeda722927f">traccc::details::top</a>, <a class="el" href="../../dd/d78/structtraccc_1_1doublet__finding__helper.html#ad5f94a6c063d05a2f46cd7340b71ce77">traccc::doublet_finding_helper::transform_coordinates()</a>, and <a class="el" href="../../d1/d20/structtraccc_1_1lin__circle.html#ab35afbdb99bb552cc8a85cf517aabfbc">traccc::lin_circle::Zo()</a>.</p>

</div>
</div>
<a id="a97659978710a9e2d389c05b9ee4397ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97659978710a9e2d389c05b9ee4397ae">&#9670;&nbsp;</a></span>fit()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename fitter_t , typename detector_view_t &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::fit </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">detector_view_t&#160;</td>
          <td class="paramname"><em>det_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const typename fitter_t::bfield_type&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const typename fitter_t::config_type&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::jagged_vector_view&lt; typename fitter_t::intersection_type &gt;&#160;</td>
          <td class="paramname"><em>nav_candidates_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d93/structtraccc_1_1container__types.html#aa6a3c3afb08abf3aad41b6002ef8b48f">track_candidate_container_types::const_view</a>&#160;</td>
          <td class="paramname"><em>track_candidates_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/d93/structtraccc_1_1container__types.html#a3344afd1f08f09bcec6d7206d380b26c">track_state_container_types::view</a>&#160;</td>
          <td class="paramname"><em>track_states_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for fitting a track for a given track candidates</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">det_data</td><td>Detector view object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nav_candidates_buffer</td><td>Buffer for navigation candidate objects </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">track_candidates_view</td><td>The input track candidates </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">track_states_view</td><td>The output of fitted track states </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                                       {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keyword">typename</span> fitter_t::detector_type det(det_data);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    vecmem::jagged_device_vector&lt;typename fitter_t::intersection_type&gt;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        nav_candidates(nav_candidates_buffer);</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160; </div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    track_candidate_container_types::const_device track_candidates(</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        track_candidates_view);</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    track_state_container_types::device track_states(track_states_view);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    fitter_t fitter(det, field_data, cfg);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160; </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= track_states.size()) {</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    }</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// Track candidates per track</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; track_candidates_per_track =</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        track_candidates[globalIndex].items;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160; </div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="comment">// Seed parameter</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span>&amp; seed_param = track_candidates[globalIndex].header;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    <span class="comment">// Track states per track</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="keyword">auto</span> track_states_per_track = track_states[globalIndex].items;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160; </div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="keywordflow">for</span> (<span class="keyword">auto</span>&amp; cand : track_candidates_per_track) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        track_states_per_track.emplace_back(cand);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="keyword">typename</span> fitter_t::state fitter_state(track_states_per_track);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// Run fitting</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    fitter.fit(seed_param, fitter_state, nav_candidates.at(globalIndex));</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="comment">// Get the final fitting information</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    track_states[globalIndex].header = fitter_state.m_fit_info;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d4/d1a/classtraccc_1_1device__container.html#a75e353386eb277f1755300a9d2f05be0">traccc::device_container&lt; header_t, item_t &gt;::size()</a>.</p>

</div>
</div>
<a id="ad06299bae21c8e751058d3c70ee6a857"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad06299bae21c8e751058d3c70ee6a857">&#9670;&nbsp;</a></span>form_spacepoints()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::form_spacepoints </td>
          <td>(</td>
          <td class="paramtype">const std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>measurements_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">cell_module_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>modules_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>measurement_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">spacepoint_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>spacepoints_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function for creating 3D spacepoints out of 2D measurements</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index for the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurements_view</td><td>Collection of measurements </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">modules_view</td><td>Collection of modules (which the measurements link to) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">measurement_count</td><td>Number of measurements </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">spacepoints_view</td><td>Collection of spacepoints </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                                                      {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="comment">// Get device copy of input parameters</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keyword">const</span> measurement_collection_types::const_device measurements_device(</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        measurements_view);</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">// Check if anything needs to be done</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= measurement_count) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// Get device copy of input parameters</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> cell_module_collection_types::const_device modules_device(</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        modules_view);</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    spacepoint_collection_types::device spacepoints_device(spacepoints_view);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Get the measurement for this index</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">const</span> measurement&amp; meas = measurements_device.at(globalIndex);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="comment">// Get the current cell module</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="keyword">const</span> cell_module&amp; mod = modules_device.at(meas.module_link);</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// Form a spacepoint based on this measurement</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#a7a1ed25524ba151f7ee54cec655fb3f3">point3</a> local_3d = {meas.local[0], meas.local[1], 0.};</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <a class="code" href="../../d7/d7b/namespacetraccc.html#a7a1ed25524ba151f7ee54cec655fb3f3">point3</a> global = mod.placement.point_to_global(local_3d);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Fill the result object with this spacepoint</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    spacepoints_device[globalIndex] = {global, meas};</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#a23d5f297b506857cafa3feb88c06540c">traccc::measurement::local</a>, <a class="el" href="../../d8/d8e/structtraccc_1_1measurement.html#afe3a50efe16166506b7877d898e200aa">traccc::measurement::module_link</a>, and <a class="el" href="../../dc/d5d/structtraccc_1_1cell__module.html#a3a2055223dd9b5837a498c435198fd86">traccc::cell_module::placement</a>.</p>

</div>
</div>
<a id="a32c38f509eef5398c63cc66721db1a83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a32c38f509eef5398c63cc66721db1a83">&#9670;&nbsp;</a></span>is_adjacent()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> bool traccc::device::is_adjacent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a>&#160;</td>
          <td class="paramname"><em>ac0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a>&#160;</td>
          <td class="paramname"><em>ac1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a>&#160;</td>
          <td class="paramname"><em>bc0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a>&#160;</td>
          <td class="paramname"><em>bc1</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                                        {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p0 = (ac0 - bc0);</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> p1 = (ac1 - bc1);</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keywordflow">return</span> p0 * p0 &lt;= 1 &amp;&amp; p1 * p1 &lt;= 1;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ab8368c09597104f9b3fecf98b4a1111d">reduce_problem_cell()</a>.</p>

</div>
</div>
<a id="aee8f3ca7cc59d443151e6da536f1fb36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee8f3ca7cc59d443151e6da536f1fb36">&#9670;&nbsp;</a></span>make_barcode_sequence()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::make_barcode_sequence </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">measurement_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>uniques_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; detray::geometry::barcode &gt;&#160;</td>
          <td class="paramname"><em>barcodes_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function filling the barcode sequence</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">uniques_view</td><td>Measurement container view object </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">barcodes_view</td><td>Unsorted module map of &lt;module ID, header ID&gt; </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                                                                {</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    measurement_collection_types::const_device uniques(uniques_view);</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;    vecmem::device_vector barcodes(barcodes_view);</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160; </div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= uniques.size()) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    }</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">// Assign barcode</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    barcodes.at(globalIndex) = uniques.at(globalIndex).surface_link;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a782823d57c341df346a3589010537dbf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a782823d57c341df346a3589010537dbf">&#9670;&nbsp;</a></span>make_prefix_sum_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95b39033664ff24e9b2f42ef43041ad0">TRACCC_HOST</a> <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a1c67d5b48697c4ad899f28ae69120e33">prefix_sum_buffer_t</a> traccc::device::make_prefix_sum_buffer </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>sizes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::copy &amp;&#160;</td>
          <td class="paramname"><em>copy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../dc/db2/structtraccc_1_1memory__resource.html">traccc::memory_resource</a> &amp;&#160;</td>
          <td class="paramname"><em>mr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Function providing the prefix sum for a "size vector"</p>
<p>This simple function is just meant to translate the received "size vector" into its prefix sum. I.e. Each element of the output vector equals the summation of all the elements up to that point of the input vector</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sizes</td><td>The sizes of the "inner vectors" of a jagged vector </td></tr>
    <tr><td class="paramname">copy</td><td>A "copy object" capable of dealing with the view </td></tr>
    <tr><td class="paramname">mr</td><td>The memory resource to use of the result </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A class containing the prefix sum view, a memory posessing object on the view elements, and the total summation of the size vector </dd></dl>
<div class="fragment"><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                                     {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">if</span> (sizes.size() == 0) {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;        <span class="keywordflow">return</span> {{}, {}, 0};</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160; </div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="comment">// Create vector with summation of sizes</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    vecmem::vector&lt;prefix_sum_size_t&gt; sizes_sum(sizes.size(),</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;                                                mr.<a class="code" href="../../dc/db2/structtraccc_1_1memory__resource.html#a3a7e6ce915149a10e37a9e9c6d73bf95">host</a> ? mr.<a class="code" href="../../dc/db2/structtraccc_1_1memory__resource.html#a3a7e6ce915149a10e37a9e9c6d73bf95">host</a> : &amp;(mr.<a class="code" href="../../dc/db2/structtraccc_1_1memory__resource.html#a9f1136a4fdab877dd1bbd1a2996e2149">main</a>));</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    std::partial_sum(sizes.begin(), sizes.end(), sizes_sum.begin(),</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                     std::plus&lt;prefix_sum_size_t&gt;());</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">prefix_sum_size_t</a> totalSize = sizes_sum.back();</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (mr.<a class="code" href="../../dc/db2/structtraccc_1_1memory__resource.html#a3a7e6ce915149a10e37a9e9c6d73bf95">host</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="comment">// Create buffer and view objects</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        vecmem::data::vector_buffer&lt;prefix_sum_size_t&gt; sizes_sum_buff(</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            sizes_sum.size(), mr.<a class="code" href="../../dc/db2/structtraccc_1_1memory__resource.html#a9f1136a4fdab877dd1bbd1a2996e2149">main</a>);</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        copy.setup(sizes_sum_buff);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        (copy)(<a class="code" href="../../d7/d7b/namespacetraccc.html#a503d2d50b981602cbc71693ad215b298">vecmem::get_data</a>(sizes_sum), sizes_sum_buff)-&gt;wait();</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        vecmem::data::vector_view&lt;prefix_sum_size_t&gt; sizes_sum_view(</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            sizes_sum_buff);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="keywordflow">return</span> {sizes_sum_view, std::move(sizes_sum_buff), totalSize};</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="comment">// Create view object</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        vecmem::data::vector_view&lt;prefix_sum_size_t&gt; sizes_sum_view =</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <a class="code" href="../../d7/d7b/namespacetraccc.html#a503d2d50b981602cbc71693ad215b298">vecmem::get_data</a>(sizes_sum);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">return</span> {sizes_sum_view, std::move(sizes_sum), totalSize};</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/d7b/namespacetraccc.html#a503d2d50b981602cbc71693ad215b298">traccc::get_data()</a>, <a class="el" href="../../dc/db2/structtraccc_1_1memory__resource.html#a3a7e6ce915149a10e37a9e9c6d73bf95">traccc::memory_resource::host</a>, and <a class="el" href="../../dc/db2/structtraccc_1_1memory__resource.html#a9f1136a4fdab877dd1bbd1a2996e2149">traccc::memory_resource::main</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d5/d9e/namespacetraccc_1_1kokkos.html#ac6275a34fac6619caab789d57a5c0209">traccc::kokkos::make_prefix_sum_buff()</a>, and <a class="el" href="../../d9/df9/namespacetraccc_1_1alpaka.html#a318644685d595428ae8c6fc02728b694">traccc::alpaka::make_prefix_sum_buff()</a>.</p>

</div>
</div>
<a id="ab5cd1251ac7c7ded70369df125d151e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5cd1251ac7c7ded70369df125d151e5">&#9670;&nbsp;</a></span>populate_grid()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::populate_grid </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html">seedfinder_config</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spacepoints</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d7b/namespacetraccc.html#a5044143e89d8abc4a09e7829850cdfdc">sp_grid_view</a>&#160;</td>
          <td class="paramname"><em>grid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function populating the spacepoint grid</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">config</td><td>Seedfinder configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spacepoints</td><td>All the spacepoints of the event </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">grid</td><td>The spacepoint grid to populate </td></tr>
  </table>
  </dd>
</dl>
<p>Check out if the spacepoint can be used for seeding.</p>
<div class="fragment"><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                            {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="keyword">const</span> spacepoint_collection_types::const_device spacepoints(</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        spacepoints_view);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= spacepoints.size()) {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    }</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    <span class="keyword">const</span> spacepoint sp = spacepoints.at(globalIndex);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d7b/namespacetraccc.html#a4e12ff4b9f7297ad771d4fe8ecc17304">is_valid_sp</a>(config, sp) != detray::detail::invalid_value&lt;size_t&gt;()) {</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        <span class="comment">// Set up the spacepoint grid object(s).</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#afe5550543749e1fde57f965020411065">sp_grid_device</a> grid(grid_view);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keyword">const</span> sp_grid_device::axis_p0_type&amp; phi_axis = grid.axis_p0();</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keyword">const</span> sp_grid_device::axis_p1_type&amp; z_axis = grid.axis_p1();</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment">// Find the grid bin that the spacepoint belongs to.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; isp(sp, globalIndex,</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                                  config.beamPos);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keyword">const</span> std::size_t bin_index =</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            phi_axis.bin(isp.phi()) + phi_axis.bins() * z_axis.bin(isp.z());</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="comment">// Add the spacepoint to the grid.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        grid.bin(bin_index).push_back(std::move(isp));</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    }</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d8/dda/structtraccc_1_1seedfinder__config.html#ad5a0905e9ce28b8501fa21bad52520bd">traccc::seedfinder_config::beamPos</a>, <a class="el" href="../../d7/d7b/namespacetraccc.html#a4e12ff4b9f7297ad771d4fe8ecc17304">traccc::is_valid_sp()</a>, <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#aaa38422e5479ae1dba0936f914a4893c">traccc::internal_spacepoint&lt; spacepoint_t &gt;::phi()</a>, and <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#abb33de685f9235fe3fc2fbccbc3526cc">traccc::internal_spacepoint&lt; spacepoint_t &gt;::z()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../df/deb/classtraccc_1_1kokkos_1_1spacepoint__binning.html#a1ba66ab0c511ed951052cb28e1412d55">traccc::kokkos::spacepoint_binning::operator()()</a>.</p>

</div>
</div>
<a id="a5fbc8641d583065ed1ebc98503d01f10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5fbc8641d583065ed1ebc98503d01f10">&#9670;&nbsp;</a></span>propagate_to_next_surface()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename propagator_t , typename bfield_t , typename config_t &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a95e1c711b776a8c1d0ece5b492f5a5e6">TRACCC_DEVICE</a> void traccc::device::propagate_to_next_surface </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const config_t&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">typename propagator_t::detector_type::view_type&#160;</td>
          <td class="paramname"><em>det_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bfield_t&#160;</td>
          <td class="paramname"><em>field_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::jagged_vector_view&lt; typename propagator_t::intersection_type &gt;&#160;</td>
          <td class="paramname"><em>nav_candidates_buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">bound_track_parameters_collection_types::const_view</a>&#160;</td>
          <td class="paramname"><em>in_params_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; const <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html">candidate_link</a> &gt;&#160;</td>
          <td class="paramname"><em>links_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>step</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int &amp;&#160;</td>
          <td class="paramname"><em>n_in_params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">bound_track_parameters_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>out_params_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; unsigned int &gt;&#160;</td>
          <td class="paramname"><em>param_to_link_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">vecmem::data::vector_view&lt; typename <a class="el" href="../../df/d75/structtraccc_1_1candidate__link.html#a43e4355337d1d689215e7a0c69b86636">candidate_link::link_index_type</a> &gt;&#160;</td>
          <td class="paramname"><em>tips_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>n_out_params</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function for propagating the kalman-updated tracks to the next surface</p>
<p>If a track finds a surface that contains measurements, its bound track parameter on the surface will be used for the next step. Otherwise, the link is added into the tip link container so that we can know which links in the link container are the final measurements of full tracks</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>Track finding config object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">det_data</td><td>Detector view object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nav_candidates_buffer</td><td>Navgation buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">in_params_view</td><td>Input parameters </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">links_view</td><td>Link container for the current step </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">step</td><td>Step index </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n_in_params</td><td>The number of input parameters </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_params_view</td><td>Output parameters </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">param_to_link_view</td><td>Container for param index -&gt; link index </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tips_view</td><td>Tip link container for the current step </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">n_out_params</td><td>The number of output parameters </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;                                {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160; </div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= n_in_params) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    }</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// Detector</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keyword">typename</span> propagator_t::detector_type det(det_data);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Navigation candidate buffer</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    vecmem::jagged_device_vector&lt;typename propagator_t::intersection_type&gt;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        nav_candidates(nav_candidates_buffer);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">// Input parameters</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    bound_track_parameters_collection_types::const_device in_params(</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        in_params_view);</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Links</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    vecmem::device_vector&lt;const candidate_link&gt; links(links_view);</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// Out parameters</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    bound_track_parameters_collection_types::device out_params(out_params_view);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="comment">// Param to Link ID</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    vecmem::device_vector&lt;unsigned int&gt; param_to_link(param_to_link_view);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160; </div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    <span class="comment">// tips</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    vecmem::device_vector&lt;typename candidate_link::link_index_type&gt; tips(</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        tips_view);</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <span class="comment">// Input bound track parameter</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#a49b1ec1e09c6b63a918d97428dd51f2e">bound_track_parameters</a> in_par = in_params.at(globalIndex);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// Create propagator</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    propagator_t propagator({}, {});</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160; </div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    <span class="comment">// Create propagator state</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="keyword">typename</span> propagator_t::state propagation(</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        in_par, field_data, det, std::move(nav_candidates.at(globalIndex)));</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    propagation._stepping</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        .template set_constraint&lt;detray::step::constraint::e_accuracy&gt;(</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            cfg.constrained_step_size);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Actor state</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// @TODO: simplify the syntax here</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="comment">// @NOTE: Post material interaction might be required here</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">using</span> actor_list_type =</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keyword">typename</span> propagator_t::actor_chain_type::actor_list_type;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">typename</span> detray::detail::tuple_element&lt;0, actor_list_type&gt;::type::state</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        s0{};</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">typename</span> detray::detail::tuple_element&lt;1, actor_list_type&gt;::type::state</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        s1{};</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">typename</span> detray::detail::tuple_element&lt;3, actor_list_type&gt;::type::state</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        s3{};</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keyword">typename</span> detray::detail::tuple_element&lt;2, actor_list_type&gt;::type::state s2{</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        s3};</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keyword">typename</span> detray::detail::tuple_element&lt;4, actor_list_type&gt;::type::state s4{</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        cfg.min_step_length_for_surface_aborter};</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="comment">// @TODO: Should be removed once detray is fixed to set the volume in the</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="comment">// constructor</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    propagation._navigation.set_volume(in_par.surface_link().volume());</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// Propagate to the next surface</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    propagator.propagate_sync(propagation, std::tie(s0, s1, s2, s3, s4));</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// If a surface found, add the parameter for the next step</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (s4.success) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        vecmem::device_atomic_ref&lt;unsigned int&gt; num_out_params(n_out_params);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> out_param_id = num_out_params.fetch_add(1);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        out_params[out_param_id] = propagation._stepping._bound_params;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        param_to_link[out_param_id] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(globalIndex);</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Unless the track found a surface, it is considered a tip</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!s4.success &amp;&amp; step &gt;= cfg.min_track_candidates_per_track - 1) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        tips.push_back({step, globalIndex});</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ab8368c09597104f9b3fecf98b4a1111d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8368c09597104f9b3fecf98b4a1111d">&#9670;&nbsp;</a></span>reduce_problem_cell()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::reduce_problem_cell </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a2c17f74f33da865b1fb58c83e44ecb71">cell_collection_types::const_device</a> &amp;&#160;</td>
          <td class="paramname"><em>cells</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned short&#160;</td>
          <td class="paramname"><em>cid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char &amp;&#160;</td>
          <td class="paramname"><em>adjc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned short&#160;</td>
          <td class="paramname"><em>adjv</em>[8]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function for looking for adjacent cells. The cell ids will range from 0 to max_cells_per_partition and the number of blocks will equal the number of partitions, hence checking all cells.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cells</td><td>Collection of cells </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cid</td><td>Current cell id </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">start</td><td>Current partition start point </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">end</td><td>Current partition end point </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ajc</td><td>Number of adjacent cells </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ajv</td><td>Indices of adjacent cells </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;                            {</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160; </div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos = cid + start;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="comment">// Check if this code can benefit from changing to structs of arrays, as the</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;    <span class="comment">// recurring accesses to cell data in global memory is slow right now.</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> c0 = cells[pos].channel0;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">channel_id</a> c1 = cells[pos].channel1;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> mod_id = cells[pos].module_link;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">     * First, we traverse the cells backwards, starting from the current</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">     * cell and working back to the first, collecting adjacent cells</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">     * along the way.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = pos - 1; j &lt; pos; --j) {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">         * Since the data is sorted, we can assume that if we see a cell</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">         * sufficiently far away in both directions, it becomes</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">         * impossible for that cell to ever be adjacent to this one.</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">         * This is a small optimisation.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keywordflow">if</span> (cells[j].channel1 + 1 &lt; c1 || cells[j].module_link != mod_id) {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">         * If the cell examined is adjacent to the current cell, save it</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">         * in the current cell&#39;s adjacency set.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#a32c38f509eef5398c63cc66721db1a83">is_adjacent</a>(c0, c1, cells[j].channel0, cells[j].channel1)) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            adjv[adjc++] = j - start;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">     * Now we examine all the cells past the current one, using almost</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">     * the same logic as in the backwards pass.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = pos + 1; j &lt; end; ++j) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">         * Note that this check now looks in the opposite direction! An</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">         * important difference.</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span> (cells[j].channel1 &gt; c1 + 1 || cells[j].module_link != mod_id) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="../../d0/db6/namespacetraccc_1_1device.html#a32c38f509eef5398c63cc66721db1a83">is_adjacent</a>(c0, c1, cells[j].channel0, cells[j].channel1)) {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            adjv[adjc++] = j - start;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a32c38f509eef5398c63cc66721db1a83">is_adjacent()</a>.</p>

<p class="reference">Referenced by <a class="el" href="../../d0/db6/namespacetraccc_1_1device.html#a581cd4e1e686b1e742185eac2da41369">ccl_kernel()</a>.</p>

</div>
</div>
<a id="a0aea434e4a014b6fd621ebd0d7100fbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0aea434e4a014b6fd621ebd0d7100fbe">&#9670;&nbsp;</a></span>reduce_triplet_counts()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::reduce_triplet_counts </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">doublet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>dc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">triplet_counter_spM_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>spM_tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>num_triplets</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for performing a reduction on the triplet counters</p>
<p>The <code>count_triplets</code> function will only count the number of triplets per each middle spacepoint independently. Thus, we need to perform a sum over all middle spacepoints, as well as correctly claim the positions in which the triplets will be filled in <code>find:triplets</code> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dc_view</td><td>Collection of doublet counters </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">spM_tc_view</td><td>Collection of triplet counters per middle spacepoint </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">num_triplets</td><td>The total number of triplets </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160; </div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    <span class="comment">// Get device copy of input parameters</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    triplet_counter_spM_collection_types::device spM_counts(spM_tc_view);</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= spM_counts.size()) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keyword">const</span> doublet_counter_collection_types::const_device doublet_counts(</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        dc_view);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="comment">// This should only ever be called with two collections of equal size</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    assert(doublet_counts.size() == spM_counts.size());</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// Get triplet counter for this middle spacepoint</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    triplet_counter_spM&amp; this_spM_counter = spM_counts.at(globalIndex);</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keywordflow">if</span> (this_spM_counter.m_nTriplets == 0) {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160; </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <span class="comment">// Fill the middle spacepoint information of the spM triplet counter</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    this_spM_counter.spM = doublet_counts.at(globalIndex).m_spM;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// Increment total number of triplets and claim position for this middle</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// spacepoint&#39;s triplets</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    vecmem::device_atomic_ref&lt;unsigned int&gt; nTriplets(num_triplets);</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    this_spM_counter.posTriplets =</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        nTriplets.fetch_add(this_spM_counter.m_nTriplets);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#a42fd8a48c0ecc021ef4b726b9770eb8e">traccc::device::triplet_counter_spM::m_nTriplets</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#a87b4bc7c651c85cc1f358022e157411f">traccc::device::triplet_counter_spM::posTriplets</a>, and <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#ad053bf6f6b3d4e571d13dda13e4b5358">traccc::device::triplet_counter_spM::spM</a>.</p>

</div>
</div>
<a id="ada5aab00f224f7d53c4b717042d099c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada5aab00f224f7d53c4b717042d099c4">&#9670;&nbsp;</a></span>select_seeds()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::select_seeds </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html">seedfilter_config</a> &amp;&#160;</td>
          <td class="paramname"><em>filter_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">spacepoint_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spacepoints_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>internal_sp_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_spM_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spM_tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">device_triplet_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>triplet_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/d24/structtraccc_1_1triplet.html">triplet</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">seed_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>seed_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for selecting good triplets to be recorded into seed collection</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filter_config</td><td>Seed filter config </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spacepoints_view</td><td>Collection of spacepoints </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">internal_sp_view</td><td>The spacepoint grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spM_tc_view</td><td>Collection with the number of triplets per spM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">triplet_view</td><td>Collection of triplets </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Array for temporary storage of triplets for comparison </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">seed_view</td><td>Collection of seeds </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                                                        {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">const</span> triplet_counter_spM_collection_types::const_device triplet_counts_spM(</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        spM_tc_view);</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= triplet_counts_spM.size()) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="comment">// Set up the device containers</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <span class="keyword">const</span> triplet_counter_collection_types::const_device triplet_counts(</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        tc_view);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keyword">const</span> spacepoint_collection_types::const_device spacepoints_device(</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        spacepoints_view);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">const_sp_grid_device</a> internal_sp_device(internal_sp_view);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    device_triplet_collection_types::const_device triplets(triplet_view);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    seed_collection_types::device seeds_device(seed_view);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160; </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">// Current work item = middle spacepoint</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <span class="keyword">const</span> triplet_counter_spM spM_counter = triplet_counts_spM.at(globalIndex);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keyword">const</span> sp_location spM_loc = spM_counter.spM;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; spM =</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        internal_sp_device.bin(spM_loc.bin_idx)[spM_loc.sp_idx];</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="comment">// Number of triplets added for this spM</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_triplets_per_spM = 0;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> end_triplets_spM =</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        spM_counter.posTriplets + spM_counter.m_nTriplets;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="comment">// iterate over the triplets in the bin</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = spM_counter.posTriplets; i &lt; end_triplets_spM; ++i) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        device_triplet aTriplet = triplets[i];</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160; </div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="comment">// spacepoints bottom and top for this triplet</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="keyword">const</span> sp_location spB_loc =</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            triplet_counts.at(aTriplet.counter_link).spB;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <span class="keyword">const</span> sp_location spT_loc = aTriplet.spT;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; spB =</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            internal_sp_device.bin(spB_loc.bin_idx)[spB_loc.sp_idx];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt; spT =</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            internal_sp_device.bin(spT_loc.bin_idx)[spT_loc.sp_idx];</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">// update weight of triplet</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        seed_selecting_helper::seed_weight(filter_config, spM, spB, spT,</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                                           aTriplet.weight);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="comment">// check if it is a good triplet</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="keywordflow">if</span> (!seed_selecting_helper::single_seed_cut(filter_config, spM, spB,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                                                    spT, aTriplet.weight)) {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        }</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160; </div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        <span class="comment">// if the number of good triplets is larger than the threshold,</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// the triplet with the lowest weight is removed</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">if</span> (n_triplets_per_spM &gt;= filter_config.max_triplets_per_spM) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> min_index =</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <a class="code" href="../../db/d86/namespacetraccc_1_1device_1_1details.html#a8f4ac52a914ad8541e79747fe5031ea9">details::min_elem</a>(data, 0, filter_config.max_triplets_per_spM,</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                  [](<span class="keyword">const</span> triplet lhs, <span class="keyword">const</span> triplet rhs) {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                                      return lhs.weight &gt; rhs.weight;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                                  });</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a>&amp; min_weight = data[min_index].weight;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160; </div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">if</span> (aTriplet.weight &gt; min_weight) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                data[min_index] = {spB_loc,         spM_loc,</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                                   spT_loc,         aTriplet.curvature,</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                                   aTriplet.weight, aTriplet.z_vertex};</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            }</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">// if the number of good triplets is below the threshold, add</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="comment">// the current triplet to the array</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n_triplets_per_spM &lt; filter_config.max_triplets_per_spM) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            data[n_triplets_per_spM] = {spB_loc,         spM_loc,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                        spT_loc,         aTriplet.curvature,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                        aTriplet.weight, aTriplet.z_vertex};</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            n_triplets_per_spM++;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="comment">// sort the triplets per spM</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="../../db/d86/namespacetraccc_1_1device_1_1details.html#a78a788b16fc4939f7c8ad1db674160d7">details::insertionSort</a>(</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        data, 0, n_triplets_per_spM, [&amp;](triplet&amp; lhs, triplet&amp; rhs) {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">if</span> (lhs.weight != rhs.weight) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                return lhs.weight &gt; rhs.weight;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                scalar seed1_sum = 0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                scalar seed2_sum = 0;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160; </div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                const internal_spacepoint&lt;spacepoint&gt;&amp; ispB1 =</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    internal_sp_device.bin(lhs.sp1.bin_idx)[lhs.sp1.sp_idx];</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                const internal_spacepoint&lt;spacepoint&gt;&amp; ispT1 =</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                    internal_sp_device.bin(lhs.sp3.bin_idx)[lhs.sp3.sp_idx];</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                const internal_spacepoint&lt;spacepoint&gt;&amp; ispB2 =</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    internal_sp_device.bin(rhs.sp1.bin_idx)[rhs.sp1.sp_idx];</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                const internal_spacepoint&lt;spacepoint&gt;&amp; ispT2 =</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    internal_sp_device.bin(rhs.sp3.bin_idx)[rhs.sp3.sp_idx];</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                const spacepoint&amp; spB1 = spacepoints_device.at(ispB1.m_link);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                const spacepoint&amp; spT1 = spacepoints_device.at(ispT1.m_link);</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                const spacepoint&amp; spB2 = spacepoints_device.at(ispB2.m_link);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                const spacepoint&amp; spT2 = spacepoints_device.at(ispT2.m_link);</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                constexpr scalar exp = 2;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                seed1_sum += std::pow(spB1.y(), exp) + std::pow(spB1.z(), exp);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                seed1_sum += std::pow(spT1.y(), exp) + std::pow(spT1.z(), exp);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                seed2_sum += std::pow(spB2.y(), exp) + std::pow(spB2.z(), exp);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                seed2_sum += std::pow(spT2.y(), exp) + std::pow(spT2.z(), exp);</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160; </div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                return seed1_sum &gt; seed2_sum;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        });</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160; </div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// the number of good seed per compatible middle spacepoint</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_seeds_per_spM = 0;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// iterate over the good triplets for final selection of seeds</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; n_triplets_per_spM; ++i) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keyword">const</span> triplet&amp; aTriplet = data[i];</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="keyword">const</span> sp_location&amp; spB_loc = aTriplet.sp1;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keyword">const</span> sp_location&amp; spT_loc = aTriplet.sp3;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt;&amp; spB =</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            internal_sp_device.bin(spB_loc.bin_idx)[spB_loc.sp_idx];</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keyword">const</span> internal_spacepoint&lt;spacepoint&gt;&amp; spT =</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            internal_sp_device.bin(spT_loc.bin_idx)[spT_loc.sp_idx];</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="comment">// if the number of seeds reaches the threshold, break</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="keywordflow">if</span> (n_seeds_per_spM &gt;= filter_config.maxSeedsPerSpM + 1) {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160; </div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        seed aSeed({spB.m_link, spM.m_link, spT.m_link, aTriplet.weight,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                    aTriplet.z_vertex});</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// check if it is a good triplet</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">if</span> (seed_selecting_helper::cut_per_middle_sp(</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                filter_config, spacepoints_device, aSeed, aTriplet.weight) ||</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            n_seeds_per_spM == 0) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160; </div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            n_seeds_per_spM++;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            seeds_device.push_back(aSeed);</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">traccc::sp_location::bin_idx</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#a9009ebd7e3342f34eb55eeaa25fdac3e">traccc::device::device_triplet::counter_link</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#adbdfe680b24f38562f16c9e8a60510c4">traccc::device::device_triplet::curvature</a>, <a class="el" href="../../d0/dfd/structtraccc_1_1seed__selecting__helper.html#a0e26c12230b1e334608f5fddefdbcbad">traccc::seed_selecting_helper::cut_per_middle_sp()</a>, <a class="el" href="../../db/d86/namespacetraccc_1_1device_1_1details.html#a78a788b16fc4939f7c8ad1db674160d7">traccc::device::details::insertionSort()</a>, <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#a3e4844a2432711dae2c8360fa85ba3e5">traccc::internal_spacepoint&lt; spacepoint_t &gt;::m_link</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#a42fd8a48c0ecc021ef4b726b9770eb8e">traccc::device::triplet_counter_spM::m_nTriplets</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#a55f7630d397696366b11d25f45cc8aca">traccc::seedfilter_config::max_triplets_per_spM</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#a928d6073c4227858bb5235383378a9c5">traccc::seedfilter_config::maxSeedsPerSpM</a>, <a class="el" href="../../db/d86/namespacetraccc_1_1device_1_1details.html#a8f4ac52a914ad8541e79747fe5031ea9">traccc::device::details::min_elem()</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#a87b4bc7c651c85cc1f358022e157411f">traccc::device::triplet_counter_spM::posTriplets</a>, <a class="el" href="../../d0/dfd/structtraccc_1_1seed__selecting__helper.html#a3485432622be6326cc00b091a1eb685f">traccc::seed_selecting_helper::seed_weight()</a>, <a class="el" href="../../d0/dfd/structtraccc_1_1seed__selecting__helper.html#aaa344059053c3334c8753bc98077008f">traccc::seed_selecting_helper::single_seed_cut()</a>, <a class="el" href="../../db/d24/structtraccc_1_1triplet.html#a453d965c78d3ce6c0aee3ad81889ee61">traccc::triplet::sp1</a>, <a class="el" href="../../db/d24/structtraccc_1_1triplet.html#af7e0955436720990ef25d892730fecc6">traccc::triplet::sp3</a>, <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">traccc::sp_location::sp_idx</a>, <a class="el" href="../../dd/d99/structtraccc_1_1device_1_1triplet__counter__spM.html#ad053bf6f6b3d4e571d13dda13e4b5358">traccc::device::triplet_counter_spM::spM</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#ac442e88aa4843acc23e92bcdc4a73ead">traccc::device::device_triplet::spT</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#a1f17ad577bd1585a5e0eab43abe7f59a">traccc::device::device_triplet::weight</a>, <a class="el" href="../../db/d24/structtraccc_1_1triplet.html#adfad39aa501708daa791a172ee306245">traccc::triplet::weight</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#ac1368973a523d4b821be2fc82399fa65">traccc::device::device_triplet::z_vertex</a>, and <a class="el" href="../../db/d24/structtraccc_1_1triplet.html#abd2e5e482bd7afb1262179b8f226bb06">traccc::triplet::z_vertex</a>.</p>

</div>
</div>
<a id="ab5df4029912b7c1cd4d2186bf9434a1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab5df4029912b7c1cd4d2186bf9434a1d">&#9670;&nbsp;</a></span>update_triplet_weights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d3/d2a/qualifiers_8hpp.html#a883f657259ab2dcc9d7b3ffd6165541a">TRACCC_HOST_DEVICE</a> void traccc::device::update_triplet_weights </td>
          <td>(</td>
          <td class="paramtype">std::size_t&#160;</td>
          <td class="paramname"><em>globalIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html">seedfilter_config</a> &amp;&#160;</td>
          <td class="paramname"><em>filter_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d7/d7b/namespacetraccc.html#a9fd4dd5935c4a4b0ad8659bbf05c913c">sp_grid_const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>sp_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_spM_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>spM_tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a6ef00cb04070f8f7954499bdaa71ddf0">triplet_counter_collection_types::const_view</a> &amp;&#160;</td>
          <td class="paramname"><em>tc_view</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../db/dba/structtraccc_1_1collection__types.html#a81f48fe7d1fbbd487c3dbdad322b1142">device_triplet_collection_types::view</a>&#160;</td>
          <td class="paramname"><em>triplet_view</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Function used for updating the triplets' weights</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">globalIndex</td><td>The index of the current thread </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">filter_config</td><td>Seedfilter configuration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sp_view</td><td>The spacepoint grid </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">spM_tc_view</td><td>Collection of triplet counts per spM </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">tc_view</td><td>Collection of triplet counts per midBot doublet </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>Array for temporary storage of quality parameters for comparison of triplets </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">triplet_view</td><td>Collection of triplets </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;                                                      {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160; </div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    device_triplet_collection_types::device triplets(triplet_view);</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">if</span> (globalIndex &gt;= triplets.size()) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160; </div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="comment">// Set up the device containers</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">const_sp_grid_device</a> <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>(sp_view);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <span class="keyword">const</span> triplet_counter_spM_collection_types::const_device triplet_counts_spM(</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;        spM_tc_view);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keyword">const</span> triplet_counter_collection_types::const_device triplet_counts(</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        tc_view);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="comment">// Current work item</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    device_triplet this_triplet = triplets[globalIndex];</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160; </div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;    <span class="keyword">const</span> sp_location&amp; spT_idx = this_triplet.spT;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> current_spT =</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(spT_idx.bin_idx)[spT_idx.sp_idx];</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160; </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> currentTop_r = current_spT.<a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#a061cdd2ac8f79dd73d7bb5eef846daa6">radius</a>();</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160; </div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    <span class="comment">// if two compatible seeds with high distance in r are found, compatible</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <span class="comment">// seeds span 5 layers</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    <span class="comment">// -&gt; very good seed</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> lowerLimitCurv =</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        this_triplet.curvature - filter_config.deltaInvHelixDiameter;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> upperLimitCurv =</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        this_triplet.curvature + filter_config.deltaInvHelixDiameter;</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    std::size_t num_compat_seedR = 0;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160; </div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keyword">const</span> triplet_counter mb_count =</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        triplet_counts.at(this_triplet.counter_link);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    <span class="comment">// Check if anything needs to be done.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keywordflow">if</span> (mb_count.m_nTriplets &lt;= 1) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    <span class="comment">// Get the position of the triplets which share this sabe midBottom doublet</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> triplets_mb_begin =</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        mb_count.posTriplets +</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        triplet_counts_spM.at(mb_count.spM_counter_link).posTriplets;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> triplets_mb_end =</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        triplets_mb_begin + mb_count.m_nTriplets;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    <span class="comment">// iterate over triplets</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = triplets_mb_begin; i &lt; triplets_mb_end; ++i) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">// skip same triplet</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keywordflow">if</span> (i == globalIndex) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160; </div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keyword">const</span> device_triplet other_triplet = triplets[i];</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keyword">const</span> sp_location other_spT_idx = other_triplet.spT;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint&lt;traccc::spacepoint&gt;</a> other_spT =</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <a class="code" href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">sp_grid</a>.bin(other_spT_idx.bin_idx)[other_spT_idx.sp_idx];</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160; </div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <span class="comment">// compared top SP should have at least deltaRMin distance</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> otherTop_r = other_spT.<a class="code" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#a061cdd2ac8f79dd73d7bb5eef846daa6">radius</a>();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> deltaR = currentTop_r - otherTop_r;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">if</span> (std::abs(deltaR) &lt; filter_config.deltaRMin) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160; </div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="comment">// curvature difference within limits?</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">// TODO: how much slower than sorting all vectors by curvature</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="comment">// and breaking out of loop? i.e. is vector size large (e.g. in</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment">// jets?)</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span> (other_triplet.curvature &lt; lowerLimitCurv) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <span class="keywordflow">if</span> (other_triplet.curvature &gt; upperLimitCurv) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <span class="keywordtype">bool</span> newCompSeed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keywordflow">for</span> (std::size_t i_s = 0; i_s &lt; num_compat_seedR; ++i_s) {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">scalar</a> previousDiameter = data[i_s];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160; </div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="comment">// original ATLAS code uses higher min distance for 2nd found</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="comment">// compatible seed (20mm instead of 5mm) add new compatible seed</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="comment">// only if distance larger than rmin to all other compatible</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="comment">// seeds</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            <span class="keywordflow">if</span> (std::abs(previousDiameter - otherTop_r) &lt;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                filter_config.deltaRMin) {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                newCompSeed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> (newCompSeed) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            data[num_compat_seedR] = otherTop_r;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            this_triplet.weight += filter_config.compatSeedWeight;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            num_compat_seedR++;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span> (num_compat_seedR &gt;= filter_config.compatSeedLimit) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    triplets[globalIndex].weight = this_triplet.weight;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">traccc::sp_location::bin_idx</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#af15c65b168c31d76d13692022014aa0a">traccc::seedfilter_config::compatSeedLimit</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#aea9a45d27a98cdc54281d9369351cbac">traccc::seedfilter_config::compatSeedWeight</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#a9009ebd7e3342f34eb55eeaa25fdac3e">traccc::device::device_triplet::counter_link</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#adbdfe680b24f38562f16c9e8a60510c4">traccc::device::device_triplet::curvature</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#a341ed687873146db8dde11ab339bdb69">traccc::seedfilter_config::deltaInvHelixDiameter</a>, <a class="el" href="../../d5/d73/structtraccc_1_1seedfilter__config.html#ac8b1982ea2bc8196449d64dd739fc533">traccc::seedfilter_config::deltaRMin</a>, <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#ac0d31909ffc1635b853610b4289de66e">traccc::device::triplet_counter::m_nTriplets</a>, <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#a627caf65afde62b0f88982e41d734417">traccc::device::triplet_counter::posTriplets</a>, <a class="el" href="../../de/db7/structtraccc_1_1internal__spacepoint.html#a061cdd2ac8f79dd73d7bb5eef846daa6">traccc::internal_spacepoint&lt; spacepoint_t &gt;::radius()</a>, <a class="el" href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">traccc::sp_location::sp_idx</a>, <a class="el" href="../../d1/da8/structtraccc_1_1device_1_1triplet__counter.html#a1f2b6669bd4dd2461885917cf7d32fcb">traccc::device::triplet_counter::spM_counter_link</a>, <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#ac442e88aa4843acc23e92bcdc4a73ead">traccc::device::device_triplet::spT</a>, and <a class="el" href="../../d0/dd4/structtraccc_1_1device_1_1device__triplet.html#a1f17ad577bd1585a5e0eab43abe7f59a">traccc::device::device_triplet::weight</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacetraccc_html_a49b1ec1e09c6b63a918d97428dd51f2e"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a49b1ec1e09c6b63a918d97428dd51f2e">traccc::bound_track_parameters</a></div><div class="ttdeci">detray::bound_track_parameters&lt; transform3 &gt; bound_track_parameters</div><div class="ttdef"><b>Definition:</b> track_parameters.hpp:22</div></div>
<div class="ttc" id="anamespacetraccc_html_a65f3496a079e9bdcffaf1d62a5fa4151af60fe71ca99e61d0a0d70fb431aabc04"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a65f3496a079e9bdcffaf1d62a5fa4151af60fe71ca99e61d0a0d70fb431aabc04">traccc::e_bound_size</a></div><div class="ttdeci">@ e_bound_size</div><div class="ttdef"><b>Definition:</b> track_parametrization.hpp:36</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_1_1details_html_a78a788b16fc4939f7c8ad1db674160d7"><div class="ttname"><a href="../../db/d86/namespacetraccc_1_1device_1_1details.html#a78a788b16fc4939f7c8ad1db674160d7">traccc::device::details::insertionSort</a></div><div class="ttdeci">TRACCC_HOST_DEVICE void insertionSort(triplet *arr, const std::size_t begin_idx, const std::size_t n, Comparator comp)</div><div class="ttdef"><b>Definition:</b> select_seeds.ipp:39</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_html_ab8368c09597104f9b3fecf98b4a1111d"><div class="ttname"><a href="../../d0/db6/namespacetraccc_1_1device.html#ab8368c09597104f9b3fecf98b4a1111d">traccc::device::reduce_problem_cell</a></div><div class="ttdeci">TRACCC_HOST_DEVICE void reduce_problem_cell(const cell_collection_types::const_device &amp;cells, const unsigned short cid, const unsigned int start, const unsigned int end, unsigned char &amp;adjc, unsigned short adjv[8])</div><div class="ttdef"><b>Definition:</b> reduce_problem_cell.ipp:26</div></div>
<div class="ttc" id="anamespacetraccc_1_1detail_html_ab8b9563129faf8333be30d0895d1a6a6"><div class="ttname"><a href="../../d3/d75/namespacetraccc_1_1detail.html#ab8b9563129faf8333be30d0895d1a6a6">traccc::detail::signal_cell_modelling</a></div><div class="ttdeci">TRACCC_HOST_DEVICE scalar signal_cell_modelling(scalar signal_in, const cell_module &amp;)</div><div class="ttdoc">Function used for retrieving the cell signal based on the module id.</div><div class="ttdef"><b>Definition:</b> measurement_creation_helper.hpp:21</div></div>
<div class="ttc" id="anamespacetraccc_html_aab82ddc5db54d9ad84b1215320482993"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#aab82ddc5db54d9ad84b1215320482993">traccc::scalar</a></div><div class="ttdeci">TRACCC_CUSTOM_SCALARTYPE scalar</div><div class="ttdef"><b>Definition:</b> array_definitions.hpp:30</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_html_a2fc626e715c5d48a0d3261d70d479dd5"><div class="ttname"><a href="../../d0/db6/namespacetraccc_1_1device.html#a2fc626e715c5d48a0d3261d70d479dd5">traccc::device::fast_sv_1</a></div><div class="ttdeci">TRACCC_DEVICE void fast_sv_1(index_t *f, index_t *gf, unsigned char adjc[MAX_CELLS_PER_THREAD], index_t adjv[MAX_CELLS_PER_THREAD][8], const index_t tid, const index_t blckDim, barrier_t &amp;barrier)</div><div class="ttdef"><b>Definition:</b> ccl_kernel.ipp:36</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_html_a560c561636e8700675394f3f5a7d7e5d"><div class="ttname"><a href="../../d0/db6/namespacetraccc_1_1device.html#a560c561636e8700675394f3f5a7d7e5d">traccc::device::aggregate_cluster</a></div><div class="ttdeci">TRACCC_HOST_DEVICE void aggregate_cluster(const cell_collection_types::const_device &amp;cells, const cell_module_collection_types::const_device &amp;modules, const vecmem::data::vector_view&lt; unsigned short &gt; f_view, const unsigned int start, const unsigned int end, const unsigned short cid, measurement &amp;out, vecmem::data::vector_view&lt; unsigned int &gt; cell_links, const unsigned int link)</div><div class="ttdef"><b>Definition:</b> aggregate_cluster.ipp:16</div></div>
<div class="ttc" id="anamespacetraccc_html_a7d1f91ecd225f32ea85349bf0bc8adb8"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a7d1f91ecd225f32ea85349bf0bc8adb8">traccc::transform3</a></div><div class="ttdeci">__plugin::transform3&lt; traccc::scalar &gt; transform3</div><div class="ttdef"><b>Definition:</b> primitives.hpp:35</div></div>
<div class="ttc" id="anamespacetraccc_html_a83ee72b67d3c03df43280e5bc169ac7a"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a83ee72b67d3c03df43280e5bc169ac7a">traccc::point2</a></div><div class="ttdeci">__plugin::point2&lt; traccc::scalar &gt; point2</div><div class="ttdef"><b>Definition:</b> primitives.hpp:30</div></div>
<div class="ttc" id="astructtraccc_1_1lin__circle_html_abff2aeab6abec38b620888e6c0b54a52"><div class="ttname"><a href="../../d1/d20/structtraccc_1_1lin__circle.html#abff2aeab6abec38b620888e6c0b54a52">traccc::lin_circle::cotTheta</a></div><div class="ttdeci">TRACCC_HOST_DEVICE const scalar &amp; cotTheta() const</div><div class="ttdef"><b>Definition:</b> lin_circle.hpp:36</div></div>
<div class="ttc" id="anamespacetraccc_html_afdad33573f6399c7e2671b6968dfc29c"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#afdad33573f6399c7e2671b6968dfc29c">traccc::const_sp_grid_device</a></div><div class="ttdeci">detray::grid2&lt; detray::attach_populator, detray::axis::circular, detray::axis::regular, detray::serializer2, vecmem::device_vector, vecmem::jagged_device_vector, detray::darray, detray::dtuple, const internal_spacepoint&lt; spacepoint &gt;, false &gt; const_sp_grid_device</div><div class="ttdef"><b>Definition:</b> spacepoint_grid.hpp:38</div></div>
<div class="ttc" id="anamespacetraccc_html_a7a1ed25524ba151f7ee54cec655fb3f3"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a7a1ed25524ba151f7ee54cec655fb3f3">traccc::point3</a></div><div class="ttdeci">__plugin::point3&lt; traccc::scalar &gt; point3</div><div class="ttdef"><b>Definition:</b> primitives.hpp:32</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_html_aec5610a925cef95697843cc4e8b38bcb"><div class="ttname"><a href="../../d0/db6/namespacetraccc_1_1device.html#aec5610a925cef95697843cc4e8b38bcb">traccc::device::prefix_sum_element_t</a></div><div class="ttdeci">thrust::pair&lt; std::size_t, std::size_t &gt; prefix_sum_element_t</div><div class="ttdoc">Type for the individual elements in the prefix sum vector.</div><div class="ttdef"><b>Definition:</b> fill_prefix_sum.hpp:24</div></div>
<div class="ttc" id="anamespacetraccc_html_a503d2d50b981602cbc71693ad215b298"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a503d2d50b981602cbc71693ad215b298">traccc::get_data</a></div><div class="ttdeci">container_data&lt; header_t, item_t &gt; get_data(host_container&lt; header_t, item_t &gt; &amp;cc, vecmem::memory_resource *resource=nullptr)</div><div class="ttdef"><b>Definition:</b> container.hpp:111</div></div>
<div class="ttc" id="anamespacetraccc_html_afe5550543749e1fde57f965020411065"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#afe5550543749e1fde57f965020411065">traccc::sp_grid_device</a></div><div class="ttdeci">detray::grid2&lt; detray::attach_populator, detray::axis::circular, detray::axis::regular, detray::serializer2, vecmem::device_vector, vecmem::jagged_device_vector, detray::darray, detray::dtuple, internal_spacepoint&lt; spacepoint &gt;, false &gt; sp_grid_device</div><div class="ttdef"><b>Definition:</b> spacepoint_grid.hpp:32</div></div>
<div class="ttc" id="astructtraccc_1_1memory__resource_html_a9f1136a4fdab877dd1bbd1a2996e2149"><div class="ttname"><a href="../../dc/db2/structtraccc_1_1memory__resource.html#a9f1136a4fdab877dd1bbd1a2996e2149">traccc::memory_resource::main</a></div><div class="ttdeci">vecmem::memory_resource &amp; main</div><div class="ttdef"><b>Definition:</b> memory_resource.hpp:19</div></div>
<div class="ttc" id="astructtraccc_1_1lin__circle_html_ab35afbdb99bb552cc8a85cf517aabfbc"><div class="ttname"><a href="../../d1/d20/structtraccc_1_1lin__circle.html#ab35afbdb99bb552cc8a85cf517aabfbc">traccc::lin_circle::Zo</a></div><div class="ttdeci">TRACCC_HOST_DEVICE const scalar &amp; Zo() const</div><div class="ttdef"><b>Definition:</b> lin_circle.hpp:33</div></div>
<div class="ttc" id="astructtraccc_1_1sp__location_html"><div class="ttname"><a href="../../d7/dca/structtraccc_1_1sp__location.html">traccc::sp_location</a></div><div class="ttdoc">location of spacepoint in internal spacepoint container</div><div class="ttdef"><b>Definition:</b> singlet.hpp:16</div></div>
<div class="ttc" id="astructtraccc_1_1sp__location_html_a2c5869bc5537dc06273a672e2e09bf70"><div class="ttname"><a href="../../d7/dca/structtraccc_1_1sp__location.html#a2c5869bc5537dc06273a672e2e09bf70">traccc::sp_location::sp_idx</a></div><div class="ttdeci">unsigned int sp_idx</div><div class="ttdoc">index of the spacepoint in the bin</div><div class="ttdef"><b>Definition:</b> singlet.hpp:20</div></div>
<div class="ttc" id="anamespacetraccc_html_a238ca82836cc5cff0a7c1026ea0530e0"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a238ca82836cc5cff0a7c1026ea0530e0">traccc::sp_grid</a></div><div class="ttdeci">detray::grid2&lt; detray::attach_populator, detray::axis::circular, detray::axis::regular, detray::serializer2, detray::dvector, detray::djagged_vector, detray::darray, detray::dtuple, internal_spacepoint&lt; spacepoint &gt;, false &gt; sp_grid</div><div class="ttdef"><b>Definition:</b> spacepoint_grid.hpp:27</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_html_a32c38f509eef5398c63cc66721db1a83"><div class="ttname"><a href="../../d0/db6/namespacetraccc_1_1device.html#a32c38f509eef5398c63cc66721db1a83">traccc::device::is_adjacent</a></div><div class="ttdeci">TRACCC_HOST_DEVICE bool is_adjacent(channel_id ac0, channel_id ac1, channel_id bc0, channel_id bc1)</div><div class="ttdef"><b>Definition:</b> reduce_problem_cell.ipp:17</div></div>
<div class="ttc" id="anamespacetraccc_1_1detail_html_a7a2d59fbc63350abdfe5e2af688d24ad"><div class="ttname"><a href="../../d3/d75/namespacetraccc_1_1detail.html#a7a2d59fbc63350abdfe5e2af688d24ad">traccc::detail::position_from_cell</a></div><div class="ttdeci">TRACCC_HOST_DEVICE vector2 position_from_cell(const cell &amp;cell, const cell_module &amp;module)</div><div class="ttdoc">Function for pixel segmentation.</div><div class="ttdef"><b>Definition:</b> measurement_creation_helper.hpp:28</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_1_1details_html_a8f4ac52a914ad8541e79747fe5031ea9"><div class="ttname"><a href="../../db/d86/namespacetraccc_1_1device_1_1details.html#a8f4ac52a914ad8541e79747fe5031ea9">traccc::device::details::min_elem</a></div><div class="ttdeci">TRACCC_HOST_DEVICE std::size_t min_elem(const triplet *arr, const std::size_t begin_idx, const std::size_t end_idx, Comparator comp)</div><div class="ttdef"><b>Definition:</b> select_seeds.ipp:21</div></div>
<div class="ttc" id="astructtraccc_1_1lin__circle_html"><div class="ttname"><a href="../../d1/d20/structtraccc_1_1lin__circle.html">traccc::lin_circle</a></div><div class="ttdoc">Header: unsigned int for the number of lin_circles per spacepoint bin.</div><div class="ttdef"><b>Definition:</b> lin_circle.hpp:18</div></div>
<div class="ttc" id="astructtraccc_1_1internal__spacepoint_html_a061cdd2ac8f79dd73d7bb5eef846daa6"><div class="ttname"><a href="../../de/db7/structtraccc_1_1internal__spacepoint.html#a061cdd2ac8f79dd73d7bb5eef846daa6">traccc::internal_spacepoint::radius</a></div><div class="ttdeci">TRACCC_HOST_DEVICE scalar radius() const</div><div class="ttdef"><b>Definition:</b> internal_spacepoint.hpp:75</div></div>
<div class="ttc" id="anamespacetraccc_html_a88606a40b404017f29254d1316716919"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a88606a40b404017f29254d1316716919">traccc::seed_to_bound_vector</a></div><div class="ttdeci">TRACCC_HOST_DEVICE bound_vector seed_to_bound_vector(const spacepoint_collection_t &amp;sp_collection, const seed &amp;seed, const vector3 &amp;bfield, const scalar mass)</div><div class="ttdef"><b>Definition:</b> track_params_estimation_helper.hpp:41</div></div>
<div class="ttc" id="astructtraccc_1_1internal__spacepoint_html"><div class="ttname"><a href="../../de/db7/structtraccc_1_1internal__spacepoint.html">traccc::internal_spacepoint</a></div><div class="ttdoc">Item: A internal spacepoint definition.</div><div class="ttdef"><b>Definition:</b> internal_spacepoint.hpp:24</div></div>
<div class="ttc" id="anamespacetraccc_html_ac9cd1f64237a5da323f13740187b0cb8"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#ac9cd1f64237a5da323f13740187b0cb8">traccc::channel_id</a></div><div class="ttdeci">unsigned int channel_id</div><div class="ttdef"><b>Definition:</b> primitives.hpp:27</div></div>
<div class="ttc" id="anamespacetraccc_1_1device_html_ade298ff55a1bdb496e412262cdb66433"><div class="ttname"><a href="../../d0/db6/namespacetraccc_1_1device.html#ade298ff55a1bdb496e412262cdb66433">traccc::device::prefix_sum_size_t</a></div><div class="ttdeci">vecmem::data::vector_view&lt; int &gt;::size_type prefix_sum_size_t</div><div class="ttdef"><b>Definition:</b> fill_prefix_sum.hpp:29</div></div>
<div class="ttc" id="astructtraccc_1_1sp__location_html_a0de6f50bcf35a0a0f62b1dc00d587a55"><div class="ttname"><a href="../../d7/dca/structtraccc_1_1sp__location.html#a0de6f50bcf35a0a0f62b1dc00d587a55">traccc::sp_location::bin_idx</a></div><div class="ttdeci">unsigned int bin_idx</div><div class="ttdoc">index of the bin of the spacepoint grid</div><div class="ttdef"><b>Definition:</b> singlet.hpp:18</div></div>
<div class="ttc" id="anamespacetraccc_html_a6cf70f42326684dce8af8f18664292af"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a6cf70f42326684dce8af8f18664292af">traccc::PION_MASS_MEV</a></div><div class="ttdeci">constexpr scalar PION_MASS_MEV</div><div class="ttdef"><b>Definition:</b> common.hpp:25</div></div>
<div class="ttc" id="anamespacetraccc_1_1details_1_1functor_html_a357582a9a6874cb71ff052105af32ab2"><div class="ttname"><a href="../../da/dad/namespacetraccc_1_1details_1_1functor.html#a357582a9a6874cb71ff052105af32ab2">traccc::details::functor::const_reference</a></div><div class="ttdeci">const T &amp; const_reference</div><div class="ttdoc">The const reference functor, such that const_reference&lt;T&gt; is equivalent to const T&amp;.</div><div class="ttdef"><b>Definition:</b> functor.hpp:28</div></div>
<div class="ttc" id="anamespacetraccc_html_a4e12ff4b9f7297ad771d4fe8ecc17304"><div class="ttname"><a href="../../d7/d7b/namespacetraccc.html#a4e12ff4b9f7297ad771d4fe8ecc17304">traccc::is_valid_sp</a></div><div class="ttdeci">TRACCC_HOST_DEVICE size_t is_valid_sp(const seedfinder_config &amp;config, const spacepoint &amp;sp)</div><div class="ttdef"><b>Definition:</b> spacepoint_binning_helper.hpp:109</div></div>
<div class="ttc" id="astructtraccc_1_1memory__resource_html_a3a7e6ce915149a10e37a9e9c6d73bf95"><div class="ttname"><a href="../../dc/db2/structtraccc_1_1memory__resource.html#a3a7e6ce915149a10e37a9e9c6d73bf95">traccc::memory_resource::host</a></div><div class="ttdeci">vecmem::memory_resource * host</div><div class="ttdef"><b>Definition:</b> memory_resource.hpp:22</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
